<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This assigniment uses regular expressions to extract dates from medical data and sorts them.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Extracting Dates From Medical Data | Data Science With Python</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/posts/extracting-dates-from-medical-data/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="necromuralist">
<link rel="prev" href="../evaluating-a-model/" title="Evaluating a Model" type="text/html">
<link rel="next" href="../assignment-2-introduction-to-nltk/" title="Assignment 2 - Introduction to NLTK" type="text/html">
<meta property="og:site_name" content="Data Science With Python">
<meta property="og:title" content="Extracting Dates From Medical Data">
<meta property="og:url" content="https://necromuralist.github.io/data_science/posts/extracting-dates-from-medical-data/">
<meta property="og:description" content="This assigniment uses regular expressions to extract dates from medical data and sorts them.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-08-07T17:16:00-07:00">
<meta property="article:tag" content="regularexpressions">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Data Science With Python</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu"><li>
<a href="../../pages/portland-unemployment-2007-to-2017">Portland Unemployment Visualization</a>
            </li></ul>
</li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.rst" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Extracting Dates From Medical Data</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-08-07T17:16:00-07:00" itemprop="datePublished" title="2017-08-07 17:16">2017-08-07 17:16</time></a></p>
            
        <p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>In this assignment, you'll be working with messy medical data and using regular expressions to extract relevant information from the data.</p>
<p>Each line of the <tt class="docutils literal">dates.txt</tt> file corresponds to a medical note. Each note has a date that needs to be extracted, but each date is encoded in one of many formats.</p>
<p>The goal of this assignment is to correctly identify all of the different date variants encoded in this dataset and to properly normalize and sort the dates.</p>
<p>Here is a list of some of the variants you might encounter in this dataset:</p>
<ul class="simple">
<li>04/20/2009; 04/20/09; 4/20/09; 4/3/09</li>
<li>Mar-20-2009; Mar 20, 2009; March 20, 2009;  Mar. 20, 2009; Mar 20 2009;</li>
<li>20 Mar 2009; 20 March 2009; 20 Mar. 2009; 20 March, 2009</li>
<li>Mar 20th, 2009; Mar 21st, 2009; Mar 22nd, 2009</li>
<li>Feb 2009; Sep 2009; Oct 2010</li>
<li>6/2008; 12/2009</li>
<li>2009; 2010</li>
</ul>
<p>Once you have extracted these date patterns from the text, the next step is to sort them in ascending chronological order accoring to the following rules:</p>
<ul class="simple">
<li>Assume all dates in xx/xx/xx format are mm/dd/yy</li>
<li>Assume all dates where year is encoded in only two digits are years from the 1900's (e.g. 1/5/89 is January 5th, 1989)</li>
<li>If the day is missing (e.g. 9/2009), assume it is the first day of the month (e.g. September 1, 2009).</li>
<li>If the month is missing (e.g. 2010), assume it is the first of January of that year (e.g. January 1, 2010).</li>
</ul>
<p>With these rules in mind, find the correct date in each note and return a pandas Series in chronological order of the original Series' indices.</p>
<p>For example if the original series was this:</p>
<pre class="literal-block">
0    1999
1    2010
2    1978
3    2015
4    1985
</pre>
<pre class="literal-block">
0    2
1    4
2    0
3    1
4    3
</pre>
<p>Your score will be calculated using <a class="reference external" href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient">Kendall's tau</a>, a correlation measure for ordinal data.</p>
<p><strong>This function should return a Series of length 500 and dtype int.</strong></p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code ipython"><a name="rest_code_9b631790537144579c83f03f88990bad-1"></a><span class="c1"># from pypi</span>
<a name="rest_code_9b631790537144579c83f03f88990bad-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
</pre>
</div>
<div class="section" id="loading-the-data">
<h2>3 Loading The Data</h2>
<pre class="code ipython"><a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'dates.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-2"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-3"></a>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-4"></a><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre>
<pre class="literal-block">
0         03/25/93 Total time of visit (in minutes):\n
1                       6/18/85 Primary Care Doctor:\n
2    sshe plans to move as of 7/8/71 In-Home Servic...
3                7 on 9/27/75 Audit C Score Current:\n
4    2/6/96 sleep studyPain Treatment Pain Level (N...
5                    .Per 7/06/79 Movement D/O note:\n
6    4, 5/18/78 Patient's thoughts about current su...
7    10/24/89 CPT Code: 90801 - Psychiatric Diagnos...
8                         3/7/86 SOS-10 Total Score:\n
9             (4/10/71)Score-1Audit C Score Current:\n
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_57ded1fdca904a5988df20f362cd4ec4-1"></a><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre>
<pre class="literal-block">
count                                                   500
unique                                                  500
top       sApproximately 7 psychiatric hospitalizations ...
freq                                                      1
dtype: object
</pre>
</div>
<div class="section" id="the-grammar">
<h2>4 The Grammar</h2>
<div class="section" id="cardinality">
<h3>4.1 Cardinality</h3>
<pre class="code ipython"><a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-1"></a><span class="n">ZERO_OR_MORE</span> <span class="o">=</span> <span class="s1">'*'</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-2"></a><span class="n">ONE_OR_MORE</span> <span class="o">=</span> <span class="s2">"+"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-3"></a><span class="n">ZERO_OR_ONE</span> <span class="o">=</span> <span class="s1">'?'</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-4"></a><span class="n">EXACTLY_TWO</span> <span class="o">=</span> <span class="s2">"{2}"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-5"></a><span class="n">ONE_OR_TWO</span> <span class="o">=</span> <span class="s2">"{1,2}"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-6"></a><span class="n">EXACTLY_ONE</span> <span class="o">=</span> <span class="s1">'{1}'</span>
</pre>
</div>
<div class="section" id="groups-and-classes">
<h3>4.2 Groups and Classes</h3>
<pre class="code ipython"><a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-1"></a><span class="n">GROUP</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"({})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-2"></a><span class="n">NAMED</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"(?P&lt;{}&gt;{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-3"></a><span class="n">CLASS</span> <span class="o">=</span> <span class="s2">"[{}]"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-4"></a><span class="n">NEGATIVE_LOOKAHEAD</span> <span class="o">=</span> <span class="s2">"(?!{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-5"></a><span class="n">NEGATIVE_LOOKBEHIND</span> <span class="o">=</span> <span class="s2">"(?&lt;!{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-6"></a><span class="n">POSITIVE_LOOKAHEAD</span> <span class="o">=</span> <span class="s2">"(?={})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-7"></a><span class="n">POSITIVE_LOOKBEHIND</span> <span class="o">=</span> <span class="s2">"(?&lt;={})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-8"></a><span class="n">ESCAPE</span> <span class="o">=</span> <span class="s2">"\{}"</span>
</pre>
</div>
<div class="section" id="numbers">
<h3>4.3 Numbers</h3>
<pre class="code ipython"><a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-1"></a><span class="n">DIGIT</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\d"</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-2"></a><span class="n">ONE_DIGIT</span>  <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_ONE</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-3"></a><span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-4"></a><span class="n">NON_DIGIT</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKAHEAD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DIGIT</span><span class="p">)</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-5"></a><span class="n">TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_TWO</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-6"></a><span class="n">THREE_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="s2">"{3}"</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-7"></a><span class="n">EXACTLY_TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_TWO</span> <span class="o">+</span> <span class="n">NON_DIGIT</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-8"></a><span class="n">FOUR_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">"{4}"</span> <span class="o">+</span> <span class="n">NON_DIGIT</span>
</pre>
</div>
<div class="section" id="string-literals">
<h3>4.4 String Literals</h3>
<pre class="code ipython"><a name="rest_code_8d32b18c02d04df28379534a1c7949b0-1"></a><span class="n">SLASH</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"/"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-2"></a><span class="n">OR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'|'</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-3"></a><span class="n">LOWER_CASE</span> <span class="o">=</span> <span class="s2">"a-z"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-4"></a><span class="n">SPACE</span> <span class="o">=</span> <span class="s2">"\s"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-5"></a><span class="n">DOT</span> <span class="o">=</span> <span class="s2">"."</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-6"></a><span class="n">DASH</span> <span class="o">=</span> <span class="s2">"-"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-7"></a><span class="n">COMMA</span> <span class="o">=</span> <span class="s2">","</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-8"></a><span class="n">PUNCTUATION</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOT</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">DASH</span><span class="p">)</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-9"></a><span class="n">EMPTY_STRING</span> <span class="o">=</span> <span class="s2">""</span>
</pre>
</div>
<div class="section" id="dates">
<h3>4.5 Dates</h3>
<p>These are parts to build up the date-expressions.</p>
<pre class="code ipython"><a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-1"></a><span class="n">MONTH_SUFFIX</span> <span class="o">=</span> <span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ZERO_OR_MORE</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-2"></a>                <span class="o">+</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SPACE</span> <span class="o">+</span> <span class="n">DOT</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">DASH</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span><span class="p">)</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-3"></a><span class="n">MONTH_PREFIXES</span> <span class="o">=</span> <span class="s2">"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-4"></a><span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span><span class="n">month</span> <span class="o">+</span> <span class="n">MONTH_SUFFIX</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTH_PREFIXES</span><span class="p">]</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-5"></a><span class="n">MONTHS</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MONTHS</span><span class="p">))</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-6"></a><span class="n">DAY_SUFFIX</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DASH</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-7"></a><span class="n">DAYS</span> <span class="o">=</span> <span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">+</span> <span class="n">DAY_SUFFIX</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-8"></a><span class="n">YEAR</span> <span class="o">=</span> <span class="n">FOUR_DIGITS</span>
</pre>
<p>This is for dates like <em>Mar 21st, 2009</em>, those with suffixes on the days.</p>
<pre class="code ipython"><a name="rest_code_64197d882bd04964b03a78b818a7439e-1"></a><span class="n">CONTRACTED</span> <span class="o">=</span> <span class="p">(</span><span class="n">ONE_OR_TWO_DIGITS</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-2"></a>              <span class="o">+</span> <span class="n">LOWER_CASE</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-3"></a>              <span class="o">+</span> <span class="n">EXACTLY_TWO</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-4"></a>              <span class="p">)</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-5"></a><span class="n">CONTRACTION</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"contraction"</span><span class="p">,</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-6"></a>                           <span class="n">MONTHS</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-7"></a>                           <span class="o">+</span> <span class="n">CONTRACTED</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-8"></a>                           <span class="o">+</span> <span class="n">DAY_SUFFIX</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-9"></a>                           <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for dates that have no days in them, like <em>May 2009</em>.</p>
<pre class="code ipython"><a name="rest_code_88d6900b06dd48868e9b47e314a3552e-1"></a><span class="n">NO_DAY_BEHIND</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span>
<a name="rest_code_88d6900b06dd48868e9b47e314a3552e-2"></a><span class="n">NO_DAY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"no_day"</span><span class="p">,</span> <span class="n">NO_DAY_BEHIND</span> <span class="o">+</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for the most common form (that I use) - <em>May 21, 2017</em>.</p>
<pre class="code ipython"><a name="rest_code_87c43c521ca64721be5846e6e2899c17-1"></a><span class="n">WORDS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"words"</span><span class="p">,</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">DAYS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for the case where the day is placed before them month - <em>20 March, 2009</em>.</p>
<pre class="code ipython"><a name="rest_code_64130b76c99e449d968c5cffe7f9c8e1-1"></a><span class="n">BACKWARDS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"backwards"</span><span class="p">,</span> <span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is the case where slashes are used but only two digits were used for the year (so we're assuming it's in the twentieth century) - <em>8/4/98</em>.</p>
<pre class="code ipython"><a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-1"></a><span class="n">slashed</span> <span class="o">=</span> <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-2"></a>                      <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-3"></a>                      <span class="n">EXACTLY_TWO_DIGITS</span><span class="p">])</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-4"></a><span class="n">dashed</span> <span class="o">=</span> <span class="n">DASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-5"></a>                    <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-6"></a>                    <span class="n">EXACTLY_TWO_DIGITS</span><span class="p">])</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-7"></a><span class="n">TWENTIETH_CENTURY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"twentieth"</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-8"></a>                                 <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">slashed</span><span class="p">,</span> <span class="n">dashed</span><span class="p">]))</span>
</pre>
<p>This is the case where digits with slashes are used and all four digits are used for the year - <em>8/4/1998</em>.</p>
<pre class="code ipython"><a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-1"></a><span class="n">NUMERIC</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"numeric"</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-2"></a>                       <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-3"></a>                                   <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-4"></a>                                   <span class="n">FOUR_DIGITS</span><span class="p">]))</span>
</pre>
<p>This is the case where only month and year are given as digits - <em>9/2009</em>. There are two expressions, because the day can be one or two digits.</p>
<pre class="code ipython"><a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-1"></a><span class="n">NO_PRECEDING_SLASH</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-2"></a><span class="n">NO_PRECEDING_SLASH_DIGIT</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span> <span class="o">+</span> <span class="n">DIGIT</span><span class="p">))</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-3"></a><span class="n">NO_ONE_DAY</span> <span class="o">=</span> <span class="p">(</span><span class="n">NO_PRECEDING_SLASH_DIGIT</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-4"></a>              <span class="o">+</span> <span class="n">ONE_DIGIT</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-5"></a>              <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-6"></a>              <span class="o">+</span> <span class="n">FOUR_DIGITS</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-7"></a><span class="n">NO_TWO_DAYS</span> <span class="o">=</span> <span class="p">(</span><span class="n">NO_PRECEDING_SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-8"></a>               <span class="o">+</span> <span class="n">TWO_DIGITS</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-9"></a>               <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-10"></a>               <span class="o">+</span> <span class="n">FOUR_DIGITS</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-11"></a><span class="n">NO_DAY_NUMERIC</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"no_day_numeric"</span><span class="p">,</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-12"></a>                              <span class="n">NO_ONE_DAY</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-13"></a>                              <span class="o">+</span> <span class="n">OR</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-14"></a>                              <span class="o">+</span> <span class="n">NO_TWO_DAYS</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-15"></a>                              <span class="p">)</span>
</pre>
<p>This is the case where only a year was given. This is the hardest case, since you don't want to accidentally match the other cases, but the text preceding and following it could be anything. For the look-behind, all the cases have to have the same number of characters so we can't re-use the other expressions</p>
<pre class="code ipython"><a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-1"></a><span class="n">CENTURY</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'19'</span> <span class="o">+</span> <span class="n">OR</span> <span class="o">+</span> <span class="s2">"20"</span><span class="p">)</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-2"></a><span class="n">DIGIT_SLASH</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-3"></a><span class="n">DIGIT_DASH</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">DASH</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-4"></a><span class="n">DIGIT_SPACE</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-5"></a><span class="n">LETTER_SPACE</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-6"></a><span class="n">COMMA_SPACE</span> <span class="o">=</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-7"></a><span class="n">YEAR_PREFIX</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-8"></a>    <span class="n">DIGIT_SLASH</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-9"></a>    <span class="n">DIGIT_DASH</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-10"></a>    <span class="n">DIGIT_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-11"></a>    <span class="n">LETTER_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-12"></a>    <span class="n">COMMA_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-13"></a><span class="p">]))</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-14"></a>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-15"></a><span class="n">YEAR_ONLY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"year_only"</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-16"></a>                         <span class="n">YEAR_PREFIX</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-17"></a><span class="p">)</span>
</pre>
<p>These are leftovers that don't really match anything.</p>
<pre class="code ipython"><a name="rest_code_2255d8380ad6401cbe389a36a364eaff-1"></a><span class="n">IN_PREFIX</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'iI'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'n'</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-2"></a><span class="n">SINCE_PREFIX</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Ss"</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'ince'</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-3"></a><span class="n">AGE</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Age"</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-4"></a><span class="n">AGE_COMMA</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Age"</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-5"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'delivery'</span><span class="p">,</span> <span class="s2">"quit"</span><span class="p">,</span> <span class="s2">"attempt"</span><span class="p">,</span> <span class="s2">"nephrectomy"</span><span class="p">,</span> <span class="n">THREE_DIGITS</span><span class="p">]</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-6"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">OTHERS</span><span class="p">]</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-7"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OTHERS</span><span class="p">)</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-8"></a><span class="n">LEFTOVERS_PREFIX</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">IN_PREFIX</span><span class="p">,</span> <span class="n">SINCE_PREFIX</span><span class="p">,</span> <span class="n">AGE</span><span class="p">,</span> <span class="n">AGE_COMMA</span><span class="p">])</span> <span class="o">+</span> <span class="n">OR</span> <span class="o">+</span> <span class="n">OTHERS</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-9"></a><span class="n">LEFTOVERS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"leftovers"</span><span class="p">,</span> <span class="n">LEFTOVERS_PREFIX</span><span class="p">)</span>
</pre>
<p>This is the combined expression for all the dates - the one that should be used to extract them from the data.</p>
<pre class="code ipython"><a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-1"></a><span class="n">DATE</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">NUMERIC</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-2"></a>                                     <span class="n">TWENTIETH_CENTURY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-3"></a>                                     <span class="n">WORDS</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-4"></a>                                     <span class="n">BACKWARDS</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-5"></a>                                     <span class="n">CONTRACTION</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-6"></a>                                     <span class="n">NO_DAY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-7"></a>                                     <span class="n">NO_DAY_NUMERIC</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-8"></a>                                     <span class="n">YEAR_ONLY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-9"></a>                                     <span class="n">LEFTOVERS</span><span class="p">]))</span>
</pre>
<pre class="code ipython"><a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-1"></a><span class="k">def</span> <span class="nf">twentieth_century</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-2"></a>    <span class="sd">"""adds a 19 to the year</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-3"></a>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-5"></a><span class="sd">     date (re.Regex): Extracted date</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-6"></a><span class="sd">    """</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-7"></a>    <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-8"></a>    <span class="n">year</span> <span class="o">=</span> <span class="s2">"19{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-9"></a>    <span class="k">return</span> <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_6de3e020d2fb476caba774a582541806-1"></a><span class="k">def</span> <span class="nf">take_two</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-2"></a>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">TWENTIETH_CENTURY</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-3"></a>    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-4"></a>        <span class="k">return</span> <span class="n">twentieth_century</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-5"></a>    <span class="k">return</span> <span class="n">line</span>
</pre>
</div>
</div>
<div class="section" id="applying-the-grammer">
<h2>5 Applying The Grammer</h2>
<pre class="code ipython"><a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-1"></a><span class="k">def</span> <span class="nf">extract_and_count</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-2"></a>    <span class="sd">"""extract all matches and report the count</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-3"></a>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-5"></a><span class="sd">     expression (str): regular expression to match</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-6"></a><span class="sd">     data (pandas.Series): data with dates to extratc</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-7"></a><span class="sd">     name (str): name of the group for the expression</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-8"></a>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-10"></a><span class="sd">     tuple (pandas.Series, int): extracted dates, count</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-11"></a><span class="sd">    """</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-12"></a>    <span class="n">extracted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">expression</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-13"></a>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-14"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"'{}' matched {} rows"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-15"></a>    <span class="k">return</span> <span class="n">extracted</span><span class="p">,</span> <span class="n">count</span>
</pre>
<pre class="code ipython"><a name="rest_code_63aead1280094848a5ebbfe01e78cccf-1"></a><span class="n">numeric</span><span class="p">,</span> <span class="n">numeric_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NUMERIC</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'numeric'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'numeric' matched 25 rows
</pre>
<pre class="code ipython"><a name="rest_code_97322d2aec224ba7bbb9f48697b64d0b-1"></a><span class="n">twentieth</span><span class="p">,</span> <span class="n">twentieth_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">TWENTIETH_CENTURY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'twentieth'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'twentieth' matched 100 rows
</pre>
<pre class="code ipython"><a name="rest_code_ca85b3c6e1c44f678fd7d3101ed02935-1"></a><span class="n">words</span><span class="p">,</span> <span class="n">words_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">WORDS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'words'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'words' matched 34 rows
</pre>
<pre class="code ipython"><a name="rest_code_3c14eab4f1ab4f7d9914e4dc1d3aaac6-1"></a><span class="n">backwards</span><span class="p">,</span> <span class="n">backwards_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">BACKWARDS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'backwards'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'backwards' matched 69 rows
</pre>
<pre class="code ipython"><a name="rest_code_a146a4d183cf48039637b7d71611679a-1"></a><span class="n">contraction_data</span><span class="p">,</span> <span class="n">contraction</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">CONTRACTION</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'contraction'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'contraction' matched 0 rows
</pre>
<pre class="code ipython"><a name="rest_code_a72ab48d948d46be864df3b547f2b1d3-1"></a><span class="n">no_day</span><span class="p">,</span> <span class="n">no_day_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NO_DAY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'no_day'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'no_day' matched 115 rows
</pre>
<pre class="code ipython"><a name="rest_code_38ddb6bb04124a33baa4f3ee13bda526-1"></a><span class="n">no_day_numeric</span><span class="p">,</span> <span class="n">no_day_numeric_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NO_DAY_NUMERIC</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<a name="rest_code_38ddb6bb04124a33baa4f3ee13bda526-2"></a>                                                         <span class="s2">"no_day_numeric"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'no_day_numeric' matched 112 rows
</pre>
<pre class="code ipython"><a name="rest_code_328d16933ace4fb6b298976941bd57a9-1"></a><span class="n">year_only</span><span class="p">,</span> <span class="n">year_only_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">YEAR_ONLY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">"year_only"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'year_only' matched 15 rows
</pre>
<pre class="code ipython"><a name="rest_code_eb1ef7f0d59e496d942d099e9ca6aeda-1"></a><span class="n">leftovers</span><span class="p">,</span> <span class="n">leftovers_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">LEFTOVERS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">"leftovers"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'leftovers' matched 30 rows
</pre>
<pre class="code ipython"><a name="rest_code_3c2079d77eec447ea7842e050ebb187c-1"></a><span class="n">found</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DATE</span><span class="p">)</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-2"></a><span class="n">total_found</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-3"></a>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-4"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Total Found: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_found</span><span class="p">))</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-5"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Remaining: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">total_found</span><span class="p">))</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-6"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Discrepancy: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_found</span> <span class="o">-</span> <span class="p">(</span><span class="n">numeric_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-7"></a>                                              <span class="o">+</span> <span class="n">twentieth_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-8"></a>                                              <span class="o">+</span> <span class="n">words_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-9"></a>                                              <span class="o">+</span> <span class="n">backwards_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-10"></a>                                              <span class="o">+</span> <span class="n">contraction</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-11"></a>                                              <span class="o">+</span> <span class="n">no_day_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-12"></a>                                              <span class="o">+</span> <span class="n">no_day_numeric_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-13"></a>                                              <span class="o">+</span> <span class="n">year_only_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-14"></a>                                              <span class="o">+</span> <span class="n">leftovers_count</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
Total Found: 500
Remaining: 0
Discrepancy: 0
</pre>
<pre class="code ipython"><a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-1"></a><span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-2"></a><span class="k">try</span><span class="p">:</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-3"></a>    <span class="k">print</span><span class="p">(</span><span class="n">missing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-4"></a><span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-5"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"all rows matched"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
all rows matched
</pre>
</div>
<div class="section" id="unifying-the-formats">
<h2>6 Unifying the Formats</h2>
<p>To make it simpler, I'm going to use the <tt class="docutils literal">mm/dd/yyyy</tt> format for the dates. I'm going to use the extracted series to avoid having different clean-up cases contaminating each other - e.g. dealing with 'January' when the day comes first as opposed to when the month comes first.</p>
<div class="section" id="helper-functions">
<h3>6.1 Helper Functions</h3>
<div class="section" id="clean">
<h4>6.1.1 Clean</h4>
<p>This is a generic function to clean up some data. I was initially using it directly, but for cases where the expression and replacement function are used more than once, there are helper functions to make it easier.</p>
<pre class="code ipython"><a name="rest_code_26a70e05d01c41cc987bece031f5383d-1"></a><span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-2"></a>    <span class="sd">"""applies the replacement to the source</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-3"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-4"></a><span class="sd">    as a side-effect shows sample rows before and after</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-5"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-6"></a><span class="sd">    Args:</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-7"></a><span class="sd">     source (pandas.Series): source of the strings</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-8"></a><span class="sd">     expression (str): regular expression to match what to replace</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-9"></a><span class="sd">     replacement: function or expression to replace the matching expression</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-10"></a><span class="sd">     sample (int): number of randomly chosen examples to show</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-11"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-12"></a><span class="sd">    Returns:</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-13"></a><span class="sd">     pandas.Series: the source with the replacement applied to it</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-14"></a><span class="sd">    """</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-15"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Random Sample Before:"</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-16"></a>    <span class="k">print</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-17"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-18"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Sample After:"</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-19"></a>    <span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-20"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Count of cleaned: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-21"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-22"></a>    <span class="k">return</span> <span class="n">cleaned</span>
</pre>
</div>
<div class="section" id="clean-punctuation">
<h4>6.1.2 Clean Punctuation</h4>
<pre class="code ipython"><a name="rest_code_a48cfea51ef94f539affe06202de9df7-1"></a><span class="k">def</span> <span class="nf">clean_punctuation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-2"></a>    <span class="sd">"""removes punctuation</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-3"></a>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-4"></a><span class="sd">    Args:</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-5"></a><span class="sd">     source (pandas.Series): data to clean</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-6"></a><span class="sd">     sample (int): size of sample to show</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-7"></a>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-9"></a><span class="sd">     pandas.Series: source with punctuation removed</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-10"></a><span class="sd">    """</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-11"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Cleaning Punctuation"</span><span class="p">)</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-12"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">PUNCTUATION</span><span class="p">)):</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-13"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">PUNCTUATION</span><span class="p">,</span> <span class="n">EMPTY_STRING</span><span class="p">)</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-14"></a>    <span class="k">return</span> <span class="n">source</span>
</pre>
</div>
<div class="section" id="convert-long-month-names-to-three-letter-names">
<h4>6.1.3 Convert Long Month Names to Three-Letter Names</h4>
<pre class="code ipython"><a name="rest_code_4682e078636b4cfc87b46112d727633b-1"></a><span class="n">LONG_TO_SHORT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">January</span><span class="o">=</span><span class="s2">"Jan"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-2"></a>                     <span class="n">February</span><span class="o">=</span><span class="s2">"Feb"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-3"></a>                     <span class="n">March</span><span class="o">=</span><span class="s2">"Mar"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-4"></a>                     <span class="n">April</span><span class="o">=</span><span class="s2">"Apr"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-5"></a>                     <span class="n">May</span><span class="o">=</span><span class="s2">"May"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-6"></a>                     <span class="n">June</span><span class="o">=</span><span class="s2">"Jun"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-7"></a>                     <span class="n">July</span><span class="o">=</span><span class="s2">"Jul"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-8"></a>                     <span class="n">August</span><span class="o">=</span><span class="s2">"Aug"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-9"></a>                     <span class="n">September</span><span class="o">=</span><span class="s2">"Sep"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-10"></a>                     <span class="n">October</span><span class="o">=</span><span class="s2">"Oct"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-11"></a>                     <span class="n">November</span><span class="o">=</span><span class="s2">"Nov"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-12"></a>                     <span class="n">December</span><span class="o">=</span><span class="s2">"Dec"</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-13"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-14"></a><span class="c1"># it turns out there are spelling errors in the data so this has to be fuzzy</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-15"></a><span class="n">LONG_TO_SHORT_EXPRESSION</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-16"></a>                                    <span class="o">+</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-17"></a>                                    <span class="o">+</span> <span class="n">ZERO_OR_MORE</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-18"></a>                                    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">LONG_TO_SHORT</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-19"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-20"></a><span class="k">def</span> <span class="nf">long_month_to_short</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-21"></a>    <span class="sd">"""convert long month to short</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-22"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-23"></a><span class="sd">    Args:</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-24"></a><span class="sd">     match (re.Match): object matching a long month</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-25"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-26"></a><span class="sd">    Returns:</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-27"></a><span class="sd">     str: shortened version of the month</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-28"></a><span class="sd">    """</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-29"></a>    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">lastindex</span><span class="p">)</span>
</pre>
<p>This next function is the one you would actually use to make the conversion.</p>
<pre class="code ipython"><a name="rest_code_33736a1f662e47018e28cba7502b4452-1"></a><span class="k">def</span> <span class="nf">convert_long_months_to_short</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-2"></a>    <span class="sd">"""convert long month names to short</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-3"></a>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-4"></a><span class="sd">    Args:</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-5"></a><span class="sd">     source (pandas.Series): data with months</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-6"></a><span class="sd">     sample (int): size of sample to show</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-7"></a>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-9"></a><span class="sd">     pandas.Series: data with short months</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-10"></a><span class="sd">    """</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-12"></a>                 <span class="n">LONG_TO_SHORT_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-13"></a>                 <span class="n">long_month_to_short</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="add-january-1-to-year-only-dates">
<h4>6.1.4 Add January 1 to year-only dates</h4>
<pre class="code ipython"><a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-1"></a><span class="k">def</span> <span class="nf">add_month_date</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-2"></a>    <span class="sd">"""adds 01/01 to years</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-3"></a>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-4"></a><span class="sd">    Args:</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-5"></a><span class="sd">     match (re.Match): object that only matched a 4-digit year</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-6"></a>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-8"></a><span class="sd">     str: 01/01/YYYY</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-9"></a><span class="sd">    """</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-10"></a>    <span class="k">return</span> <span class="s2">"01/01/"</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre>
<p>And now the function to actually call.</p>
<pre class="code ipython"><a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-1"></a><span class="k">def</span> <span class="nf">add_january_one</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-2"></a>    <span class="sd">"""adds /01/01/ to year-only dates</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-3"></a>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-4"></a><span class="sd">    Args:</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-5"></a><span class="sd">     source (pandas.Series): data with the dates</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-6"></a>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-8"></a><span class="sd">     pandas.Series: years in source with /01/01/ added</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-9"></a><span class="sd">    """</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-10"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">YEAR_ONLY</span><span class="p">,</span> <span class="n">add_month_date</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="two-digit-numbers">
<h4>6.1.5 Two-Digit Numbers</h4>
<p>This makes sure that there are exactly two digits in a number, adding a leading zero if needed.</p>
<pre class="code ipython"><a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-1"></a><span class="n">two_digit_expression</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">)</span> <span class="o">+</span> <span class="n">POSITIVE_LOOKAHEAD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-2"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-3"></a><span class="k">def</span> <span class="nf">two_digits</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-4"></a>    <span class="sd">"""add a leading zero if needed</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-5"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-6"></a><span class="sd">    Args:</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-7"></a><span class="sd">     match (re.Match): match with one or two digits</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-8"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-10"></a><span class="sd">     str: the matched string with leading zero if needed</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-11"></a><span class="sd">    """</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-12"></a>    <span class="c1"># for some reason the string-formatting raises an error if it's a string</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-13"></a>    <span class="c1"># so cast it to an int</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-14"></a>    <span class="k">return</span> <span class="s2">"{:02}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>
</pre>
<p>This is the function to call for the case where the number is followed by a slash (e.g. <tt class="docutils literal">2/</tt>).</p>
<pre class="code ipython"><a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-1"></a><span class="k">def</span> <span class="nf">clean_two_digits</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-2"></a>    <span class="sd">"""makes sure source has two-digits</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-3"></a>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-4"></a><span class="sd">    Args:</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-5"></a><span class="sd">     source (pandas.Series): data with digit followed by slash</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-7"></a>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-9"></a><span class="sd">     pandas.Series: source with digits coerced to two digits</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-10"></a><span class="sd">    """</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">two_digit_expression</span><span class="p">,</span> <span class="n">two_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre>
<p>This is like <tt class="docutils literal">clean_two_digits</tt> but it doesn't check for the trailing slash. Use this if you have an isolated column of numbers that need to be two-digits.</p>
<pre class="code ipython"><a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-1"></a><span class="k">def</span> <span class="nf">clean_two_digits_isolated</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-2"></a>    <span class="sd">"""cleans two digits that are standalone</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-3"></a>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-5"></a><span class="sd">     source (pandas.Series): source of the data</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-7"></a>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-9"></a><span class="sd">     pandas.Series: converted data</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-10"></a><span class="sd">    """</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span> <span class="n">two_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="cleaning-up-months">
<h4>6.1.6 Cleaning Up Months</h4>
<p>These clean up and convert written months (e.g. change <tt class="docutils literal">Aug</tt> to <tt class="docutils literal">08</tt>).</p>
<pre class="code ipython"><a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-1"></a><span class="n">digits</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"{:02}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-2"></a><span class="n">MONTH_TO_DIGITS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">MONTH_PREFIXES</span><span class="p">,</span> <span class="n">digits</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-3"></a><span class="n">SHORT_MONTHS_EXPRESSION</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTH_TO_DIGITS</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-4"></a><span class="k">def</span> <span class="nf">month_to_digits</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-5"></a>    <span class="sd">"""converts short month to digits</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-6"></a>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-7"></a><span class="sd">    Args:</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-8"></a><span class="sd">     match (re.Match): object with short-month</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-9"></a>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-10"></a><span class="sd">    Returns:</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-11"></a><span class="sd">     str: month as two-digit number (e.g. Jan -&gt; 01)</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-12"></a><span class="sd">    """</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-13"></a>    <span class="k">return</span> <span class="n">MONTH_TO_DIGITS</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()]</span>
</pre>
<pre class="code ipython"><a name="rest_code_6073b8397d994280aad16a5dc7c7943e-1"></a><span class="k">def</span> <span class="nf">convert_short_month_to_digits</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-2"></a>    <span class="sd">"""converts three-letter months to two-digits</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-3"></a>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-5"></a><span class="sd">     source (pandas.Series): data with three-letter months</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-7"></a>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-9"></a><span class="sd">     pandas.Series: source with short-months coverted to digits</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-10"></a><span class="sd">    """</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-12"></a>                 <span class="n">SHORT_MONTHS_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-13"></a>                 <span class="n">month_to_digits</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-14"></a>                 <span class="n">sample</span><span class="p">)</span>
</pre>
<p>This function runs the previous three and is the main one that should be used. The others can be run individually for troubleshooting, though.</p>
<pre class="code ipython"><a name="rest_code_c7fb3254c651489e904705f74c039fe8-1"></a><span class="k">def</span> <span class="nf">clean_months</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-2"></a>    <span class="sd">"""clean up months (which start as words)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-3"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-5"></a><span class="sd">     source (pandas.Series): source of the months</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-6"></a><span class="sd">     sample (int): number of random samples to show</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-7"></a><span class="sd">    """</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-8"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean_punctuation</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-9"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-10"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Converting long months to short"</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-11"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-12"></a>                    <span class="n">LONG_TO_SHORT_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-13"></a>                    <span class="n">long_month_to_short</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-14"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-15"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Converting short months to digits"</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-16"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-17"></a>                    <span class="n">SHORT_MONTHS_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-18"></a>                    <span class="n">month_to_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-19"></a>    <span class="k">return</span> <span class="n">cleaned</span>
</pre>
</div>
<div class="section" id="frame-to-series">
<h4>6.1.7 Frame To Series</h4>
<p>This is for the case where the date-fields were broken up into columns in a data-frame.</p>
<pre class="code ipython"><a name="rest_code_37f92571504c45af80c86f9c60aff53e-1"></a><span class="k">def</span> <span class="nf">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">index_source</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-2"></a>    <span class="sd">"""re-combines data-frame into a series</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-3"></a>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-5"></a><span class="sd">     frame (pandas.DataFrame): frame with month, day, year columns</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-6"></a><span class="sd">     index_source (pandas.series): source to copy index from</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-7"></a><span class="sd">     samples (index): number of random entries to print when done</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-8"></a>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-10"></a><span class="sd">     pandas.Series: series with dates as month/day/year</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-11"></a><span class="sd">    """</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-12"></a>    <span class="n">combined</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="n">SLASH</span> <span class="o">+</span> <span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">+</span> <span class="n">SLASH</span> <span class="o">+</span> <span class="n">frame</span><span class="o">.</span><span class="n">year</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-13"></a>    <span class="n">combined</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_source</span><span class="o">.</span><span class="n">index</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-14"></a>    <span class="k">print</span><span class="p">(</span><span class="n">combined</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-15"></a>    <span class="k">return</span> <span class="n">combined</span>
</pre>
</div>
</div>
<div class="section" id="year-only">
<h3>6.2 Year Only</h3>
<p>For the case where there is only a year, I'll add January 1 to the dates.</p>
<pre class="code ipython"><a name="rest_code_278f53251fdb4fc68b34e046c70b6a34-1"></a><span class="n">year_only_cleaned</span> <span class="o">=</span> <span class="n">add_january_one</span><span class="p">(</span><span class="n">year_only</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
472  0        2010
495  0        1979
497  0        2008
481  0        1974
486  0        1973
Name: year_only, dtype: object

Random Sample After:
     match
495  0        01/01/1979
470  0        01/01/1983
462  0        01/01/1988
481  0        01/01/1974
480  0        01/01/2013
Name: year_only, dtype: object

Count of cleaned: 15
</pre>
</div>
<div class="section" id="leftovers">
<h3>6.3 Leftovers</h3>
<p>These were the odd cases that didn't seem to have a real pattern. Since I used a positive lookbehind to match everything but the year they only have the years in them, like the previous year-only cases.</p>
<pre class="code ipython"><a name="rest_code_a7b366fae7df44e6b69648ba1bfffdf2-1"></a><span class="n">leftovers_cleaned</span> <span class="o">=</span> <span class="n">add_january_one</span><span class="p">(</span><span class="n">leftovers</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
487  0        1992
477  0        1994
498  0        2005
488  0        1977
484  0        2004
Name: leftovers, dtype: object

Random Sample After:
     match
464  0        01/01/2016
455  0        01/01/1984
465  0        01/01/1976
475  0        01/01/2015
498  0        01/01/2005
Name: leftovers, dtype: object

Count of cleaned: 30
</pre>
<pre class="code ipython"><a name="rest_code_a8ed56d0d0a94b23a883c68d0de11a23-1"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">year_only_cleaned</span><span class="p">,</span> <span class="n">leftovers_cleaned</span><span class="p">])</span>
<a name="rest_code_a8ed56d0d0a94b23a883c68d0de11a23-2"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
45
</pre>
</div>
<div class="section" id="no-day-numeric">
<h3>6.4 No Day Numeric</h3>
<p>This is for the case where the date is formatted with slashes and there are no day-values. To make the months uniform I'm going to make them all two-digits first.</p>
<pre class="code ipython"><a name="rest_code_4b9fb0f5efe2443fa421f624443f9079-1"></a><span class="n">no_day_numeric_cleaned</span> <span class="o">=</span> <span class="n">clean_two_digits</span><span class="p">(</span><span class="n">no_day_numeric</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
450  0         1/1994
374  0        11/2000
403  0        10/1981
454  0         7/1982
358  0         1/1983
Name: no_day_numeric, dtype: object

Random Sample After:
     match
426  0        11/1984
415  0        02/1973
360  0        12/2008
367  0        09/2001
362  0        08/2003
Name: no_day_numeric, dtype: object

Count of cleaned: 112
</pre>
<p>Now I'll add the day.</p>
<pre class="code ipython"><a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-1"></a><span class="n">no_day_numeric_cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">no_day_numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-2"></a>                               <span class="n">SLASH</span><span class="p">,</span>
<a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-3"></a>                               <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s2">"/01/"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
368  0        08/1986
409  0        10/1994
443  0        09/2000
404  0        10/1986
395  0        02/1977
Name: no_day_numeric, dtype: object

Random Sample After:
     match
349  0        05/01/1987
392  0        05/01/2000
448  0        05/01/2010
394  0        10/01/2001
424  0        04/01/1979
Name: no_day_numeric, dtype: object

Count of cleaned: 112
</pre>
<p>And add it to the total.</p>
<pre class="code ipython"><a name="rest_code_c186131450e34793996aefde3d7e33e5-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_c186131450e34793996aefde3d7e33e5-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">no_day_numeric_cleaned</span><span class="p">])</span>
<a name="rest_code_c186131450e34793996aefde3d7e33e5-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">no_day_numeric_count</span> <span class="o">+</span> <span class="n">original</span>
</pre>
<pre class="code ipython"><a name="rest_code_3df8414b6ae0412494fc2d475c208687-1"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
157
</pre>
</div>
<div class="section" id="no-day">
<h3>6.5 No Day</h3>
<p>This is for cases like <em>Mar 2011</em> where no day was given. We're going to assume that it's the first day of the month for each case.</p>
<pre class="code ipython"><a name="rest_code_5ec35e8477ed4b75b14b1acea8d730f5-1"></a><span class="n">no_day_cleaned</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">no_day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
     match
261  0           Oct 1986
269  0          July 1992
280  0          July 1985
295  0         March 1983
339  0        March, 2005
Name: no_day, dtype: object

Random Sample After:
     match
228  0        September 1985
304  0              Mar 2002
253  0              Feb 2016
276  0            April 1986
272  0              Feb 1993
Name: no_day, dtype: object

Count of cleaned: 115
Converting long months to short
Random Sample Before:
     match
315  0             Jun 1976
242  0             Nov 2010
237  0        February 1976
330  0           April 1988
311  0        February 1995
Name: no_day, dtype: object

Random Sample After:
     match
306  0        May 2004
254  0        Aug 1979
269  0        Jul 1992
337  0        Dec 2007
241  0        May 2004
Name: no_day, dtype: object

Count of cleaned: 115
Converting short months to digits
Random Sample Before:
     match
268  0        Dec 2009
298  0        Jan 1993
296  0        Aug 1979
270  0        May 2006
320  0        Nov 2012
Name: no_day, dtype: object

Random Sample After:
     match
246  0        07 1981
286  0        01 2013
263  0        09 1981
276  0        04 1986
247  0        05 1983
Name: no_day, dtype: object

Count of cleaned: 115
</pre>
<p>Now we need to replace the spaces with the days.</p>
<pre class="code ipython"><a name="rest_code_e4c4257b864944be9a3724ac6b376a64-1"></a><span class="n">no_day_cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">no_day_cleaned</span><span class="p">,</span>
<a name="rest_code_e4c4257b864944be9a3724ac6b376a64-2"></a>                       <span class="n">SPACE</span> <span class="o">+</span> <span class="n">ONE_OR_MORE</span><span class="p">,</span>
<a name="rest_code_e4c4257b864944be9a3724ac6b376a64-3"></a>                       <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">"/01/"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
251  0        12 1998
290  0        12 2011
281  0        08 2004
308  0        02 1994
294  0        02 1983
Name: no_day, dtype: object

Random Sample After:
     match
304  0        03/01/2002
332  0        06/01/1974
310  0        10/01/1992
293  0        09/01/2008
322  0        10/01/1991
Name: no_day, dtype: object

Count of cleaned: 115
</pre>
<p>Now we can add it to the cleaned.</p>
<pre class="code ipython"><a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">no_day_cleaned</span><span class="p">])</span>
<a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-3"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
272
</pre>
<p>Now to make sure we're where we expect we are.</p>
<pre class="code ipython"><a name="rest_code_4af27b29ecac455da3c4e0d31c8d711b-1"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">no_day_count</span> <span class="o">+</span> <span class="n">original</span>
</pre>
</div>
<div class="section" id="contraction">
<h3>6.6 Contraction</h3>
<p>There were no matches for the contraction so I'll ignore it for now.</p>
</div>
<div class="section" id="backwards">
<h3>6.7 Backwards</h3>
<p>This is the case where the day comes first. The first thing I'll do is split them up.</p>
<pre class="code ipython"><a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">backwards</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="s2">"day month year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-3"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  day month  year
0  24   Jan  2001
1  10   Sep  2004
2  26   May  1982
3  28  June  2002
4  06   May  1972
</pre>
<p>The next thing to do is to make sure the days all have two digits.</p>
<pre class="code ipython"><a name="rest_code_f6072f0515ec436a8714027b631047f4-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
31    26
39    21
4     06
57    13
36    19
Name: day, dtype: object

Random Sample After:
29    06
68    18
60    17
11    11
26    22
Name: day, dtype: object

Count of cleaned: 69
</pre>
<p>Next comes the months. This is basically the same problem as with the <em>no day</em> case so I'll re-use some of the code for that.</p>
<pre class="code ipython"><a name="rest_code_ab05fe73da44414cb294eb9f3502501c-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Converting long months to short
Random Sample Before:
55    Dec
41    Nov
38    Jan
54    Dec
5     Oct
Name: month, dtype: object

Random Sample After:
30    Oct
55    Dec
15    Feb
38    Jan
14    Oct
Name: month, dtype: object

Count of cleaned: 69
Converting short months to digits
Random Sample Before:
29    Mar
22    May
45    Jan
47    Aug
61    Oct
Name: month, dtype: object

Random Sample After:
16    05
32    02
4     05
68    01
38    01
Name: month, dtype: object

Count of cleaned: 69
</pre>
<p>Now we need to combine them back together. In hindsight it might have been easier to convert everything into data frames instead of the other way around. Or maybe not. Since we want the indexes from the original data as our final answer I also have to copy the index from the original series</p>
<pre class="code ipython"><a name="rest_code_62fe0d46ed274e2db3053d05f493ef5e-1"></a><span class="n">backwards_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">backwards</span><span class="p">)</span>
</pre>
<pre class="literal-block">
     match
177  0        01/18/1990
128  0        06/28/2002
181  0        08/18/1995
158  0        08/23/2000
185  0        08/17/1985
dtype: object
</pre>
<p>No it gets added to the combined series.</p>
<pre class="code ipython"><a name="rest_code_555c71acd16b47558ef5c9c343044db5-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_555c71acd16b47558ef5c9c343044db5-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">backwards_cleaned</span><span class="p">])</span>
<a name="rest_code_555c71acd16b47558ef5c9c343044db5-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">backwards_count</span>
</pre>
<pre class="code ipython"><a name="rest_code_69e8faeacd0a4beaabb211af9573f40d-1"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
341
</pre>
</div>
<div class="section" id="words">
<h3>6.8 Words</h3>
<p>Since working with the data frame was easier than I though it would be I'll do that again.</p>
<pre class="code ipython"><a name="rest_code_7ba9ad608ca44fea9db0387aea288678-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"month day year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_7ba9ad608ca44fea9db0387aea288678-2"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
      month  day  year
0     April  11,  1990
1       May  30,  2001
2       Feb  18,  1994
3  February  18,  1981
4  October.  11,  2013
</pre>
<p>First we'll clean out the months.</p>
<pre class="code ipython"><a name="rest_code_d0f876a0c5d545248054176fe3b11a12-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
25          Dec
10         Mar.
17        April
14    September
0         April
Name: month, dtype: object

Random Sample After:
5         Jan
12    October
24        May
2         Feb
28        May
Name: month, dtype: object

Count of cleaned: 34
Converting long months to short
Random Sample Before:
11       Jan
13    August
20       Sep
6       July
17     April
Name: month, dtype: object

Random Sample After:
27    Oct
30    Jul
6     Jul
14    Sep
33    Sep
Name: month, dtype: object

Count of cleaned: 34
Converting short months to digits
Random Sample Before:
24    May
31    Jun
5     Jan
7     Dec
32    Jan
Name: month, dtype: object

Random Sample After:
15    07
12    10
1     05
30    07
21    08
Name: month, dtype: object

Count of cleaned: 34
</pre>
<p>Now we'll clean up the punctuation for the days.</p>
<pre class="code ipython"><a name="rest_code_403a8eaa61c148c3b75b879c020e4983-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_punctuation</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
22    11,
13     12
29     14
16    11,
24    14,
Name: day, dtype: object

Random Sample After:
2     18
1     30
24    14
15    25
17    17
Name: day, dtype: object

Count of cleaned: 34
</pre>
<p>So, what do we have so far?</p>
<pre class="code ipython"><a name="rest_code_fb060e1e44ad4b8aaa75fed980e99703-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  month day  year
0    04  11  1990
1    05  30  2001
2    02  18  1994
3    02  18  1981
4    10  11  2013
</pre>
<p>At this point we need to combine everything with a slash and restore the index.</p>
<pre class="code ipython"><a name="rest_code_fa253b729078464694a8162277a81f8f-1"></a><span class="n">words_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
</pre>
<pre class="literal-block">
     match
194  0        04/11/1990
217  0        06/13/2011
209  0        07/25/1983
216  0        11/11/1988
223  0        10/14/1974
dtype: object
</pre>
<p>Now we'll add it to the total.</p>
<pre class="code ipython"><a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">words_cleaned</span><span class="p">])</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">words_count</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-4"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
375
</pre>
</div>
<div class="section" id="twentieth-century">
<h3>6.9 Twentieth Century</h3>
<p>We'll do the same trick with creating a dataframe. The first thing, though, is to replace the dashes with slashes.</p>
<pre class="code ipython"><a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-1"></a><span class="k">print</span><span class="p">(</span><span class="n">twentieth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
<a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-2"></a><span class="n">twentieth_cleaned</span> <span class="o">=</span> <span class="n">twentieth</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">DASH</span><span class="p">,</span> <span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-3"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
</pre>
<pre class="literal-block">
4-13-82
01/01/1991
</pre>
<p>Now, we'll create the frame.</p>
<pre class="code ipython"><a name="rest_code_4be7ee2936874cd4b245d919e12856ce-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">twentieth_cleaned</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_4be7ee2936874cd4b245d919e12856ce-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">])</span>
<a name="rest_code_4be7ee2936874cd4b245d919e12856ce-3"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
  month day year
0    03  25   93
1     6  18   85
2     7   8   71
3     9  27   75
4     2   6   96
</pre>
<div class="section" id="months">
<h4>6.9.1 Months</h4>
<p>The months need to be converted to two-digits.</p>
<pre class="code ipython"><a name="rest_code_4dc97efa0ae94a2d8a2474ed70e57c53-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
73     4
53    10
84     8
93     6
80    10
Name: month, dtype: object

Random Sample After:
76    03
33    07
32    01
94    07
67    05
Name: month, dtype: object

Count of cleaned: 100
</pre>
<p>As do the days.</p>
<pre class="code ipython"><a name="rest_code_5389733c16244c0b97ca473d67c73a35-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
78    14
29    15
37    15
75    18
80    05
Name: day, dtype: object

Random Sample After:
35    14
30    14
17    21
88    16
0     25
Name: day, dtype: object

Count of cleaned: 100
</pre>
<pre class="code ipython"><a name="rest_code_a3e1f85c163e4d8da80c2fb1af92bb61-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  month day year
0    03  25   93
1    06  18   85
2    07  08   71
3    09  27   75
4    02  06   96
</pre>
<p>Now we have to add <tt class="docutils literal">19</tt> to each of the years.</p>
<pre class="code ipython"><a name="rest_code_4ac655e89dc64840aa093c1acfbc915c-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">TWO_DIGITS</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">"19"</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</pre>
<pre class="literal-block">
Random Sample Before:
41    75
90    97
97    90
69    97
65    81
Name: year, dtype: object

Random Sample After:
4     1996
44    1971
11    1975
17    1998
61    1979
Name: year, dtype: object

Count of cleaned: 100
</pre>
<p>Now we have to join them back up.</p>
<pre class="code ipython"><a name="rest_code_8baf04995baa452ba852a7b93dc2fb0a-1"></a><span class="n">twentieth_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">twentieth</span><span class="p">)</span>
</pre>
<pre class="literal-block">
    match
67  0        07/06/1991
88  0        12/08/1982
4   0        02/06/1996
40  0        07/29/1975
72  0        07/11/1977
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_1d503b332f6e4822a51f526d131a35c7-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_1d503b332f6e4822a51f526d131a35c7-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">twentieth_cleaned</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_59162f44789846f0a3a07c733a932da6-1"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">twentieth_count</span>
</pre>
</div>
</div>
<div class="section" id="numeric">
<h3>6.10 Numeric</h3>
<p>The final category is dates with the format <tt class="docutils literal">mm/dd/yyyy</tt>.</p>
<pre class="code ipython"><a name="rest_code_2f9ce5575b0f482bb132ce984d804e2b-1"></a><span class="k">print</span><span class="p">(</span><span class="n">numeric</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
14  0         5/24/1990
15  0         1/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
Name: numeric, dtype: object
</pre>
<p>We should check and make sure there are no dashes here.</p>
<pre class="code ipython"><a name="rest_code_cc4af49c73084dd0a3aca73e6fb07ed7-1"></a><span class="n">has_dashes</span> <span class="o">=</span> <span class="n">numeric</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">DASH</span><span class="p">)</span>
<a name="rest_code_cc4af49c73084dd0a3aca73e6fb07ed7-2"></a><span class="k">print</span><span class="p">(</span><span class="n">numeric</span><span class="p">[</span><span class="n">has_dashes</span><span class="p">])</span>
</pre>
<pre class="literal-block">
Series([], Name: numeric, dtype: object)
</pre>
<p>It looks like it doesn't so we'll skip this check.</p>
<pre class="code ipython"><a name="rest_code_c49525c65d3c47f086c390e1a05429ea-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">numeric</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_c49525c65d3c47f086c390e1a05429ea-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="s2">"month day year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_c49525c65d3c47f086c390e1a05429ea-3"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
  month day  year
0     5  24  1990
1     1  25  2011
2    10  13  1976
3    07  25  1984
4    03  31  1985
</pre>
<pre class="code ipython"><a name="rest_code_a007c13ce32a4311ae0b9a94b7f6e539-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
5      5
18    04
4     03
0      5
10    12
Name: month, dtype: object

Random Sample After:
0     05
24    04
3     07
11    08
13    11
Name: month, dtype: object

Count of cleaned: 25
</pre>
<pre class="code ipython"><a name="rest_code_71afd6cc3e404c2fba4a7edccec5e061-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
9     11
19    08
8     15
13     3
24    27
Name: day, dtype: object

Random Sample After:
23    20
22    11
7     13
18    08
0     24
Name: day, dtype: object

Count of cleaned: 25
</pre>
<pre class="code ipython"><a name="rest_code_c6874e85b6eb4167992d86cda4fd4879-1"></a><span class="n">numeric_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">numeric</span><span class="p">)</span>
</pre>
<pre class="literal-block">
    match
94  0        12/08/1990
92  0        04/08/2004
43  0        04/13/2002
38  0        07/27/1986
14  0        05/24/1990
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_3389eacbbc4045a8b83c74e93f999331-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">numeric_cleaned</span><span class="p">])</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">numeric_count</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-4"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
500
</pre>
<p>At this point it looks like we've cleaned all the cases.</p>
</div>
<div class="section" id="re-combining-the-cleaned">
<h3>6.11 Re-combining The Cleaned</h3>
<p>Because these notebooks can execute things out of order I'm going to create one monolithic concatenation and ignore the one that I was using to keep the running total.</p>
<pre class="code ipython"><a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-1"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-2"></a>                         <span class="n">twentieth_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-3"></a>                         <span class="n">words_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-4"></a>                         <span class="n">backwards_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-5"></a>                         <span class="n">no_day_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-6"></a>                         <span class="n">no_day_numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-7"></a>                         <span class="n">year_only_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-8"></a>                         <span class="n">leftovers_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-9"></a><span class="p">])</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-10"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-11"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-12"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<pre class="literal-block">
500
    match
14  0        05/24/1990
15  0        01/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
dtype: object
</pre>
</div>
</div>
<div class="section" id="convert-to-datetimes">
<h2>7 Convert to Datetimes</h2>
<pre class="code ipython"><a name="rest_code_957b32bad7d440c5b5dd381de14cd546-1"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<a name="rest_code_957b32bad7d440c5b5dd381de14cd546-2"></a><span class="n">datetimes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/</span><span class="si">%d</span><span class="s2">/%Y"</span><span class="p">)</span>
<a name="rest_code_957b32bad7d440c5b5dd381de14cd546-3"></a><span class="k">print</span><span class="p">(</span><span class="n">datetimes</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
14  0        05/24/1990
15  0        01/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
dtype: object
    match
14  0       1990-05-24
15  0       2011-01-25
17  0       1976-10-13
24  0       1984-07-25
30  0       1985-03-31
dtype: datetime64[ns]
</pre>
<pre class="code ipython"><a name="rest_code_647ff9a60a1a4f69bb41e1bf0924139b-1"></a><span class="n">sorted_dates</span> <span class="o">=</span> <span class="n">datetimes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<a name="rest_code_647ff9a60a1a4f69bb41e1bf0924139b-2"></a><span class="k">print</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
9   0       1971-04-10
84  0       1971-05-18
2   0       1971-07-08
53  0       1971-07-11
28  0       1971-09-12
dtype: datetime64[ns]
</pre>
<pre class="code ipython"><a name="rest_code_3176215c31b3415397607142ecb2f364-1"></a><span class="k">print</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre>
<pre class="literal-block">
     match
231  0       2016-05-01
141  0       2016-05-30
186  0       2016-10-13
161  0       2016-10-19
413  0       2016-11-01
dtype: datetime64[ns]
</pre>
<p>The grader wants a Series with the indices of the original data put in the order of the sorted dates.</p>
<pre class="code ipython"><a name="rest_code_8b1ec468304743d9af86de787065a82d-1"></a><span class="n">answer</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_8b1ec468304743d9af86de787065a82d-2"></a><span class="k">print</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
0     9
1    84
2     2
3    53
4    28
dtype: int16
</pre>
</div>
<div class="section" id="the-date-sorter-function">
<h2>8 The date_sorter Function</h2>
<p>This is the function called by the grader. Since the work was done outside of it we just need to make sure that it returns our answer.</p>
<pre class="code ipython"><a name="rest_code_9d14237f12654a98b9d9dd249ad4bb2f-1"></a><span class="k">def</span> <span class="nf">date_sorter</span><span class="p">():</span>
<a name="rest_code_9d14237f12654a98b9d9dd249ad4bb2f-2"></a>    <span class="k">return</span> <span class="n">answer</span>
</pre>
<p><strong>note:</strong> This produced a 94% score, so there are still some cases not correctly handled.</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/regularexpressions/" rel="tag">regularexpressions</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../evaluating-a-model/" rel="prev" title="Evaluating a Model">Previous post</a>
            </li>
            <li class="next">
                <a href="../assignment-2-introduction-to-nltk/" rel="next" title="Assignment 2 - Introduction to NLTK">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents  2017         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
