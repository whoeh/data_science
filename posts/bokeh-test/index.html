<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A test of using bokeh in a post.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bokeh Test | Data Science With Python</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/posts/bokeh-test/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script><meta name="author" content="necromuralist">
<link rel="prev" href="../assignment-4/" title="Assignment 4" type="text/html">
<link rel="next" href="../predicting-cancer/" title="Predicting Cancer (Course 3, Assignment 1)" type="text/html">
<meta property="og:site_name" content="Data Science With Python">
<meta property="og:title" content="Bokeh Test">
<meta property="og:url" content="https://necromuralist.github.io/data_science/posts/bokeh-test/">
<meta property="og:description" content="A test of using bokeh in a post.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-24T12:29:09-07:00">
<meta property="article:tag" content="bokeh plotting">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Data Science With Python</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu"><li>
<a href="../../pages/portland-unemployment-2007-to-2017">Portland Unemployment Visualization</a>
            </li></ul>
</li>
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.rst" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Bokeh Test</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    necromuralist
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-05-24T12:29:09-07:00" itemprop="datePublished" title="2017-05-24 12:29">2017-05-24 12:29</time></a></p>
            
        <p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="section" id="the-plot">
<h2>The Plot</h2>
<script src="portland_unemployment.js" id="686c5dd6-168a-4f7d-acbc-524875d93b59" data-bokeh-model-id="c473232a-dc2c-4b75-988c-f9bc6517b4b9" data-bokeh-doc-id="402d8e3c-1595-4d65-9f76-e11068c629ab"></script>
</div>
<div class="section" id="what-this-is">
<h2>What This Is</h2>
<p>This is a re-do of the final plot done for data-science with python course 2 week 4. The original was done with matplotlib and this was done with bokeh to get some interaction working. When I tried to create it the first time bokeh raised some errors saying that <tt class="docutils literal">height</tt> had been defined more than once. I don't know what really caused it - possibly a namespace clash where I was re-using something I didn't intend to re-use - but when I created a new notebook that only created the one plot it worked. Since this uses javascript I used Jupyter and the web-inteface to test it out (emacs ipython doesn't seem to be able to render javascript (unless I'm doing it wrong)).</p>
</div>
<div class="section" id="how-it-got-exported">
<h2>How It Got Exported</h2>
<p>I won't go over the creating of the data (since I just copied it from an earlier notebook) but this is how the bokeh plot was created.</p>
<div class="section" id="imports">
<h3>Imports</h3>
<p>These were the bokeh parts I needed.</p>
<pre class="code python"><a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-1"></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-2"></a>    <span class="n">BoxAnnotation</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-3"></a>    <span class="n">CustomJS</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-4"></a>    <span class="n">Span</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-5"></a>    <span class="n">Toggle</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-6"></a><span class="p">)</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-7"></a>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-8"></a><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-9"></a>    <span class="n">output_file</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-10"></a>    <span class="n">output_notebook</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-11"></a>    <span class="n">show</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-12"></a><span class="p">)</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-13"></a>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-14"></a><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-15"></a>    <span class="n">figure</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-16"></a>    <span class="n">ColumnDataSource</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-17"></a> <span class="p">)</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-18"></a>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-19"></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-20"></a>    <span class="n">CrosshairTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-21"></a>    <span class="n">HoverTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-22"></a>    <span class="n">PanTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-23"></a>    <span class="n">ResetTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-24"></a>    <span class="n">ResizeTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-25"></a>    <span class="n">SaveTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-26"></a>    <span class="n">UndoTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-27"></a>    <span class="n">WheelZoomTool</span><span class="p">,</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-28"></a>    <span class="p">)</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-29"></a>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-30"></a><span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">column</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-31"></a><span class="kn">from</span> <span class="nn">bokeh.resources</span> <span class="kn">import</span> <span class="n">CDN</span>
<a name="rest_code_4872286a792f4278a91a6d1dfc2eabf5-32"></a><span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">autoload_static</span>
</pre>
</div>
<div class="section" id="some-constants">
<h3>Some Constants</h3>
<pre class="code python"><a name="rest_code_53167cecf4734989bb3d75da2cd77a69-1"></a><span class="n">NATIONAL_COLOR</span> <span class="o">=</span> <span class="s2">"slategrey"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-2"></a><span class="n">NATIONAL_LABEL</span> <span class="o">=</span> <span class="s2">"National"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-3"></a><span class="n">PORTLAND_COLOR</span> <span class="o">=</span> <span class="s2">"cornflowerblue"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-4"></a><span class="n">PORTLAND_LABEL</span> <span class="o">=</span> <span class="s2">"Portland-Hillsboro-Vancouver"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-5"></a><span class="n">S_AND_P_COLOR</span> <span class="o">=</span> <span class="s2">"#90151B"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-6"></a><span class="n">S_AND_P_LABEL</span> <span class="o">=</span> <span class="s2">"S &amp; P 500 Index"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-7"></a><span class="n">HOUSING_COLOR</span> <span class="o">=</span> <span class="s2">"#D89159"</span>
<a name="rest_code_53167cecf4734989bb3d75da2cd77a69-8"></a><span class="n">HOUSING_LABEL</span> <span class="o">=</span> <span class="s2">"House Price Index"</span>
</pre>
</div>
<div class="section" id="the-data">
<h3>The Data</h3>
<p><tt class="docutils literal">bokeh</tt> doesn't work with <tt class="docutils literal">pandas</tt> <tt class="docutils literal">DataFrame</tt>'s (or at least I couldn't get it to work). Instead you create a DataFrame-like object using the <tt class="docutils literal">ColumnDataSource</tt>.</p>
<pre class="code python"><a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-1"></a><span class="n">portland_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-2"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-3"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-4"></a>        <span class="n">unemployment</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">unemployment_rate</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-5"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-6"></a>        <span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-7"></a><span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-8"></a>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-9"></a><span class="n">national_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-10"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-11"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-12"></a>        <span class="n">unemployment</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">unemployment_rate</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-13"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-14"></a>        <span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-15"></a>    <span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-16"></a>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-17"></a><span class="n">housing_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-18"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-19"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">house_price_index</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-20"></a>        <span class="n">price</span><span class="o">=</span><span class="n">house_price_index</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-21"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-22"></a>        <span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-23"></a>    <span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-24"></a>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-25"></a><span class="n">s_and_p_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-26"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-27"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-28"></a>        <span class="n">value</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">VALUE</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-29"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-30"></a>        <span class="p">)</span>
<a name="rest_code_03ec3c3fc10348f88812c5dfa5ccd108-31"></a><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-tools">
<h3>The Tools</h3>
<p>These are the things that add interactivity to the plot. You have to create new ones for each figure so I made a function to get them.</p>
<pre class="code python"><a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-1"></a><span class="k">def</span> <span class="nf">make_tools</span><span class="p">():</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-2"></a>    <span class="sd">"""makes the tools for the figures</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-3"></a>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-5"></a><span class="sd">     list: tool objects</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-6"></a><span class="sd">    """</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-7"></a>    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-8"></a>    <span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-9"></a>    <span class="p">(</span><span class="s2">"unemployment"</span><span class="p">,</span> <span class="s2">"@unemployment"</span><span class="p">),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-10"></a>    <span class="p">])</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-11"></a>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-12"></a>    <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-13"></a>        <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-14"></a>        <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-15"></a>        <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-16"></a>        <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-17"></a>        <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-18"></a>        <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-19"></a>        <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-20"></a>        <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-21"></a>    <span class="p">]</span>
<a name="rest_code_a85e2bc8a8d74b1d88a23b452d152c0c-22"></a>    <span class="k">return</span> <span class="n">tools</span>
</pre>
<p>The <tt class="docutils literal">HoverTool tooltips</tt> argument is a list of tuples - one tuple for each dimension of the data. The first argument of the tuple (e.g. "month") is the label that will appear when the user hover's over the data point, while the second (e.g. "@month_label") tells bokeh which column to use for the data (so it has to match the key you used in the <tt class="docutils literal">ColumnDataSource</tt> creation).</p>
</div>
<div class="section" id="helper-functions">
<h3>Helper Functions</h3>
<p>The sub-figures needed some common elements so I created functions for them.</p>
<div class="section" id="scaling-the-timestamps">
<h4>Scaling The Timestamps</h4>
<p>The timestamps by default are unreadable (because there are so many). This re-scales them so they are more readable.</p>
<pre class="code python"><a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-1"></a><span class="k">def</span> <span class="nf">scale_timestamp</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-2"></a>    <span class="sd">"""gets the scaled timestamp for element location</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-3"></a>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-5"></a><span class="sd">     index: index in the portland.datetime series</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-7"></a><span class="sd">     epoch timestamp used to locate place in plot</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-8"></a><span class="sd">    """</span>
<a name="rest_code_ffcc3b29c4d045e9bbf1718b4cf90fd9-9"></a>    <span class="k">return</span> <span class="n">portland</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="n">TIME_SCALE</span>
</pre>
</div>
<div class="section" id="drawing-the-recession">
<h4>Drawing the Recession</h4>
<p>The recession is indicated as a blue box on each plot.</p>
<pre class="code python"><a name="rest_code_73ae8ccf020e43e994dc81517a282cca-1"></a><span class="k">def</span> <span class="nf">make_recession</span><span class="p">():</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-2"></a>    <span class="sd">"""Makes the box for the recession</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-3"></a>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-5"></a><span class="sd">     BoxAnnotation to color the recession</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-6"></a><span class="sd">    """</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-7"></a>    <span class="k">return</span> <span class="n">BoxAnnotation</span><span class="p">(</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-8"></a>        <span class="n">left</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">recession_start</span><span class="p">),</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-9"></a>        <span class="n">right</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">recession_end</span><span class="p">),</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-10"></a>        <span class="n">fill_color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
<a name="rest_code_73ae8ccf020e43e994dc81517a282cca-11"></a>        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="vertical-lines">
<h4>Vertical Lines</h4>
<p>Things like the unemployment lows and highs are indicated by a vertical line.</p>
<pre class="code python"><a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-1"></a><span class="k">def</span> <span class="nf">make_vertical</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">):</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-2"></a>    <span class="sd">"""makes a vertical line</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-3"></a>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-4"></a><span class="sd">    Args:</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-5"></a><span class="sd">     location: place on the x-axis for the line</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-6"></a><span class="sd">     color (str): line-color for the line</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-8"></a><span class="sd">     Span at index</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-9"></a><span class="sd">    """</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-10"></a>    <span class="k">return</span> <span class="n">Span</span><span class="p">(</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-11"></a>        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-12"></a>        <span class="n">line_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-13"></a>        <span class="n">dimension</span><span class="o">=</span><span class="s2">"height"</span><span class="p">,</span>
<a name="rest_code_e1e4fac910df4b14a9e4471cde71b447-14"></a>    <span class="p">)</span>
</pre>
</div>
<div class="section" id="make-verticals">
<h4>Make Verticals</h4>
<p>Since there's more than one line, this function adds all the lines.</p>
<pre class="code python"><a name="rest_code_79115b8474cf4b95894511fbd074c91b-1"></a><span class="k">def</span> <span class="nf">make_verticals</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-2"></a>    <span class="sd">"""makes the verticals and adds them to the figures"""</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-3"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-4"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">unemployment_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-5"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-6"></a>    <span class="p">))</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-7"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-8"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">s_and_p_nadir</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-9"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">))</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-10"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-11"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">housing_nadir</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-12"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"limegreen"</span><span class="p">))</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-13"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-14"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">national_peak</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-15"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">))</span>
<a name="rest_code_79115b8474cf4b95894511fbd074c91b-16"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="the-figures">
<h3>The Figures</h3>
<p>This plot has three sub-figures, each of which is created separately then added to the <tt class="docutils literal">Column</tt>.</p>
<div class="section" id="unemployment">
<h4>Unemployment</h4>
<pre class="code python"><a name="rest_code_db7bdb4727944615825a7a925524602a-1"></a><span class="n">tools</span> <span class="o">=</span> <span class="n">make_tools</span><span class="p">()</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-2"></a><span class="n">unemployment_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-3"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-4"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-5"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-6"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-7"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Unemployment (2007-2017)"</span>
<a name="rest_code_db7bdb4727944615825a7a925524602a-8"></a><span class="p">)</span>
</pre>
<p>Next the lines for the time-series data are added.</p>
<pre class="code python"><a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-2"></a>    <span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"unemployment"</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-3"></a>    <span class="n">source</span><span class="o">=</span><span class="n">portland_source</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-4"></a>    <span class="n">line_color</span><span class="o">=</span><span class="n">PORTLAND_COLOR</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-5"></a>    <span class="n">legend</span><span class="o">=</span><span class="n">PORTLAND_LABEL</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-6"></a>          <span class="p">)</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-7"></a>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-8"></a><span class="n">line</span> <span class="o">=</span> <span class="n">unemployment_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-9"></a>    <span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"unemployment"</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-10"></a>    <span class="n">source</span><span class="o">=</span><span class="n">national_source</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-11"></a>    <span class="n">line_color</span><span class="o">=</span><span class="n">NATIONAL_COLOR</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-12"></a>    <span class="n">legend</span><span class="o">=</span><span class="n">NATIONAL_LABEL</span><span class="p">,</span>
<a name="rest_code_bbedf1eeb8e044e39a50dd39d0615c5a-13"></a><span class="p">)</span>
</pre>
<p>Now the recession-box and high and low points for each plot is added.</p>
<pre class="code python"><a name="rest_code_a3fdb5f2efa54318ac3656624c95d1bd-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_a3fdb5f2efa54318ac3656624c95d1bd-2"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">unemployment_figure</span><span class="p">)</span>
</pre>
<p>Now some labels are added and the grid is turned off.</p>
<pre class="code python"><a name="rest_code_441a583e959f429491237a47f0bc6a43-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"% Unemployment"</span>
<a name="rest_code_441a583e959f429491237a47f0bc6a43-2"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_441a583e959f429491237a47f0bc6a43-3"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_441a583e959f429491237a47f0bc6a43-4"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
</pre>
</div>
<div class="section" id="s-p-500">
<h4>S &amp; P 500</h4>
<p>The S &amp; P 500 had didn't have unemployment as the dependent variable so I made a different set of tools to change the label for the hover.</p>
<pre class="code python"><a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-1"></a><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-2"></a>    <span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-3"></a>    <span class="p">(</span><span class="s2">"Value"</span><span class="p">,</span> <span class="s2">"@value"</span><span class="p">),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-4"></a><span class="p">])</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-5"></a><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-6"></a>    <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-7"></a>    <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-8"></a>    <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-9"></a>    <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-10"></a>    <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-11"></a>    <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-12"></a>    <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-13"></a>    <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-14"></a><span class="p">]</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-15"></a><span class="n">s_and_p_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-16"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-17"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-18"></a>    <span class="n">x_range</span><span class="o">=</span><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-19"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-20"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-21"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"S &amp; P 500 Index"</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-22"></a><span class="p">)</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-23"></a><span class="n">line</span> <span class="o">=</span> <span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-24"></a>                    <span class="n">source</span><span class="o">=</span><span class="n">s_and_p_source</span><span class="p">,</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-25"></a>                    <span class="n">line_color</span><span class="o">=</span><span class="n">S_AND_P_COLOR</span><span class="p">)</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-26"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-27"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">s_and_p_figure</span><span class="p">)</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-28"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"S &amp; P 500 Valuation"</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-29"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-30"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-31"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_77d0aa2f6fa84fecaaea52238afc897b-32"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
</pre>
</div>
<div class="section" id="housing">
<h4>Housing</h4>
<pre class="code python"><a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-1"></a><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-2"></a>    <span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-3"></a>    <span class="p">(</span><span class="s2">"Price"</span><span class="p">,</span> <span class="s2">"@price"</span><span class="p">),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-4"></a><span class="p">])</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-5"></a><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-6"></a>    <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-7"></a>    <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-8"></a>    <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-9"></a>    <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-10"></a>    <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-11"></a>    <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-12"></a>    <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-13"></a>    <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-14"></a><span class="p">]</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-15"></a><span class="n">housing_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-16"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-17"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-18"></a>    <span class="n">x_range</span><span class="o">=</span><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-19"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-20"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-21"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"House Price Index"</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-22"></a><span class="p">)</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-23"></a><span class="n">line</span> <span class="o">=</span> <span class="n">housing_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-24"></a>                           <span class="n">source</span><span class="o">=</span><span class="n">housing_source</span><span class="p">,</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-25"></a>                           <span class="n">line_color</span><span class="o">=</span><span class="n">HOUSING_COLOR</span><span class="p">)</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-26"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-27"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">housing_figure</span><span class="p">)</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-28"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Sale Price ($1,000)"</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-29"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-30"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-31"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_b071f46f77b5497a917ec017e7fbeff4-32"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
</pre>
</div>
</div>
<div class="section" id="combining">
<h3>Combining</h3>
<p>Once the figures were created I combined them into a <tt class="docutils literal">column</tt>, since I wanted them stacked verticallly.</p>
<pre class="code python"><a name="rest_code_a0032aaf8f774fa0bf6e7463c33c2d43-1"></a><span class="n">combined</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">unemployment_figure</span><span class="p">,</span> <span class="n">s_and_p_figure</span><span class="p">,</span> <span class="n">housing_figure</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="outputting-the-code">
<h3>Outputting The Code</h3>
<p>In order to be able to embed the code, you need to have bokeh export it. There are multiple ways to do this, but I chose the <tt class="docutils literal">autoload_static</tt> method.</p>
<pre class="code python"><a name="rest_code_6bcef0c8a0404eaf8c48518c3fe04ce3-1"></a><span class="n">OUTPUT_JAVASCRIPT</span> <span class="o">=</span> <span class="s2">"portland_unemployment.js"</span>
<a name="rest_code_6bcef0c8a0404eaf8c48518c3fe04ce3-2"></a><span class="n">js</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">autoload_static</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">CDN</span><span class="p">,</span> <span class="n">OUTPUT_JAVASCRIPT</span><span class="p">)</span>
</pre>
<p>The third argument (<tt class="docutils literal">OUTPUT_JAVASCRIPT</tt>) is the path you want to refer to in the tag. The returned <tt class="docutils literal">js</tt> variable contains the javascript you need to save (using the filename you gave <tt class="docutils literal">autoload_static</tt>) and the <tt class="docutils literal">tag</tt> contains the HTML tag that you embed to let the server know you want to use the javascript that was saved.</p>
<p>Since both values are just strings, and nothing was saved to disk, I saved it for later.</p>
<pre class="code python"><a name="rest_code_ce6108575fd1414cb97af2f8b562e010-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">OUTPUT_JAVASCRIPT</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a name="rest_code_ce6108575fd1414cb97af2f8b562e010-2"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
<a name="rest_code_ce6108575fd1414cb97af2f8b562e010-3"></a>
<a name="rest_code_ce6108575fd1414cb97af2f8b562e010-4"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"portland_tag.html"</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a name="rest_code_ce6108575fd1414cb97af2f8b562e010-5"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="getting-it-into-nikola">
<h3>Getting It Into Nikola</h3>
<p>The first thing was to create this file using <tt class="docutils literal">nikola new_post</tt> (it's called bokeh-test.rst). Next I created a directory in the <tt class="docutils literal">files</tt> folder that had the same name as this file (without the ".rst" extension) to put the javascript in so nikola would find it when I built the HTML.</p>
<pre class="code bash"><a name="rest_code_b08f4d3855de440d8134fe2b60bffda3-1"></a>mkdir files/posts/bokeh-test
</pre>
<p>Once I copied the <tt class="docutils literal">portland_unemployment.js</tt> file to the <tt class="docutils literal"><span class="pre">bokeh-test</span></tt> directory I opened the <tt class="docutils literal">portland_tag.html</tt> file and embedded it directly into the post sing the <tt class="docutils literal">raw</tt> restructureText directive.</p>
<pre class="code rst"><a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-1"></a><span class="p">..</span> <span class="ow">raw</span><span class="p">::</span> html
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-2"></a>
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-3"></a>   &lt;script
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-4"></a>       src="portland_unemployment.js"
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-5"></a>       id="686c5dd6-168a-4f7d-acbc-524875d93b59"
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-6"></a>       data-bokeh-model-id="c473232a-dc2c-4b75-988c-f9bc6517b4b9"
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-7"></a>       data-bokeh-doc-id="402d8e3c-1595-4d65-9f76-e11068c629ab"
<a name="rest_code_ea3bcfaf41a14c6fafbc989c56d71de6-8"></a>   &gt;&lt;/script&gt;
</pre>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/bokeh-plotting/" rel="tag">bokeh plotting</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../assignment-4/" rel="prev" title="Assignment 4">Previous post</a>
            </li>
            <li class="next">
                <a href="../predicting-cancer/" rel="next" title="Predicting Cancer (Course 3, Assignment 1)">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents  2017         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
