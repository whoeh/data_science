<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content='Work done for the Coursera "Data Science with Python" Specialization.'>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Science With Python</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/data_science/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/assignment-2-introduction-to-nltk/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/data_science/">

                <span id="blog-title">Data Science With Python</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu"><li>
<a href="pages/portland-unemployment-2007-to-2017">Portland Unemployment Visualization</a>
            </li></ul>
</li>
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form
 navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/data_science/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/assignment-2-introduction-to-nltk/" class="u-url">Assignment 2 - Introduction to NLTK</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/assignment-2-introduction-to-nltk/" rel="bookmark"><time class="published dt-published" datetime="2017-08-12T15:02:00-07:00" title="2017-08-12 15:02">2017-08-12 15:02</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In part 1 of this assignment you will use nltk to explore the Herman Melville novel Moby Dick. Then in part 2 you will create a spelling recommender function that uses nltk to find words similar to the misspelling.</p>
<div class="section" id="part-1-analyzing-moby-dick">
<h2>1 Part 1 - Analyzing Moby Dick</h2>
<div class="section" id="imports-and-data-set-up">
<h3>1.1 Imports and Data Set Up</h3>
<pre class="code ipython"><a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-1"></a><span class="kn">from</span> <span class="nn">nltk.probability</span> <span class="kn">import</span> <span class="n">FreqDist</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-2"></a><span class="kn">from</span> <span class="nn">nltk.stem</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-3"></a><span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">sent_tokenize</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-4"></a><span class="kn">import</span> <span class="nn">matplotlib</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-5"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-6"></a><span class="kn">import</span> <span class="nn">nltk</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-7"></a><span class="kn">import</span> <span class="nn">nltk.data</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-8"></a><span class="kn">import</span> <span class="nn">numba</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-9"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-10"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_89894ef1e8e44db99e6a71abc511fb2e-11"></a><span class="kn">import</span> <span class="nn">seaborn</span>
</pre>
<pre class="code ipython"><a name="rest_code_b7f4c0b43f974b02bdfb80251635251c-1"></a><span class="o">%</span><span class="k">matplotlib</span> inline
<a name="rest_code_b7f4c0b43f974b02bdfb80251635251c-2"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
</pre>
<p>If you would like to work with the raw text you can use 'moby_raw'.</p>
<pre class="code ipython"><a name="rest_code_fc1bf0d0ba65473ab7bc1ddd4f303c5f-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'moby.txt'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<a name="rest_code_fc1bf0d0ba65473ab7bc1ddd4f303c5f-2"></a>    <span class="n">moby_raw</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre>
<p>If you would like to work with the novel in <tt class="docutils literal">nltk.Text</tt> format you can use 'text1'.</p>
<pre class="code ipython"><a name="rest_code_8a7c6d96525247de8a5789ac4c21beb1-1"></a><span class="n">moby_tokens</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">moby_raw</span><span class="p">)</span>
<a name="rest_code_8a7c6d96525247de8a5789ac4c21beb1-2"></a><span class="n">text</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
<a name="rest_code_8a7c6d96525247de8a5789ac4c21beb1-3"></a><span class="n">moby_series</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="examples">
<h3>1.2 Examples</h3>
<div class="section" id="example-1">
<h4>1.2.1 Example 1</h4>
<p><em>How many tokens (words and punctuation symbols) are in text1?</em> A <strong>token</strong> is a linguistic unit such as a word, punctuation mark, or alpha-numeric strings.</p>
<p><strong>This function should return an integer.</strong></p>
<pre class="code ipython"><a name="rest_code_6aaee2f640b244a68694abafc51f151b-1"></a><span class="k">def</span> <span class="nf">example_one</span><span class="p">():</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-2"></a>     <span class="sd">"""counts the tokens in moby dick</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-3"></a>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-4"></a><span class="sd">     Returns:</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-5"></a><span class="sd">      int: number of tokens in moby dick</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-6"></a><span class="sd">     """</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-7"></a>     <span class="c1"># or alternatively len(text1)</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-8"></a>     <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-9"></a>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-10"></a><span class="n">MOBY_TOKEN_COUNT</span> <span class="o">=</span> <span class="n">example_one</span><span class="p">()</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Moby Dick has {:,} tokens."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_6aaee2f640b244a68694abafc51f151b-12"></a>     <span class="n">MOBY_TOKEN_COUNT</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Moby Dick has 254,989 tokens.
</pre>
</div>
<div class="section" id="example-2">
<h4>1.2.2 Example 2</h4>
<p><em>How many unique tokens (unique words and punctuation) does text1 have?</em></p>
<p><strong>This function should return an integer.</strong></p>
<pre class="code ipython"><a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-1"></a><span class="k">def</span> <span class="nf">example_two</span><span class="p">():</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-2"></a>    <span class="sd">"""counts the unique tokens</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-3"></a>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-5"></a><span class="sd">     int: count of unique tokens in Moby Dick</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-6"></a><span class="sd">    """</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-7"></a>    <span class="c1"># or alternatively len(set(text1))</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-8"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">moby_raw</span><span class="p">)))</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-9"></a>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-10"></a><span class="n">MOBY_UNIQUE_COUNT</span> <span class="o">=</span> <span class="n">example_two</span><span class="p">()</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Moby Dick has {:,} unique tokens."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_24b4a0bd376b42e5abad36771a569ae8-12"></a>    <span class="n">MOBY_UNIQUE_COUNT</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Moby Dick has 20,755 unique tokens.
</pre>
</div>
<div class="section" id="example-3">
<h4>1.2.3 Example 3</h4>
<p><em>After lemmatizing the verbs, how many unique tokens does text1 have?</em> A <strong>lemma</strong> is the canonical form. e.g. <em>run</em> is the lemma for <em>runs</em>, <em>ran</em>, <em>running</em>, and <em>run</em>.</p>
<p><strong>This function should return an integer.</strong></p>
<pre class="code ipython"><a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-1"></a><span class="k">def</span> <span class="nf">example_three</span><span class="p">():</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-2"></a>    <span class="sd">"""Counts the number of lemma in Moby Dick</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-3"></a>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-5"></a><span class="sd">     int: count of unique lemma</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-6"></a><span class="sd">    """</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-7"></a>    <span class="n">lemmatizer</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-8"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">lemmatizer</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s1">'v'</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">text1</span><span class="p">]))</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-9"></a>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-10"></a><span class="n">MOBY_LEMMA_COUNT</span> <span class="o">=</span> <span class="n">example_three</span><span class="p">()</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Moby Dick has {:,} lemma (found in WordNet)."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_2e99db9b8c9e40a0b04eccbe8730bae7-12"></a>    <span class="n">MOBY_LEMMA_COUNT</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Moby Dick has 16,900 lemma (found in WordNet).
</pre>
</div>
</div>
<div class="section" id="questions">
<h3>1.3 Questions</h3>
<div class="section" id="question-1">
<h4>1.3.1 Question 1</h4>
<p>What is the lexical diversity of the given text input? (i.e. ratio of unique tokens to the total number of tokens)</p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_953cde7382604334989394a6f6e16c30-1"></a><span class="nd">@jit</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-2"></a><span class="k">def</span> <span class="nf">lexical_diversity</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-3"></a>    <span class="sd">"""Calculates the lexical diversity of a list of tokens</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-4"></a>
<a name="rest_code_953cde7382604334989394a6f6e16c30-5"></a><span class="sd">    Returns:</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-6"></a><span class="sd">     float: fraction of tokens that are unique</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-7"></a><span class="sd">    """</span>
<a name="rest_code_953cde7382604334989394a6f6e16c30-8"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>
</pre>
<pre class="code ipython"><a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-1"></a><span class="k">def</span> <span class="nf">answer_one</span><span class="p">():</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-2"></a>    <span class="sd">"""Calculates the lexical diversity of Moby Dick</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-3"></a>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-5"></a><span class="sd">     float: fraction of tokens that are unique</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-6"></a><span class="sd">    """</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-7"></a>    <span class="k">return</span> <span class="n">lexical_diversity</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-8"></a>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-9"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_ab92a780f9d84c159f79f1e2f1f88280-10"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Lexical Diversity of Moby Dick: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Lexical Diversity of Moby Dick: 0.08
</pre>
<p>About 8 percent of the tokens in Moby Dick are unique.</p>
</div>
<div class="section" id="question-2">
<h4>1.3.2 Question 2</h4>
<p><em>What percentage of tokens is 'whale'or 'Whale'?</em></p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_e61e89938fd14f8198d33a2144ecd3b0-1"></a><span class="n">moby_frequencies</span> <span class="o">=</span> <span class="n">FreqDist</span><span class="p">(</span><span class="n">moby_tokens</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_91e336210b6b4631be5378580c2dd24e-1"></a><span class="k">def</span> <span class="nf">answer_two</span><span class="p">():</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-2"></a>    <span class="sd">"""calculates percentage of tokens that are 'whale'</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-3"></a>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-5"></a><span class="sd">     float: percentage of entries that are whales</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-6"></a><span class="sd">    """</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-7"></a>    <span class="n">whales</span> <span class="o">=</span> <span class="n">moby_frequencies</span><span class="p">[</span><span class="s2">"whale"</span><span class="p">]</span> <span class="o">+</span> <span class="n">moby_frequencies</span><span class="p">[</span><span class="s2">"Whale"</span><span class="p">]</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-8"></a>    <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">whales</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">MOBY_TOKEN_COUNT</span><span class="p">))</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-9"></a>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-10"></a><span class="n">whale_fraction</span> <span class="o">=</span> <span class="n">answer_two</span><span class="p">()</span>
<a name="rest_code_91e336210b6b4631be5378580c2dd24e-11"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Percentage of tokens that are whales: {:.2f} %"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">whale_fraction</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Percentage of tokens that are whales: 0.41 %
</pre>
<p>Around 1 percent of the tokens are 'whale'.</p>
<p>I originally made two mistakes with this question, I was returning a fraction, not a percentage, and I was using a regular expression <em>'([Ww]hale)'</em> which I later realized would match <em>whales</em>, <em>whaler</em>, and other variants.</p>
<pre class="literal-block">
782
</pre>
</div>
<div class="section" id="question-3">
<h4>1.3.3 Question 3</h4>
<p><em>What are the 20 most frequently occurring (unique) tokens in the text? What is their frequency?</em></p>
<p><strong>This function should return a list of 20 tuples where each tuple is of the form `(token, frequency)`. The list should be sorted in descending order of frequency.</strong></p>
<pre class="code ipython"><a name="rest_code_8df9215976e04d879757587fccbb2313-1"></a><span class="k">def</span> <span class="nf">answer_three</span><span class="p">():</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-2"></a>    <span class="sd">"""finds 20 most requently occuring tokens</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-3"></a>
<a name="rest_code_8df9215976e04d879757587fccbb2313-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-5"></a><span class="sd">     list: (token, frequency) for top 20 tokens</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-6"></a><span class="sd">    """</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-7"></a>    <span class="k">return</span> <span class="n">moby_frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<a name="rest_code_8df9215976e04d879757587fccbb2313-8"></a>
<a name="rest_code_8df9215976e04d879757587fccbb2313-9"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_three</span><span class="p">())</span>
</pre>
<pre class="literal-block">
[(',', 19204), ('the', 13715), ('.', 7308), ('of', 6513), ('and', 6010), ('a', 4545), ('to', 4515), (';', 4173), ('in', 3908), ('that', 2978), ('his', 2459), ('it', 2196), ('I', 2097), ('!', 1767), ('is', 1722), ('--', 1713), ('with', 1659), ('he', 1658), ('was', 1639), ('as', 1620)]
</pre>
</div>
<div class="section" id="question-4">
<h4>1.3.4 Question 4</h4>
<p><em>What tokens have a length of greater than 5 and frequency of more than 150?</em></p>
<p><strong>This function should return a sorted list of the tokens that match the above constraints. To sort your list, use `sorted()`</strong></p>
<pre class="code ipython"><a name="rest_code_98a78f817e9c414fa18cc8d2a116db65-1"></a><span class="n">moby_frequency_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">moby_frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(),</span>
<a name="rest_code_98a78f817e9c414fa18cc8d2a116db65-2"></a>                                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"token"</span><span class="p">,</span> <span class="s2">"frequency"</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_338a2db467c341a2bc74d8e2ae540352-1"></a><span class="k">def</span> <span class="nf">answer_four</span><span class="p">():</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-2"></a>    <span class="sd">"""gets tokens with length &gt; 5, frequency &gt; 150"""</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-3"></a>    <span class="n">frame</span> <span class="o">=</span>  <span class="n">moby_frequency_frame</span><span class="p">[(</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">)</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-4"></a>                                  <span class="o">&amp;</span> <span class="p">(</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)]</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-5"></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-6"></a>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-7"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_338a2db467c341a2bc74d8e2ae540352-8"></a><span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre>
<pre class="literal-block">
['Captain', 'Pequod', 'Queequeg', 'Starbuck', 'almost', 'before', 'himself', 'little', 'seemed', 'should', 'though', 'through', 'whales', 'without']
</pre>
<p>I was originally returning the data frame, not just the sorted tokens, which was of course marked wrong.</p>
</div>
<div class="section" id="question-5">
<h4>1.3.5 Question 5</h4>
<p><em>Find the longest word in text1 and that word's length.</em></p>
<p><strong>This function should return a tuple `(longest_word, length)`.</strong></p>
<pre class="code ipython"><a name="rest_code_d017350420344667a85421aa61dbbafd-1"></a><span class="k">def</span> <span class="nf">answer_five</span><span class="p">():</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-2"></a>    <span class="sd">"""finds the longest word and its length</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-3"></a>
<a name="rest_code_d017350420344667a85421aa61dbbafd-4"></a><span class="sd">    Return:</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-5"></a><span class="sd">     tuple: (longest-word, length)</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-6"></a><span class="sd">    """</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-7"></a>    <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">())</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-8"></a>    <span class="n">longest</span> <span class="o">=</span> <span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s2">"(?P&lt;long&gt;.{{{}}})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-9"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">longest</span><span class="o">.</span><span class="n">long</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="p">)</span>
<a name="rest_code_d017350420344667a85421aa61dbbafd-10"></a>
<a name="rest_code_d017350420344667a85421aa61dbbafd-11"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_five</span><span class="p">())</span>
</pre>
<pre class="literal-block">
("twelve-o'clock-at-night", 23)
</pre>
</div>
<div class="section" id="question-6">
<h4>1.3.6 Question 6</h4>
<p><em>What unique words have a frequency of more than 2000? What is their frequency?</em></p>
<p>Hint:  you may want to use `isalpha()` to check if the token is a word and not punctuation.</p>
<p><strong>This function should return a list of tuples of the form `(frequency, word)` sorted in descending order of frequency.</strong></p>
<pre class="code ipython"><a name="rest_code_38a29af671314fada3d66cc440160e84-1"></a><span class="n">moby_words</span> <span class="o">=</span> <span class="n">moby_frequency_frame</span><span class="p">[</span><span class="n">moby_frequency_frame</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()]</span>
</pre>
<pre class="code ipython"><a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-1"></a><span class="k">def</span> <span class="nf">answer_six</span><span class="p">():</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-2"></a>    <span class="sd">"""Finds words wih frequency &gt; 2000</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-3"></a>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-5"></a><span class="sd">     list: frequency, word tuples</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-6"></a><span class="sd">    """</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-7"></a>    <span class="n">common</span> <span class="o">=</span> <span class="n">moby_words</span><span class="p">[</span><span class="n">moby_words</span><span class="o">.</span><span class="n">frequency</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">]</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-8"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">token</span><span class="p">))</span>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-9"></a>
<a name="rest_code_8444bc1b9d87461ea7fdf9ec0104a996-10"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_six</span><span class="p">())</span>
</pre>
<pre class="literal-block">
[(13715, 'the'), (6513, 'of'), (6010, 'and'), (4545, 'a'), (4515, 'to'), (3908, 'in'), (2978, 'that'), (2459, 'his'), (2196, 'it'), (2097, 'I')]
</pre>
<p>When I first submitted this I got it wrong because I was returning a list of <tt class="docutils literal">(word, frequency)</tt>, not <tt class="docutils literal">(frequency, word)</tt>.</p>
</div>
<div class="section" id="question-7">
<h4>1.3.7 Question 7</h4>
<p><em>What is the average number of tokens per sentence?</em></p>
<p><strong>This function should return a float.</strong></p>
<pre class="code ipython"><a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-1"></a><span class="k">def</span> <span class="nf">answer_seven</span><span class="p">():</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-2"></a>    <span class="sd">"""average number of tokens per sentence"""</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-3"></a>    <span class="n">sentences</span> <span class="o">=</span> <span class="n">sent_tokenize</span><span class="p">(</span><span class="n">moby_raw</span><span class="p">)</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-4"></a>    <span class="n">counts</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">sentence</span><span class="p">))</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">)</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-5"></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-6"></a>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-7"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_seven</span><span class="p">()</span>
<a name="rest_code_bea4ac4d7e2f4938a821b71c842c58f4-8"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Average number of tokens per sentence: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Average number of tokens per sentence: 25.88
</pre>
</div>
<div class="section" id="question-8">
<h4>1.3.8 Question 8</h4>
<p><em>What are the 5 most frequent parts of speech in this text? What is their frequency?</em> Parts of Speech (POS) are the lexical categories that words belong to.</p>
<p><strong>This function should return a list of tuples of the form `(part_of_speech, frequency)` sorted in descending order of frequency.</strong></p>
<pre class="code ipython"><a name="rest_code_19f22d7ad474405481d7131903d135b8-1"></a><span class="k">def</span> <span class="nf">answer_eight</span><span class="p">():</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-2"></a>    <span class="sd">"""gets the 5 most frequent parts of speech</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-3"></a>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-5"></a><span class="sd">     list (Tuple): (part of speech, frequency) for top 5</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-6"></a><span class="sd">    """</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-7"></a>    <span class="n">tags</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">moby_words</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-8"></a>    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">FreqDist</span><span class="p">([</span><span class="n">tag</span> <span class="k">for</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">])</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-9"></a>    <span class="k">return</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-10"></a>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-11"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_eight</span><span class="p">()</span>
<a name="rest_code_19f22d7ad474405481d7131903d135b8-12"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Top 5 parts of speech: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Top 5 parts of speech: [('NN', 4016), ('NNP', 2916), ('JJ', 2875), ('NNS', 2452), ('VBD', 1421)]
</pre>
</div>
</div>
</div>
<div class="section" id="part-2-spelling-recommender">
<h2>2 Part 2 - Spelling Recommender</h2>
<p>For this part of the assignment you will create three different spelling recommenders, that each take a list of misspelled words and recommends a correctly spelled word for every word in the list.</p>
<p>For every misspelled word, the recommender should find find the word in `correct_spellings` that has the shortest distance*, and starts with the same letter as the misspelled word, and return that word as a recommendation.</p>
<p><strong>Each of the three different recommenders will use a different distance measure (outlined below)</strong>.</p>
<p>Each of the recommenders should provide recommendations for the three default words provided: `['cormulent', 'incendenece', 'validrate']`.</p>
<pre class="code ipython"><a name="rest_code_c372ab263f1d45578d94796201db0be8-1"></a><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">words</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-2"></a><span class="kn">from</span> <span class="nn">nltk.metrics.distance</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-3"></a>    <span class="n">edit_distance</span><span class="p">,</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-4"></a>    <span class="n">jaccard_distance</span><span class="p">,</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-5"></a>    <span class="p">)</span>
<a name="rest_code_c372ab263f1d45578d94796201db0be8-6"></a><span class="kn">from</span> <span class="nn">nltk.util</span> <span class="kn">import</span> <span class="n">ngrams</span>
</pre>
<pre class="code ipython"><a name="rest_code_fa927e815f8b40d89b5f7e83114acda8-1"></a><span class="n">correct_spellings</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">words</span><span class="p">()</span>
<a name="rest_code_fa927e815f8b40d89b5f7e83114acda8-2"></a><span class="n">spellings_series</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">correct_spellings</span><span class="p">)</span>
</pre>
<div class="section" id="question-9">
<h3>2.1 Question 9</h3>
<p>For this recommender, your function should provide recommendations for the three default words provided above using the following distance metric:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard distance</a> on the trigrams of the two words.</p>
<p><strong>This function should return a list of length three:</strong> <tt class="docutils literal">['cormulent_reccomendation', 'incendenece_reccomendation', 'validrate_reccomendation']</tt>.</p>
<pre class="code ipython"><a name="rest_code_5803e6005d404a1387f7c85c7a047379-1"></a><span class="k">def</span> <span class="nf">jaccard</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">gram_number</span><span class="p">):</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-2"></a>    <span class="sd">"""find the closet words to each entry</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-3"></a>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-4"></a><span class="sd">    Args:</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-5"></a><span class="sd">     entries: collection of words to match</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-6"></a><span class="sd">     gram_number: number of n-grams to use</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-7"></a>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-9"></a><span class="sd">     list: words with the closest jaccard distance to entries</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-10"></a><span class="sd">    """</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-11"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-12"></a>    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-13"></a>        <span class="n">spellings</span> <span class="o">=</span> <span class="n">spellings_series</span><span class="p">[</span><span class="n">spellings_series</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-14"></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">((</span><span class="n">jaccard_distance</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">gram_number</span><span class="p">)),</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-15"></a>                                       <span class="nb">set</span><span class="p">(</span><span class="n">ngrams</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">gram_number</span><span class="p">))),</span> <span class="n">word</span><span class="p">)</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-16"></a>                     <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">spellings</span><span class="p">)</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-17"></a>        <span class="n">closest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-18"></a>        <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_5803e6005d404a1387f7c85c7a047379-19"></a>    <span class="k">return</span> <span class="n">outcomes</span>
</pre>
<pre class="code ipython"><a name="rest_code_51620bbdded141b59e1f6155d4f972af-1"></a><span class="k">def</span> <span class="nf">answer_nine</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">'cormulent'</span><span class="p">,</span> <span class="s1">'incendenece'</span><span class="p">,</span> <span class="s1">'validrate'</span><span class="p">]):</span>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-2"></a>    <span class="sd">"""finds the closest word based on jaccard distance"""</span>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-3"></a>    <span class="k">return</span> <span class="n">jaccard</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-4"></a>
<a name="rest_code_51620bbdded141b59e1f6155d4f972af-5"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_nine</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['corpulent', 'indecence', 'validate']
</pre>
<p>I originally got both the Jaccard Distance problems wrong because I was just using the distance, not filtering the candidates by the first letter, which turns out to return fairly dissimilar words.</p>
</div>
<div class="section" id="question-10">
<h3>2.2 Question 10</h3>
<p>For this recommender, your function should provide recommendations for the three default words provided above using the following distance metric:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard distance</a> on the 4-grams of the two words.</p>
<p><strong>This function should return a list of length three:</strong> <tt class="docutils literal">['cormulent_reccomendation', 'incendenece_reccomendation', 'validrate_reccomendation']</tt>.</p>
<pre class="code ipython"><a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-1"></a><span class="k">def</span> <span class="nf">answer_ten</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">'cormulent'</span><span class="p">,</span> <span class="s1">'incendenece'</span><span class="p">,</span> <span class="s1">'validrate'</span><span class="p">]):</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-2"></a>    <span class="sd">"""gets the neares words using jaccard-distance with 4-grams</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-3"></a>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-4"></a><span class="sd">    Args:</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-5"></a><span class="sd">     entries (list): words to find nearest other word for</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-6"></a>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-8"></a><span class="sd">     list: nearest words found</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-9"></a><span class="sd">    """</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-10"></a>    <span class="k">return</span> <span class="n">jaccard</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-11"></a>
<a name="rest_code_4073effe606d4bc4a1804ba777d0fea3-12"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_ten</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['cormus', 'incendiary', 'valid']
</pre>
</div>
<div class="section" id="question-11">
<h3>2.3 Question 11</h3>
<p>For this recommender, your function should provide recommendations for the three default words provided above using the following distance metric:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">Edit (Levenshtein) distance</a> on the two words with transpositions.</p>
<p><strong>This function should return a list of length three:</strong> <tt class="docutils literal">['cormulent_reccomendation', 'incendenece_reccomendation', 'validrate_reccomendation']</tt>.</p>
<pre class="code ipython"><a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-1"></a><span class="k">def</span> <span class="nf">answer_eleven</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">'cormulent'</span><span class="p">,</span> <span class="s1">'incendenece'</span><span class="p">,</span> <span class="s1">'validrate'</span><span class="p">]):</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-2"></a>    <span class="sd">"""gets the nearest words based on Levenshtein distance</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-3"></a>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-4"></a><span class="sd">    Args:</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-5"></a><span class="sd">     entries (list[str]): words to find closest words to</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-6"></a>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-8"></a><span class="sd">     list[str]: nearest words to the entries</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-9"></a><span class="sd">    """</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-10"></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[]</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-11"></a>    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-12"></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">((</span><span class="n">edit_distance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-13"></a>                                    <span class="n">word</span><span class="p">),</span> <span class="n">word</span><span class="p">)</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-14"></a>                     <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">correct_spellings</span><span class="p">)</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-15"></a>        <span class="n">closest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-16"></a>        <span class="n">outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-17"></a>    <span class="k">return</span> <span class="n">outcomes</span>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-18"></a>
<a name="rest_code_838c87d989434e3eb38cdb6bab7f7392-19"></a><span class="k">print</span><span class="p">(</span><span class="n">answer_eleven</span><span class="p">())</span>
</pre>
<pre class="literal-block">
['corpulent', 'intendence', 'validate']
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/extracting-dates-from-medical-data/" class="u-url">Extracting Dates From Medical Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/extracting-dates-from-medical-data/" rel="bookmark"><time class="published dt-published" datetime="2017-08-07T17:16:00-07:00" title="2017-08-07 17:16">2017-08-07 17:16</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="introduction">
<h2>1 Introduction</h2>
<p>In this assignment, you'll be working with messy medical data and using regular expressions to extract relevant information from the data.</p>
<p>Each line of the <tt class="docutils literal">dates.txt</tt> file corresponds to a medical note. Each note has a date that needs to be extracted, but each date is encoded in one of many formats.</p>
<p>The goal of this assignment is to correctly identify all of the different date variants encoded in this dataset and to properly normalize and sort the dates.</p>
<p>Here is a list of some of the variants you might encounter in this dataset:</p>
<ul class="simple">
<li>04/20/2009; 04/20/09; 4/20/09; 4/3/09</li>
<li>Mar-20-2009; Mar 20, 2009; March 20, 2009;  Mar. 20, 2009; Mar 20 2009;</li>
<li>20 Mar 2009; 20 March 2009; 20 Mar. 2009; 20 March, 2009</li>
<li>Mar 20th, 2009; Mar 21st, 2009; Mar 22nd, 2009</li>
<li>Feb 2009; Sep 2009; Oct 2010</li>
<li>6/2008; 12/2009</li>
<li>2009; 2010</li>
</ul>
<p>Once you have extracted these date patterns from the text, the next step is to sort them in ascending chronological order accoring to the following rules:</p>
<ul class="simple">
<li>Assume all dates in xx/xx/xx format are mm/dd/yy</li>
<li>Assume all dates where year is encoded in only two digits are years from the 1900's (e.g. 1/5/89 is January 5th, 1989)</li>
<li>If the day is missing (e.g. 9/2009), assume it is the first day of the month (e.g. September 1, 2009).</li>
<li>If the month is missing (e.g. 2010), assume it is the first of January of that year (e.g. January 1, 2010).</li>
</ul>
<p>With these rules in mind, find the correct date in each note and return a pandas Series in chronological order of the original Series' indices.</p>
<p>For example if the original series was this:</p>
<pre class="literal-block">
0    1999
1    2010
2    1978
3    2015
4    1985
</pre>
<pre class="literal-block">
0    2
1    4
2    0
3    1
4    3
</pre>
<p>Your score will be calculated using <a class="reference external" href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient">Kendall's tau</a>, a correlation measure for ordinal data.</p>
<p><strong>This function should return a Series of length 500 and dtype int.</strong></p>
</div>
<div class="section" id="imports">
<h2>2 Imports</h2>
<pre class="code ipython"><a name="rest_code_9b631790537144579c83f03f88990bad-1"></a><span class="c1"># from pypi</span>
<a name="rest_code_9b631790537144579c83f03f88990bad-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
</pre>
</div>
<div class="section" id="loading-the-data">
<h2>3 Loading The Data</h2>
<pre class="code ipython"><a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'dates.txt'</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-2"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-3"></a>
<a name="rest_code_2c38b1d8ee0947dfa6623e4f2a5beddc-4"></a><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre>
<pre class="literal-block">
0         03/25/93 Total time of visit (in minutes):\n
1                       6/18/85 Primary Care Doctor:\n
2    sshe plans to move as of 7/8/71 In-Home Servic...
3                7 on 9/27/75 Audit C Score Current:\n
4    2/6/96 sleep studyPain Treatment Pain Level (N...
5                    .Per 7/06/79 Movement D/O note:\n
6    4, 5/18/78 Patient's thoughts about current su...
7    10/24/89 CPT Code: 90801 - Psychiatric Diagnos...
8                         3/7/86 SOS-10 Total Score:\n
9             (4/10/71)Score-1Audit C Score Current:\n
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_57ded1fdca904a5988df20f362cd4ec4-1"></a><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre>
<pre class="literal-block">
count                                                   500
unique                                                  500
top       sApproximately 7 psychiatric hospitalizations ...
freq                                                      1
dtype: object
</pre>
</div>
<div class="section" id="the-grammar">
<h2>4 The Grammar</h2>
<div class="section" id="cardinality">
<h3>4.1 Cardinality</h3>
<pre class="code ipython"><a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-1"></a><span class="n">ZERO_OR_MORE</span> <span class="o">=</span> <span class="s1">'*'</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-2"></a><span class="n">ONE_OR_MORE</span> <span class="o">=</span> <span class="s2">"+"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-3"></a><span class="n">ZERO_OR_ONE</span> <span class="o">=</span> <span class="s1">'?'</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-4"></a><span class="n">EXACTLY_TWO</span> <span class="o">=</span> <span class="s2">"{2}"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-5"></a><span class="n">ONE_OR_TWO</span> <span class="o">=</span> <span class="s2">"{1,2}"</span>
<a name="rest_code_2e312da055d64864a51ab8189d4ca7e5-6"></a><span class="n">EXACTLY_ONE</span> <span class="o">=</span> <span class="s1">'{1}'</span>
</pre>
</div>
<div class="section" id="groups-and-classes">
<h3>4.2 Groups and Classes</h3>
<pre class="code ipython"><a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-1"></a><span class="n">GROUP</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"({})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-2"></a><span class="n">NAMED</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"(?P&lt;{}&gt;{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-3"></a><span class="n">CLASS</span> <span class="o">=</span> <span class="s2">"[{}]"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-4"></a><span class="n">NEGATIVE_LOOKAHEAD</span> <span class="o">=</span> <span class="s2">"(?!{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-5"></a><span class="n">NEGATIVE_LOOKBEHIND</span> <span class="o">=</span> <span class="s2">"(?&lt;!{})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-6"></a><span class="n">POSITIVE_LOOKAHEAD</span> <span class="o">=</span> <span class="s2">"(?={})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-7"></a><span class="n">POSITIVE_LOOKBEHIND</span> <span class="o">=</span> <span class="s2">"(?&lt;={})"</span>
<a name="rest_code_0b626c76eb924f13803ea3b49573cc1d-8"></a><span class="n">ESCAPE</span> <span class="o">=</span> <span class="s2">"\{}"</span>
</pre>
</div>
<div class="section" id="numbers">
<h3>4.3 Numbers</h3>
<pre class="code ipython"><a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-1"></a><span class="n">DIGIT</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"\d"</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-2"></a><span class="n">ONE_DIGIT</span>  <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_ONE</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-3"></a><span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-4"></a><span class="n">NON_DIGIT</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKAHEAD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DIGIT</span><span class="p">)</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-5"></a><span class="n">TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_TWO</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-6"></a><span class="n">THREE_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="s2">"{3}"</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-7"></a><span class="n">EXACTLY_TWO_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">EXACTLY_TWO</span> <span class="o">+</span> <span class="n">NON_DIGIT</span>
<a name="rest_code_066bf65d5ab14ea0ac7a331e1eb77945-8"></a><span class="n">FOUR_DIGITS</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">"{4}"</span> <span class="o">+</span> <span class="n">NON_DIGIT</span>
</pre>
</div>
<div class="section" id="string-literals">
<h3>4.4 String Literals</h3>
<pre class="code ipython"><a name="rest_code_8d32b18c02d04df28379534a1c7949b0-1"></a><span class="n">SLASH</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"/"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-2"></a><span class="n">OR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'|'</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-3"></a><span class="n">LOWER_CASE</span> <span class="o">=</span> <span class="s2">"a-z"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-4"></a><span class="n">SPACE</span> <span class="o">=</span> <span class="s2">"\s"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-5"></a><span class="n">DOT</span> <span class="o">=</span> <span class="s2">"."</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-6"></a><span class="n">DASH</span> <span class="o">=</span> <span class="s2">"-"</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-7"></a><span class="n">COMMA</span> <span class="o">=</span> <span class="s2">","</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-8"></a><span class="n">PUNCTUATION</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DOT</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">DASH</span><span class="p">)</span>
<a name="rest_code_8d32b18c02d04df28379534a1c7949b0-9"></a><span class="n">EMPTY_STRING</span> <span class="o">=</span> <span class="s2">""</span>
</pre>
</div>
<div class="section" id="dates">
<h3>4.5 Dates</h3>
<p>These are parts to build up the date-expressions.</p>
<pre class="code ipython"><a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-1"></a><span class="n">MONTH_SUFFIX</span> <span class="o">=</span> <span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ZERO_OR_MORE</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-2"></a>                <span class="o">+</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SPACE</span> <span class="o">+</span> <span class="n">DOT</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">DASH</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span><span class="p">)</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-3"></a><span class="n">MONTH_PREFIXES</span> <span class="o">=</span> <span class="s2">"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-4"></a><span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span><span class="n">month</span> <span class="o">+</span> <span class="n">MONTH_SUFFIX</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTH_PREFIXES</span><span class="p">]</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-5"></a><span class="n">MONTHS</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MONTHS</span><span class="p">))</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-6"></a><span class="n">DAY_SUFFIX</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DASH</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ONE_OR_TWO</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-7"></a><span class="n">DAYS</span> <span class="o">=</span> <span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">+</span> <span class="n">DAY_SUFFIX</span>
<a name="rest_code_47ad7ae9f20e4726b34f7b2805fa6487-8"></a><span class="n">YEAR</span> <span class="o">=</span> <span class="n">FOUR_DIGITS</span>
</pre>
<p>This is for dates like <em>Mar 21st, 2009</em>, those with suffixes on the days.</p>
<pre class="code ipython"><a name="rest_code_64197d882bd04964b03a78b818a7439e-1"></a><span class="n">CONTRACTED</span> <span class="o">=</span> <span class="p">(</span><span class="n">ONE_OR_TWO_DIGITS</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-2"></a>              <span class="o">+</span> <span class="n">LOWER_CASE</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-3"></a>              <span class="o">+</span> <span class="n">EXACTLY_TWO</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-4"></a>              <span class="p">)</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-5"></a><span class="n">CONTRACTION</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"contraction"</span><span class="p">,</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-6"></a>                           <span class="n">MONTHS</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-7"></a>                           <span class="o">+</span> <span class="n">CONTRACTED</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-8"></a>                           <span class="o">+</span> <span class="n">DAY_SUFFIX</span>
<a name="rest_code_64197d882bd04964b03a78b818a7439e-9"></a>                           <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for dates that have no days in them, like <em>May 2009</em>.</p>
<pre class="code ipython"><a name="rest_code_88d6900b06dd48868e9b47e314a3552e-1"></a><span class="n">NO_DAY_BEHIND</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span>
<a name="rest_code_88d6900b06dd48868e9b47e314a3552e-2"></a><span class="n">NO_DAY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"no_day"</span><span class="p">,</span> <span class="n">NO_DAY_BEHIND</span> <span class="o">+</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for the most common form (that I use) - <em>May 21, 2017</em>.</p>
<pre class="code ipython"><a name="rest_code_87c43c521ca64721be5846e6e2899c17-1"></a><span class="n">WORDS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"words"</span><span class="p">,</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">DAYS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is for the case where the day is placed before them month - <em>20 March, 2009</em>.</p>
<pre class="code ipython"><a name="rest_code_64130b76c99e449d968c5cffe7f9c8e1-1"></a><span class="n">BACKWARDS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"backwards"</span><span class="p">,</span> <span class="n">ONE_OR_TWO_DIGITS</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">MONTHS</span> <span class="o">+</span> <span class="n">YEAR</span><span class="p">)</span>
</pre>
<p>This is the case where slashes are used but only two digits were used for the year (so we're assuming it's in the twentieth century) - <em>8/4/98</em>.</p>
<pre class="code ipython"><a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-1"></a><span class="n">slashed</span> <span class="o">=</span> <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-2"></a>                      <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-3"></a>                      <span class="n">EXACTLY_TWO_DIGITS</span><span class="p">])</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-4"></a><span class="n">dashed</span> <span class="o">=</span> <span class="n">DASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-5"></a>                    <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-6"></a>                    <span class="n">EXACTLY_TWO_DIGITS</span><span class="p">])</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-7"></a><span class="n">TWENTIETH_CENTURY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"twentieth"</span><span class="p">,</span>
<a name="rest_code_716a12861d7d4aac8487fd9a9e3e22d0-8"></a>                                 <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">slashed</span><span class="p">,</span> <span class="n">dashed</span><span class="p">]))</span>
</pre>
<p>This is the case where digits with slashes are used and all four digits are used for the year - <em>8/4/1998</em>.</p>
<pre class="code ipython"><a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-1"></a><span class="n">NUMERIC</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"numeric"</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-2"></a>                       <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-3"></a>                                   <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span>
<a name="rest_code_b89dd1204ae94e6f86ef999cfb4c62b6-4"></a>                                   <span class="n">FOUR_DIGITS</span><span class="p">]))</span>
</pre>
<p>This is the case where only month and year are given as digits - <em>9/2009</em>. There are two expressions, because the day can be one or two digits.</p>
<pre class="code ipython"><a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-1"></a><span class="n">NO_PRECEDING_SLASH</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-2"></a><span class="n">NO_PRECEDING_SLASH_DIGIT</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span> <span class="o">+</span> <span class="n">DIGIT</span><span class="p">))</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-3"></a><span class="n">NO_ONE_DAY</span> <span class="o">=</span> <span class="p">(</span><span class="n">NO_PRECEDING_SLASH_DIGIT</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-4"></a>              <span class="o">+</span> <span class="n">ONE_DIGIT</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-5"></a>              <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-6"></a>              <span class="o">+</span> <span class="n">FOUR_DIGITS</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-7"></a><span class="n">NO_TWO_DAYS</span> <span class="o">=</span> <span class="p">(</span><span class="n">NO_PRECEDING_SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-8"></a>               <span class="o">+</span> <span class="n">TWO_DIGITS</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-9"></a>               <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-10"></a>               <span class="o">+</span> <span class="n">FOUR_DIGITS</span><span class="p">)</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-11"></a><span class="n">NO_DAY_NUMERIC</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"no_day_numeric"</span><span class="p">,</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-12"></a>                              <span class="n">NO_ONE_DAY</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-13"></a>                              <span class="o">+</span> <span class="n">OR</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-14"></a>                              <span class="o">+</span> <span class="n">NO_TWO_DAYS</span>
<a name="rest_code_4d140cc2e5974d789b0ce17b7ba5aff2-15"></a>                              <span class="p">)</span>
</pre>
<p>This is the case where only a year was given. This is the hardest case, since you don't want to accidentally match the other cases, but the text preceding and following it could be anything. For the look-behind, all the cases have to have the same number of characters so we can't re-use the other expressions</p>
<pre class="code ipython"><a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-1"></a><span class="n">CENTURY</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'19'</span> <span class="o">+</span> <span class="n">OR</span> <span class="o">+</span> <span class="s2">"20"</span><span class="p">)</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-2"></a><span class="n">DIGIT_SLASH</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SLASH</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-3"></a><span class="n">DIGIT_DASH</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">DASH</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-4"></a><span class="n">DIGIT_SPACE</span> <span class="o">=</span> <span class="n">DIGIT</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-5"></a><span class="n">LETTER_SPACE</span> <span class="o">=</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-6"></a><span class="n">COMMA_SPACE</span> <span class="o">=</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-7"></a><span class="n">YEAR_PREFIX</span> <span class="o">=</span> <span class="n">NEGATIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-8"></a>    <span class="n">DIGIT_SLASH</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-9"></a>    <span class="n">DIGIT_DASH</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-10"></a>    <span class="n">DIGIT_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-11"></a>    <span class="n">LETTER_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-12"></a>    <span class="n">COMMA_SPACE</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-13"></a><span class="p">]))</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-14"></a>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-15"></a><span class="n">YEAR_ONLY</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"year_only"</span><span class="p">,</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-16"></a>                         <span class="n">YEAR_PREFIX</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_923226dbfcce4528ac87cca7a412fa5e-17"></a><span class="p">)</span>
</pre>
<p>These are leftovers that don't really match anything.</p>
<pre class="code ipython"><a name="rest_code_2255d8380ad6401cbe389a36a364eaff-1"></a><span class="n">IN_PREFIX</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'iI'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'n'</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-2"></a><span class="n">SINCE_PREFIX</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Ss"</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'ince'</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-3"></a><span class="n">AGE</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Age"</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-4"></a><span class="n">AGE_COMMA</span> <span class="o">=</span> <span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Age"</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span> <span class="o">+</span> <span class="n">TWO_DIGITS</span> <span class="o">+</span> <span class="n">COMMA</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-5"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'delivery'</span><span class="p">,</span> <span class="s2">"quit"</span><span class="p">,</span> <span class="s2">"attempt"</span><span class="p">,</span> <span class="s2">"nephrectomy"</span><span class="p">,</span> <span class="n">THREE_DIGITS</span><span class="p">]</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-6"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">POSITIVE_LOOKBEHIND</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="n">SPACE</span><span class="p">)</span> <span class="o">+</span> <span class="n">CENTURY</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">OTHERS</span><span class="p">]</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-7"></a><span class="n">OTHERS</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OTHERS</span><span class="p">)</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-8"></a><span class="n">LEFTOVERS_PREFIX</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">IN_PREFIX</span><span class="p">,</span> <span class="n">SINCE_PREFIX</span><span class="p">,</span> <span class="n">AGE</span><span class="p">,</span> <span class="n">AGE_COMMA</span><span class="p">])</span> <span class="o">+</span> <span class="n">OR</span> <span class="o">+</span> <span class="n">OTHERS</span>
<a name="rest_code_2255d8380ad6401cbe389a36a364eaff-9"></a><span class="n">LEFTOVERS</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"leftovers"</span><span class="p">,</span> <span class="n">LEFTOVERS_PREFIX</span><span class="p">)</span>
</pre>
<p>This is the combined expression for all the dates - the one that should be used to extract them from the data.</p>
<pre class="code ipython"><a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-1"></a><span class="n">DATE</span> <span class="o">=</span> <span class="n">NAMED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">NUMERIC</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-2"></a>                                     <span class="n">TWENTIETH_CENTURY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-3"></a>                                     <span class="n">WORDS</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-4"></a>                                     <span class="n">BACKWARDS</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-5"></a>                                     <span class="n">CONTRACTION</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-6"></a>                                     <span class="n">NO_DAY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-7"></a>                                     <span class="n">NO_DAY_NUMERIC</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-8"></a>                                     <span class="n">YEAR_ONLY</span><span class="p">,</span>
<a name="rest_code_fc2bde03f0ea41e9aa371ae7acff5eb8-9"></a>                                     <span class="n">LEFTOVERS</span><span class="p">]))</span>
</pre>
<pre class="code ipython"><a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-1"></a><span class="k">def</span> <span class="nf">twentieth_century</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-2"></a>    <span class="sd">"""adds a 19 to the year</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-3"></a>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-5"></a><span class="sd">     date (re.Regex): Extracted date</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-6"></a><span class="sd">    """</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-7"></a>    <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-8"></a>    <span class="n">year</span> <span class="o">=</span> <span class="s2">"19{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
<a name="rest_code_ece947ef32c3471a8ba5f9a078507b5e-9"></a>    <span class="k">return</span> <span class="n">SLASH</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_6de3e020d2fb476caba774a582541806-1"></a><span class="k">def</span> <span class="nf">take_two</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-2"></a>    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">TWENTIETH_CENTURY</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-3"></a>    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-4"></a>        <span class="k">return</span> <span class="n">twentieth_century</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
<a name="rest_code_6de3e020d2fb476caba774a582541806-5"></a>    <span class="k">return</span> <span class="n">line</span>
</pre>
</div>
</div>
<div class="section" id="applying-the-grammer">
<h2>5 Applying The Grammer</h2>
<pre class="code ipython"><a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-1"></a><span class="k">def</span> <span class="nf">extract_and_count</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-2"></a>    <span class="sd">"""extract all matches and report the count</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-3"></a>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-5"></a><span class="sd">     expression (str): regular expression to match</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-6"></a><span class="sd">     data (pandas.Series): data with dates to extratc</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-7"></a><span class="sd">     name (str): name of the group for the expression</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-8"></a>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-10"></a><span class="sd">     tuple (pandas.Series, int): extracted dates, count</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-11"></a><span class="sd">    """</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-12"></a>    <span class="n">extracted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">expression</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-13"></a>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-14"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"'{}' matched {} rows"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
<a name="rest_code_532a04c46a31499aa7d83e2574dab1b8-15"></a>    <span class="k">return</span> <span class="n">extracted</span><span class="p">,</span> <span class="n">count</span>
</pre>
<pre class="code ipython"><a name="rest_code_63aead1280094848a5ebbfe01e78cccf-1"></a><span class="n">numeric</span><span class="p">,</span> <span class="n">numeric_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NUMERIC</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'numeric'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'numeric' matched 25 rows
</pre>
<pre class="code ipython"><a name="rest_code_97322d2aec224ba7bbb9f48697b64d0b-1"></a><span class="n">twentieth</span><span class="p">,</span> <span class="n">twentieth_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">TWENTIETH_CENTURY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'twentieth'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'twentieth' matched 100 rows
</pre>
<pre class="code ipython"><a name="rest_code_ca85b3c6e1c44f678fd7d3101ed02935-1"></a><span class="n">words</span><span class="p">,</span> <span class="n">words_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">WORDS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'words'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'words' matched 34 rows
</pre>
<pre class="code ipython"><a name="rest_code_3c14eab4f1ab4f7d9914e4dc1d3aaac6-1"></a><span class="n">backwards</span><span class="p">,</span> <span class="n">backwards_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">BACKWARDS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'backwards'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'backwards' matched 69 rows
</pre>
<pre class="code ipython"><a name="rest_code_a146a4d183cf48039637b7d71611679a-1"></a><span class="n">contraction_data</span><span class="p">,</span> <span class="n">contraction</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">CONTRACTION</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'contraction'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'contraction' matched 0 rows
</pre>
<pre class="code ipython"><a name="rest_code_a72ab48d948d46be864df3b547f2b1d3-1"></a><span class="n">no_day</span><span class="p">,</span> <span class="n">no_day_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NO_DAY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">'no_day'</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'no_day' matched 115 rows
</pre>
<pre class="code ipython"><a name="rest_code_38ddb6bb04124a33baa4f3ee13bda526-1"></a><span class="n">no_day_numeric</span><span class="p">,</span> <span class="n">no_day_numeric_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">NO_DAY_NUMERIC</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<a name="rest_code_38ddb6bb04124a33baa4f3ee13bda526-2"></a>                                                         <span class="s2">"no_day_numeric"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'no_day_numeric' matched 112 rows
</pre>
<pre class="code ipython"><a name="rest_code_328d16933ace4fb6b298976941bd57a9-1"></a><span class="n">year_only</span><span class="p">,</span> <span class="n">year_only_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">YEAR_ONLY</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">"year_only"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'year_only' matched 15 rows
</pre>
<pre class="code ipython"><a name="rest_code_eb1ef7f0d59e496d942d099e9ca6aeda-1"></a><span class="n">leftovers</span><span class="p">,</span> <span class="n">leftovers_count</span> <span class="o">=</span> <span class="n">extract_and_count</span><span class="p">(</span><span class="n">LEFTOVERS</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">"leftovers"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
'leftovers' matched 30 rows
</pre>
<pre class="code ipython"><a name="rest_code_3c2079d77eec447ea7842e050ebb187c-1"></a><span class="n">found</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DATE</span><span class="p">)</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-2"></a><span class="n">total_found</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-3"></a>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-4"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Total Found: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_found</span><span class="p">))</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-5"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Remaining: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">total_found</span><span class="p">))</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-6"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Discrepancy: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_found</span> <span class="o">-</span> <span class="p">(</span><span class="n">numeric_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-7"></a>                                              <span class="o">+</span> <span class="n">twentieth_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-8"></a>                                              <span class="o">+</span> <span class="n">words_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-9"></a>                                              <span class="o">+</span> <span class="n">backwards_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-10"></a>                                              <span class="o">+</span> <span class="n">contraction</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-11"></a>                                              <span class="o">+</span> <span class="n">no_day_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-12"></a>                                              <span class="o">+</span> <span class="n">no_day_numeric_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-13"></a>                                              <span class="o">+</span> <span class="n">year_only_count</span>
<a name="rest_code_3c2079d77eec447ea7842e050ebb187c-14"></a>                                              <span class="o">+</span> <span class="n">leftovers_count</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
Total Found: 500
Remaining: 0
Discrepancy: 0
</pre>
<pre class="code ipython"><a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-1"></a><span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-2"></a><span class="k">try</span><span class="p">:</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-3"></a>    <span class="k">print</span><span class="p">(</span><span class="n">missing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">missing</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-4"></a><span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
<a name="rest_code_230c2cc41b3046dd89e31fd65fd5d156-5"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"all rows matched"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
all rows matched
</pre>
</div>
<div class="section" id="unifying-the-formats">
<h2>6 Unifying the Formats</h2>
<p>To make it simpler, I'm going to use the <tt class="docutils literal">mm/dd/yyyy</tt> format for the dates. I'm going to use the extracted series to avoid having different clean-up cases contaminating each other - e.g. dealing with 'January' when the day comes first as opposed to when the month comes first.</p>
<div class="section" id="helper-functions">
<h3>6.1 Helper Functions</h3>
<div class="section" id="clean">
<h4>6.1.1 Clean</h4>
<p>This is a generic function to clean up some data. I was initially using it directly, but for cases where the expression and replacement function are used more than once, there are helper functions to make it easier.</p>
<pre class="code ipython"><a name="rest_code_26a70e05d01c41cc987bece031f5383d-1"></a><span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-2"></a>    <span class="sd">"""applies the replacement to the source</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-3"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-4"></a><span class="sd">    as a side-effect shows sample rows before and after</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-5"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-6"></a><span class="sd">    Args:</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-7"></a><span class="sd">     source (pandas.Series): source of the strings</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-8"></a><span class="sd">     expression (str): regular expression to match what to replace</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-9"></a><span class="sd">     replacement: function or expression to replace the matching expression</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-10"></a><span class="sd">     sample (int): number of randomly chosen examples to show</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-11"></a>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-12"></a><span class="sd">    Returns:</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-13"></a><span class="sd">     pandas.Series: the source with the replacement applied to it</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-14"></a><span class="sd">    """</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-15"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Random Sample Before:"</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-16"></a>    <span class="k">print</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-17"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-18"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Sample After:"</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-19"></a>    <span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-20"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Count of cleaned: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)))</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-21"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_26a70e05d01c41cc987bece031f5383d-22"></a>    <span class="k">return</span> <span class="n">cleaned</span>
</pre>
</div>
<div class="section" id="clean-punctuation">
<h4>6.1.2 Clean Punctuation</h4>
<pre class="code ipython"><a name="rest_code_a48cfea51ef94f539affe06202de9df7-1"></a><span class="k">def</span> <span class="nf">clean_punctuation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-2"></a>    <span class="sd">"""removes punctuation</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-3"></a>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-4"></a><span class="sd">    Args:</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-5"></a><span class="sd">     source (pandas.Series): data to clean</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-6"></a><span class="sd">     sample (int): size of sample to show</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-7"></a>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-9"></a><span class="sd">     pandas.Series: source with punctuation removed</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-10"></a><span class="sd">    """</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-11"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Cleaning Punctuation"</span><span class="p">)</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-12"></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">PUNCTUATION</span><span class="p">)):</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-13"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">PUNCTUATION</span><span class="p">,</span> <span class="n">EMPTY_STRING</span><span class="p">)</span>
<a name="rest_code_a48cfea51ef94f539affe06202de9df7-14"></a>    <span class="k">return</span> <span class="n">source</span>
</pre>
</div>
<div class="section" id="convert-long-month-names-to-three-letter-names">
<h4>6.1.3 Convert Long Month Names to Three-Letter Names</h4>
<pre class="code ipython"><a name="rest_code_4682e078636b4cfc87b46112d727633b-1"></a><span class="n">LONG_TO_SHORT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">January</span><span class="o">=</span><span class="s2">"Jan"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-2"></a>                     <span class="n">February</span><span class="o">=</span><span class="s2">"Feb"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-3"></a>                     <span class="n">March</span><span class="o">=</span><span class="s2">"Mar"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-4"></a>                     <span class="n">April</span><span class="o">=</span><span class="s2">"Apr"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-5"></a>                     <span class="n">May</span><span class="o">=</span><span class="s2">"May"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-6"></a>                     <span class="n">June</span><span class="o">=</span><span class="s2">"Jun"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-7"></a>                     <span class="n">July</span><span class="o">=</span><span class="s2">"Jul"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-8"></a>                     <span class="n">August</span><span class="o">=</span><span class="s2">"Aug"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-9"></a>                     <span class="n">September</span><span class="o">=</span><span class="s2">"Sep"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-10"></a>                     <span class="n">October</span><span class="o">=</span><span class="s2">"Oct"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-11"></a>                     <span class="n">November</span><span class="o">=</span><span class="s2">"Nov"</span><span class="p">,</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-12"></a>                     <span class="n">December</span><span class="o">=</span><span class="s2">"Dec"</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-13"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-14"></a><span class="c1"># it turns out there are spelling errors in the data so this has to be fuzzy</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-15"></a><span class="n">LONG_TO_SHORT_EXPRESSION</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-16"></a>                                    <span class="o">+</span> <span class="n">CLASS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LOWER_CASE</span><span class="p">)</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-17"></a>                                    <span class="o">+</span> <span class="n">ZERO_OR_MORE</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-18"></a>                                    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">LONG_TO_SHORT</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-19"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-20"></a><span class="k">def</span> <span class="nf">long_month_to_short</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-21"></a>    <span class="sd">"""convert long month to short</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-22"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-23"></a><span class="sd">    Args:</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-24"></a><span class="sd">     match (re.Match): object matching a long month</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-25"></a>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-26"></a><span class="sd">    Returns:</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-27"></a><span class="sd">     str: shortened version of the month</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-28"></a><span class="sd">    """</span>
<a name="rest_code_4682e078636b4cfc87b46112d727633b-29"></a>    <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">lastindex</span><span class="p">)</span>
</pre>
<p>This next function is the one you would actually use to make the conversion.</p>
<pre class="code ipython"><a name="rest_code_33736a1f662e47018e28cba7502b4452-1"></a><span class="k">def</span> <span class="nf">convert_long_months_to_short</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-2"></a>    <span class="sd">"""convert long month names to short</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-3"></a>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-4"></a><span class="sd">    Args:</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-5"></a><span class="sd">     source (pandas.Series): data with months</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-6"></a><span class="sd">     sample (int): size of sample to show</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-7"></a>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-9"></a><span class="sd">     pandas.Series: data with short months</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-10"></a><span class="sd">    """</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-12"></a>                 <span class="n">LONG_TO_SHORT_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_33736a1f662e47018e28cba7502b4452-13"></a>                 <span class="n">long_month_to_short</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="add-january-1-to-year-only-dates">
<h4>6.1.4 Add January 1 to year-only dates</h4>
<pre class="code ipython"><a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-1"></a><span class="k">def</span> <span class="nf">add_month_date</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-2"></a>    <span class="sd">"""adds 01/01 to years</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-3"></a>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-4"></a><span class="sd">    Args:</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-5"></a><span class="sd">     match (re.Match): object that only matched a 4-digit year</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-6"></a>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-8"></a><span class="sd">     str: 01/01/YYYY</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-9"></a><span class="sd">    """</span>
<a name="rest_code_1d4bf34ce7224d8f83445179ce28f7d2-10"></a>    <span class="k">return</span> <span class="s2">"01/01/"</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</pre>
<p>And now the function to actually call.</p>
<pre class="code ipython"><a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-1"></a><span class="k">def</span> <span class="nf">add_january_one</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-2"></a>    <span class="sd">"""adds /01/01/ to year-only dates</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-3"></a>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-4"></a><span class="sd">    Args:</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-5"></a><span class="sd">     source (pandas.Series): data with the dates</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-6"></a>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-8"></a><span class="sd">     pandas.Series: years in source with /01/01/ added</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-9"></a><span class="sd">    """</span>
<a name="rest_code_5f2ef25af7ea46c4bb713ef8f00ae7fc-10"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">YEAR_ONLY</span><span class="p">,</span> <span class="n">add_month_date</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="two-digit-numbers">
<h4>6.1.5 Two-Digit Numbers</h4>
<p>This makes sure that there are exactly two digits in a number, adding a leading zero if needed.</p>
<pre class="code ipython"><a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-1"></a><span class="n">two_digit_expression</span> <span class="o">=</span> <span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ONE_OR_TWO_DIGITS</span><span class="p">)</span> <span class="o">+</span> <span class="n">POSITIVE_LOOKAHEAD</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-2"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-3"></a><span class="k">def</span> <span class="nf">two_digits</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-4"></a>    <span class="sd">"""add a leading zero if needed</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-5"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-6"></a><span class="sd">    Args:</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-7"></a><span class="sd">     match (re.Match): match with one or two digits</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-8"></a>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-10"></a><span class="sd">     str: the matched string with leading zero if needed</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-11"></a><span class="sd">    """</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-12"></a>    <span class="c1"># for some reason the string-formatting raises an error if it's a string</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-13"></a>    <span class="c1"># so cast it to an int</span>
<a name="rest_code_e6e899f4ef50407ab134a96cac8b3678-14"></a>    <span class="k">return</span> <span class="s2">"{:02}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>
</pre>
<p>This is the function to call for the case where the number is followed by a slash (e.g. <tt class="docutils literal">2/</tt>).</p>
<pre class="code ipython"><a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-1"></a><span class="k">def</span> <span class="nf">clean_two_digits</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-2"></a>    <span class="sd">"""makes sure source has two-digits</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-3"></a>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-4"></a><span class="sd">    Args:</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-5"></a><span class="sd">     source (pandas.Series): data with digit followed by slash</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-7"></a>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-9"></a><span class="sd">     pandas.Series: source with digits coerced to two digits</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-10"></a><span class="sd">    """</span>
<a name="rest_code_9dbbee1a5c284b14a8dd95a0d061f406-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">two_digit_expression</span><span class="p">,</span> <span class="n">two_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre>
<p>This is like <tt class="docutils literal">clean_two_digits</tt> but it doesn't check for the trailing slash. Use this if you have an isolated column of numbers that need to be two-digits.</p>
<pre class="code ipython"><a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-1"></a><span class="k">def</span> <span class="nf">clean_two_digits_isolated</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-2"></a>    <span class="sd">"""cleans two digits that are standalone</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-3"></a>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-4"></a><span class="sd">    Args:</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-5"></a><span class="sd">     source (pandas.Series): source of the data</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-7"></a>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-9"></a><span class="sd">     pandas.Series: converted data</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-10"></a><span class="sd">    """</span>
<a name="rest_code_ccc8f275e4ab4f4583ff735769cac377-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">ONE_OR_TWO_DIGITS</span><span class="p">,</span> <span class="n">two_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="cleaning-up-months">
<h4>6.1.6 Cleaning Up Months</h4>
<p>These clean up and convert written months (e.g. change <tt class="docutils literal">Aug</tt> to <tt class="docutils literal">08</tt>).</p>
<pre class="code ipython"><a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-1"></a><span class="n">digits</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"{:02}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-2"></a><span class="n">MONTH_TO_DIGITS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">MONTH_PREFIXES</span><span class="p">,</span> <span class="n">digits</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-3"></a><span class="n">SHORT_MONTHS_EXPRESSION</span> <span class="o">=</span> <span class="n">OR</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">GROUP</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTH_TO_DIGITS</span><span class="p">))</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-4"></a><span class="k">def</span> <span class="nf">month_to_digits</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-5"></a>    <span class="sd">"""converts short month to digits</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-6"></a>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-7"></a><span class="sd">    Args:</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-8"></a><span class="sd">     match (re.Match): object with short-month</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-9"></a>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-10"></a><span class="sd">    Returns:</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-11"></a><span class="sd">     str: month as two-digit number (e.g. Jan -&gt; 01)</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-12"></a><span class="sd">    """</span>
<a name="rest_code_67be1efdfee64e69b7a2632858aa3b6c-13"></a>    <span class="k">return</span> <span class="n">MONTH_TO_DIGITS</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()]</span>
</pre>
<pre class="code ipython"><a name="rest_code_6073b8397d994280aad16a5dc7c7943e-1"></a><span class="k">def</span> <span class="nf">convert_short_month_to_digits</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-2"></a>    <span class="sd">"""converts three-letter months to two-digits</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-3"></a>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-5"></a><span class="sd">     source (pandas.Series): data with three-letter months</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-6"></a><span class="sd">     sample (int): number of samples to show</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-7"></a>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-8"></a><span class="sd">    Returns:</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-9"></a><span class="sd">     pandas.Series: source with short-months coverted to digits</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-10"></a><span class="sd">    """</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-11"></a>    <span class="k">return</span> <span class="n">clean</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-12"></a>                 <span class="n">SHORT_MONTHS_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-13"></a>                 <span class="n">month_to_digits</span><span class="p">,</span>
<a name="rest_code_6073b8397d994280aad16a5dc7c7943e-14"></a>                 <span class="n">sample</span><span class="p">)</span>
</pre>
<p>This function runs the previous three and is the main one that should be used. The others can be run individually for troubleshooting, though.</p>
<pre class="code ipython"><a name="rest_code_c7fb3254c651489e904705f74c039fe8-1"></a><span class="k">def</span> <span class="nf">clean_months</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-2"></a>    <span class="sd">"""clean up months (which start as words)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-3"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-5"></a><span class="sd">     source (pandas.Series): source of the months</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-6"></a><span class="sd">     sample (int): number of random samples to show</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-7"></a><span class="sd">    """</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-8"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean_punctuation</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-9"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-10"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Converting long months to short"</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-11"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-12"></a>                    <span class="n">LONG_TO_SHORT_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-13"></a>                    <span class="n">long_month_to_short</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-14"></a>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-15"></a>    <span class="k">print</span><span class="p">(</span><span class="s2">"Converting short months to digits"</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-16"></a>    <span class="n">cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-17"></a>                    <span class="n">SHORT_MONTHS_EXPRESSION</span><span class="p">,</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-18"></a>                    <span class="n">month_to_digits</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
<a name="rest_code_c7fb3254c651489e904705f74c039fe8-19"></a>    <span class="k">return</span> <span class="n">cleaned</span>
</pre>
</div>
<div class="section" id="frame-to-series">
<h4>6.1.7 Frame To Series</h4>
<p>This is for the case where the date-fields were broken up into columns in a data-frame.</p>
<pre class="code ipython"><a name="rest_code_37f92571504c45af80c86f9c60aff53e-1"></a><span class="k">def</span> <span class="nf">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">index_source</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-2"></a>    <span class="sd">"""re-combines data-frame into a series</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-3"></a>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-4"></a><span class="sd">    Args:</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-5"></a><span class="sd">     frame (pandas.DataFrame): frame with month, day, year columns</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-6"></a><span class="sd">     index_source (pandas.series): source to copy index from</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-7"></a><span class="sd">     samples (index): number of random entries to print when done</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-8"></a>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-9"></a><span class="sd">    Returns:</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-10"></a><span class="sd">     pandas.Series: series with dates as month/day/year</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-11"></a><span class="sd">    """</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-12"></a>    <span class="n">combined</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="n">SLASH</span> <span class="o">+</span> <span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">+</span> <span class="n">SLASH</span> <span class="o">+</span> <span class="n">frame</span><span class="o">.</span><span class="n">year</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-13"></a>    <span class="n">combined</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_source</span><span class="o">.</span><span class="n">index</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-14"></a>    <span class="k">print</span><span class="p">(</span><span class="n">combined</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
<a name="rest_code_37f92571504c45af80c86f9c60aff53e-15"></a>    <span class="k">return</span> <span class="n">combined</span>
</pre>
</div>
</div>
<div class="section" id="year-only">
<h3>6.2 Year Only</h3>
<p>For the case where there is only a year, I'll add January 1 to the dates.</p>
<pre class="code ipython"><a name="rest_code_278f53251fdb4fc68b34e046c70b6a34-1"></a><span class="n">year_only_cleaned</span> <span class="o">=</span> <span class="n">add_january_one</span><span class="p">(</span><span class="n">year_only</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
472  0        2010
495  0        1979
497  0        2008
481  0        1974
486  0        1973
Name: year_only, dtype: object

Random Sample After:
     match
495  0        01/01/1979
470  0        01/01/1983
462  0        01/01/1988
481  0        01/01/1974
480  0        01/01/2013
Name: year_only, dtype: object

Count of cleaned: 15
</pre>
</div>
<div class="section" id="leftovers">
<h3>6.3 Leftovers</h3>
<p>These were the odd cases that didn't seem to have a real pattern. Since I used a positive lookbehind to match everything but the year they only have the years in them, like the previous year-only cases.</p>
<pre class="code ipython"><a name="rest_code_a7b366fae7df44e6b69648ba1bfffdf2-1"></a><span class="n">leftovers_cleaned</span> <span class="o">=</span> <span class="n">add_january_one</span><span class="p">(</span><span class="n">leftovers</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
487  0        1992
477  0        1994
498  0        2005
488  0        1977
484  0        2004
Name: leftovers, dtype: object

Random Sample After:
     match
464  0        01/01/2016
455  0        01/01/1984
465  0        01/01/1976
475  0        01/01/2015
498  0        01/01/2005
Name: leftovers, dtype: object

Count of cleaned: 30
</pre>
<pre class="code ipython"><a name="rest_code_a8ed56d0d0a94b23a883c68d0de11a23-1"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">year_only_cleaned</span><span class="p">,</span> <span class="n">leftovers_cleaned</span><span class="p">])</span>
<a name="rest_code_a8ed56d0d0a94b23a883c68d0de11a23-2"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
45
</pre>
</div>
<div class="section" id="no-day-numeric">
<h3>6.4 No Day Numeric</h3>
<p>This is for the case where the date is formatted with slashes and there are no day-values. To make the months uniform I'm going to make them all two-digits first.</p>
<pre class="code ipython"><a name="rest_code_4b9fb0f5efe2443fa421f624443f9079-1"></a><span class="n">no_day_numeric_cleaned</span> <span class="o">=</span> <span class="n">clean_two_digits</span><span class="p">(</span><span class="n">no_day_numeric</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
450  0         1/1994
374  0        11/2000
403  0        10/1981
454  0         7/1982
358  0         1/1983
Name: no_day_numeric, dtype: object

Random Sample After:
     match
426  0        11/1984
415  0        02/1973
360  0        12/2008
367  0        09/2001
362  0        08/2003
Name: no_day_numeric, dtype: object

Count of cleaned: 112
</pre>
<p>Now I'll add the day.</p>
<pre class="code ipython"><a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-1"></a><span class="n">no_day_numeric_cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">no_day_numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-2"></a>                               <span class="n">SLASH</span><span class="p">,</span>
<a name="rest_code_3c74d7a0e4cd47d2b745a2fd00045c03-3"></a>                               <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="s2">"/01/"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
368  0        08/1986
409  0        10/1994
443  0        09/2000
404  0        10/1986
395  0        02/1977
Name: no_day_numeric, dtype: object

Random Sample After:
     match
349  0        05/01/1987
392  0        05/01/2000
448  0        05/01/2010
394  0        10/01/2001
424  0        04/01/1979
Name: no_day_numeric, dtype: object

Count of cleaned: 112
</pre>
<p>And add it to the total.</p>
<pre class="code ipython"><a name="rest_code_c186131450e34793996aefde3d7e33e5-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_c186131450e34793996aefde3d7e33e5-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">no_day_numeric_cleaned</span><span class="p">])</span>
<a name="rest_code_c186131450e34793996aefde3d7e33e5-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">no_day_numeric_count</span> <span class="o">+</span> <span class="n">original</span>
</pre>
<pre class="code ipython"><a name="rest_code_3df8414b6ae0412494fc2d475c208687-1"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
157
</pre>
</div>
<div class="section" id="no-day">
<h3>6.5 No Day</h3>
<p>This is for cases like <em>Mar 2011</em> where no day was given. We're going to assume that it's the first day of the month for each case.</p>
<pre class="code ipython"><a name="rest_code_5ec35e8477ed4b75b14b1acea8d730f5-1"></a><span class="n">no_day_cleaned</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">no_day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
     match
261  0           Oct 1986
269  0          July 1992
280  0          July 1985
295  0         March 1983
339  0        March, 2005
Name: no_day, dtype: object

Random Sample After:
     match
228  0        September 1985
304  0              Mar 2002
253  0              Feb 2016
276  0            April 1986
272  0              Feb 1993
Name: no_day, dtype: object

Count of cleaned: 115
Converting long months to short
Random Sample Before:
     match
315  0             Jun 1976
242  0             Nov 2010
237  0        February 1976
330  0           April 1988
311  0        February 1995
Name: no_day, dtype: object

Random Sample After:
     match
306  0        May 2004
254  0        Aug 1979
269  0        Jul 1992
337  0        Dec 2007
241  0        May 2004
Name: no_day, dtype: object

Count of cleaned: 115
Converting short months to digits
Random Sample Before:
     match
268  0        Dec 2009
298  0        Jan 1993
296  0        Aug 1979
270  0        May 2006
320  0        Nov 2012
Name: no_day, dtype: object

Random Sample After:
     match
246  0        07 1981
286  0        01 2013
263  0        09 1981
276  0        04 1986
247  0        05 1983
Name: no_day, dtype: object

Count of cleaned: 115
</pre>
<p>Now we need to replace the spaces with the days.</p>
<pre class="code ipython"><a name="rest_code_e4c4257b864944be9a3724ac6b376a64-1"></a><span class="n">no_day_cleaned</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">no_day_cleaned</span><span class="p">,</span>
<a name="rest_code_e4c4257b864944be9a3724ac6b376a64-2"></a>                       <span class="n">SPACE</span> <span class="o">+</span> <span class="n">ONE_OR_MORE</span><span class="p">,</span>
<a name="rest_code_e4c4257b864944be9a3724ac6b376a64-3"></a>                       <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">"/01/"</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
     match
251  0        12 1998
290  0        12 2011
281  0        08 2004
308  0        02 1994
294  0        02 1983
Name: no_day, dtype: object

Random Sample After:
     match
304  0        03/01/2002
332  0        06/01/1974
310  0        10/01/1992
293  0        09/01/2008
322  0        10/01/1991
Name: no_day, dtype: object

Count of cleaned: 115
</pre>
<p>Now we can add it to the cleaned.</p>
<pre class="code ipython"><a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">no_day_cleaned</span><span class="p">])</span>
<a name="rest_code_3700c60a7fbc42ff864963c15b8cb50d-3"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
272
</pre>
<p>Now to make sure we're where we expect we are.</p>
<pre class="code ipython"><a name="rest_code_4af27b29ecac455da3c4e0d31c8d711b-1"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">no_day_count</span> <span class="o">+</span> <span class="n">original</span>
</pre>
</div>
<div class="section" id="contraction">
<h3>6.6 Contraction</h3>
<p>There were no matches for the contraction so I'll ignore it for now.</p>
</div>
<div class="section" id="backwards">
<h3>6.7 Backwards</h3>
<p>This is the case where the day comes first. The first thing I'll do is split them up.</p>
<pre class="code ipython"><a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">backwards</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="s2">"day month year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_9f1806b4291e4ebfa802e9259ffc9389-3"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  day month  year
0  24   Jan  2001
1  10   Sep  2004
2  26   May  1982
3  28  June  2002
4  06   May  1972
</pre>
<p>The next thing to do is to make sure the days all have two digits.</p>
<pre class="code ipython"><a name="rest_code_f6072f0515ec436a8714027b631047f4-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
31    26
39    21
4     06
57    13
36    19
Name: day, dtype: object

Random Sample After:
29    06
68    18
60    17
11    11
26    22
Name: day, dtype: object

Count of cleaned: 69
</pre>
<p>Next comes the months. This is basically the same problem as with the <em>no day</em> case so I'll re-use some of the code for that.</p>
<pre class="code ipython"><a name="rest_code_ab05fe73da44414cb294eb9f3502501c-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Converting long months to short
Random Sample Before:
55    Dec
41    Nov
38    Jan
54    Dec
5     Oct
Name: month, dtype: object

Random Sample After:
30    Oct
55    Dec
15    Feb
38    Jan
14    Oct
Name: month, dtype: object

Count of cleaned: 69
Converting short months to digits
Random Sample Before:
29    Mar
22    May
45    Jan
47    Aug
61    Oct
Name: month, dtype: object

Random Sample After:
16    05
32    02
4     05
68    01
38    01
Name: month, dtype: object

Count of cleaned: 69
</pre>
<p>Now we need to combine them back together. In hindsight it might have been easier to convert everything into data frames instead of the other way around. Or maybe not. Since we want the indexes from the original data as our final answer I also have to copy the index from the original series</p>
<pre class="code ipython"><a name="rest_code_62fe0d46ed274e2db3053d05f493ef5e-1"></a><span class="n">backwards_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">backwards</span><span class="p">)</span>
</pre>
<pre class="literal-block">
     match
177  0        01/18/1990
128  0        06/28/2002
181  0        08/18/1995
158  0        08/23/2000
185  0        08/17/1985
dtype: object
</pre>
<p>No it gets added to the combined series.</p>
<pre class="code ipython"><a name="rest_code_555c71acd16b47558ef5c9c343044db5-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_555c71acd16b47558ef5c9c343044db5-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">backwards_cleaned</span><span class="p">])</span>
<a name="rest_code_555c71acd16b47558ef5c9c343044db5-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">backwards_count</span>
</pre>
<pre class="code ipython"><a name="rest_code_69e8faeacd0a4beaabb211af9573f40d-1"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
341
</pre>
</div>
<div class="section" id="words">
<h3>6.8 Words</h3>
<p>Since working with the data frame was easier than I though it would be I'll do that again.</p>
<pre class="code ipython"><a name="rest_code_7ba9ad608ca44fea9db0387aea288678-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"month day year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_7ba9ad608ca44fea9db0387aea288678-2"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
      month  day  year
0     April  11,  1990
1       May  30,  2001
2       Feb  18,  1994
3  February  18,  1981
4  October.  11,  2013
</pre>
<p>First we'll clean out the months.</p>
<pre class="code ipython"><a name="rest_code_d0f876a0c5d545248054176fe3b11a12-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_months</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
25          Dec
10         Mar.
17        April
14    September
0         April
Name: month, dtype: object

Random Sample After:
5         Jan
12    October
24        May
2         Feb
28        May
Name: month, dtype: object

Count of cleaned: 34
Converting long months to short
Random Sample Before:
11       Jan
13    August
20       Sep
6       July
17     April
Name: month, dtype: object

Random Sample After:
27    Oct
30    Jul
6     Jul
14    Sep
33    Sep
Name: month, dtype: object

Count of cleaned: 34
Converting short months to digits
Random Sample Before:
24    May
31    Jun
5     Jan
7     Dec
32    Jan
Name: month, dtype: object

Random Sample After:
15    07
12    10
1     05
30    07
21    08
Name: month, dtype: object

Count of cleaned: 34
</pre>
<p>Now we'll clean up the punctuation for the days.</p>
<pre class="code ipython"><a name="rest_code_403a8eaa61c148c3b75b879c020e4983-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_punctuation</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Cleaning Punctuation
Random Sample Before:
22    11,
13     12
29     14
16    11,
24    14,
Name: day, dtype: object

Random Sample After:
2     18
1     30
24    14
15    25
17    17
Name: day, dtype: object

Count of cleaned: 34
</pre>
<p>So, what do we have so far?</p>
<pre class="code ipython"><a name="rest_code_fb060e1e44ad4b8aaa75fed980e99703-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  month day  year
0    04  11  1990
1    05  30  2001
2    02  18  1994
3    02  18  1981
4    10  11  2013
</pre>
<p>At this point we need to combine everything with a slash and restore the index.</p>
<pre class="code ipython"><a name="rest_code_fa253b729078464694a8162277a81f8f-1"></a><span class="n">words_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span>
</pre>
<pre class="literal-block">
     match
194  0        04/11/1990
217  0        06/13/2011
209  0        07/25/1983
216  0        11/11/1988
223  0        10/14/1974
dtype: object
</pre>
<p>Now we'll add it to the total.</p>
<pre class="code ipython"><a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">words_cleaned</span><span class="p">])</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">words_count</span>
<a name="rest_code_b319c93adfcf4699a4bbd51ebfd40376-4"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
375
</pre>
</div>
<div class="section" id="twentieth-century">
<h3>6.9 Twentieth Century</h3>
<p>We'll do the same trick with creating a dataframe. The first thing, though, is to replace the dashes with slashes.</p>
<pre class="code ipython"><a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-1"></a><span class="k">print</span><span class="p">(</span><span class="n">twentieth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
<a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-2"></a><span class="n">twentieth_cleaned</span> <span class="o">=</span> <span class="n">twentieth</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">DASH</span><span class="p">,</span> <span class="n">SLASH</span><span class="p">)</span>
<a name="rest_code_baf1d171c3ec4f6eb96dec932a8b99da-3"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
</pre>
<pre class="literal-block">
4-13-82
01/01/1991
</pre>
<p>Now, we'll create the frame.</p>
<pre class="code ipython"><a name="rest_code_4be7ee2936874cd4b245d919e12856ce-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">twentieth_cleaned</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_4be7ee2936874cd4b245d919e12856ce-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">,</span> <span class="s2">"year"</span><span class="p">])</span>
<a name="rest_code_4be7ee2936874cd4b245d919e12856ce-3"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
  month day year
0    03  25   93
1     6  18   85
2     7   8   71
3     9  27   75
4     2   6   96
</pre>
<div class="section" id="months">
<h4>6.9.1 Months</h4>
<p>The months need to be converted to two-digits.</p>
<pre class="code ipython"><a name="rest_code_4dc97efa0ae94a2d8a2474ed70e57c53-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
73     4
53    10
84     8
93     6
80    10
Name: month, dtype: object

Random Sample After:
76    03
33    07
32    01
94    07
67    05
Name: month, dtype: object

Count of cleaned: 100
</pre>
<p>As do the days.</p>
<pre class="code ipython"><a name="rest_code_5389733c16244c0b97ca473d67c73a35-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
78    14
29    15
37    15
75    18
80    05
Name: day, dtype: object

Random Sample After:
35    14
30    14
17    21
88    16
0     25
Name: day, dtype: object

Count of cleaned: 100
</pre>
<pre class="code ipython"><a name="rest_code_a3e1f85c163e4d8da80c2fb1af92bb61-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre>
<pre class="literal-block">
  month day year
0    03  25   93
1    06  18   85
2    07  08   71
3    09  27   75
4    02  06   96
</pre>
<p>Now we have to add <tt class="docutils literal">19</tt> to each of the years.</p>
<pre class="code ipython"><a name="rest_code_4ac655e89dc64840aa093c1acfbc915c-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">clean</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">TWO_DIGITS</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="s2">"19"</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</pre>
<pre class="literal-block">
Random Sample Before:
41    75
90    97
97    90
69    97
65    81
Name: year, dtype: object

Random Sample After:
4     1996
44    1971
11    1975
17    1998
61    1979
Name: year, dtype: object

Count of cleaned: 100
</pre>
<p>Now we have to join them back up.</p>
<pre class="code ipython"><a name="rest_code_8baf04995baa452ba852a7b93dc2fb0a-1"></a><span class="n">twentieth_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">twentieth</span><span class="p">)</span>
</pre>
<pre class="literal-block">
    match
67  0        07/06/1991
88  0        12/08/1982
4   0        02/06/1996
40  0        07/29/1975
72  0        07/11/1977
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_1d503b332f6e4822a51f526d131a35c7-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_1d503b332f6e4822a51f526d131a35c7-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">twentieth_cleaned</span><span class="p">])</span>
</pre>
<pre class="code ipython"><a name="rest_code_59162f44789846f0a3a07c733a932da6-1"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">twentieth_count</span>
</pre>
</div>
</div>
<div class="section" id="numeric">
<h3>6.10 Numeric</h3>
<p>The final category is dates with the format <tt class="docutils literal">mm/dd/yyyy</tt>.</p>
<pre class="code ipython"><a name="rest_code_2f9ce5575b0f482bb132ce984d804e2b-1"></a><span class="k">print</span><span class="p">(</span><span class="n">numeric</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
14  0         5/24/1990
15  0         1/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
Name: numeric, dtype: object
</pre>
<p>We should check and make sure there are no dashes here.</p>
<pre class="code ipython"><a name="rest_code_cc4af49c73084dd0a3aca73e6fb07ed7-1"></a><span class="n">has_dashes</span> <span class="o">=</span> <span class="n">numeric</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">DASH</span><span class="p">)</span>
<a name="rest_code_cc4af49c73084dd0a3aca73e6fb07ed7-2"></a><span class="k">print</span><span class="p">(</span><span class="n">numeric</span><span class="p">[</span><span class="n">has_dashes</span><span class="p">])</span>
</pre>
<pre class="literal-block">
Series([], Name: numeric, dtype: object)
</pre>
<p>It looks like it doesn't so we'll skip this check.</p>
<pre class="code ipython"><a name="rest_code_c49525c65d3c47f086c390e1a05429ea-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">numeric</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">SLASH</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
<a name="rest_code_c49525c65d3c47f086c390e1a05429ea-2"></a>                         <span class="n">columns</span><span class="o">=</span><span class="s2">"month day year"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<a name="rest_code_c49525c65d3c47f086c390e1a05429ea-3"></a><span class="k">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
  month day  year
0     5  24  1990
1     1  25  2011
2    10  13  1976
3    07  25  1984
4    03  31  1985
</pre>
<pre class="code ipython"><a name="rest_code_a007c13ce32a4311ae0b9a94b7f6e539-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
5      5
18    04
4     03
0      5
10    12
Name: month, dtype: object

Random Sample After:
0     05
24    04
3     07
11    08
13    11
Name: month, dtype: object

Count of cleaned: 25
</pre>
<pre class="code ipython"><a name="rest_code_71afd6cc3e404c2fba4a7edccec5e061-1"></a><span class="n">frame</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">clean_two_digits_isolated</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Random Sample Before:
9     11
19    08
8     15
13     3
24    27
Name: day, dtype: object

Random Sample After:
23    20
22    11
7     13
18    08
0     24
Name: day, dtype: object

Count of cleaned: 25
</pre>
<pre class="code ipython"><a name="rest_code_c6874e85b6eb4167992d86cda4fd4879-1"></a><span class="n">numeric_cleaned</span> <span class="o">=</span> <span class="n">frame_to_series</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">numeric</span><span class="p">)</span>
</pre>
<pre class="literal-block">
    match
94  0        12/08/1990
92  0        04/08/2004
43  0        04/13/2002
38  0        07/27/1986
14  0        05/24/1990
dtype: object
</pre>
<pre class="code ipython"><a name="rest_code_3389eacbbc4045a8b83c74e93f999331-1"></a><span class="n">original</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-2"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">numeric_cleaned</span><span class="p">])</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-3"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="n">original</span> <span class="o">+</span> <span class="n">numeric_count</span>
<a name="rest_code_3389eacbbc4045a8b83c74e93f999331-4"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
</pre>
<pre class="literal-block">
500
</pre>
<p>At this point it looks like we've cleaned all the cases.</p>
</div>
<div class="section" id="re-combining-the-cleaned">
<h3>6.11 Re-combining The Cleaned</h3>
<p>Because these notebooks can execute things out of order I'm going to create one monolithic concatenation and ignore the one that I was using to keep the running total.</p>
<pre class="code ipython"><a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-1"></a><span class="n">cleaned</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-2"></a>                         <span class="n">twentieth_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-3"></a>                         <span class="n">words_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-4"></a>                         <span class="n">backwards_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-5"></a>                         <span class="n">no_day_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-6"></a>                         <span class="n">no_day_numeric_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-7"></a>                         <span class="n">year_only_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-8"></a>                         <span class="n">leftovers_cleaned</span><span class="p">,</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-9"></a><span class="p">])</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-10"></a><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">))</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-11"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<a name="rest_code_ca60a73c85e1438c903b982cd4d34ae2-12"></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre>
<pre class="literal-block">
500
    match
14  0        05/24/1990
15  0        01/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
dtype: object
</pre>
</div>
</div>
<div class="section" id="convert-to-datetimes">
<h2>7 Convert to Datetimes</h2>
<pre class="code ipython"><a name="rest_code_957b32bad7d440c5b5dd381de14cd546-1"></a><span class="k">print</span><span class="p">(</span><span class="n">cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<a name="rest_code_957b32bad7d440c5b5dd381de14cd546-2"></a><span class="n">datetimes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">cleaned</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/</span><span class="si">%d</span><span class="s2">/%Y"</span><span class="p">)</span>
<a name="rest_code_957b32bad7d440c5b5dd381de14cd546-3"></a><span class="k">print</span><span class="p">(</span><span class="n">datetimes</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
14  0        05/24/1990
15  0        01/25/2011
17  0        10/13/1976
24  0        07/25/1984
30  0        03/31/1985
dtype: object
    match
14  0       1990-05-24
15  0       2011-01-25
17  0       1976-10-13
24  0       1984-07-25
30  0       1985-03-31
dtype: datetime64[ns]
</pre>
<pre class="code ipython"><a name="rest_code_647ff9a60a1a4f69bb41e1bf0924139b-1"></a><span class="n">sorted_dates</span> <span class="o">=</span> <span class="n">datetimes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<a name="rest_code_647ff9a60a1a4f69bb41e1bf0924139b-2"></a><span class="k">print</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
    match
9   0       1971-04-10
84  0       1971-05-18
2   0       1971-07-08
53  0       1971-07-11
28  0       1971-09-12
dtype: datetime64[ns]
</pre>
<pre class="code ipython"><a name="rest_code_3176215c31b3415397607142ecb2f364-1"></a><span class="k">print</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre>
<pre class="literal-block">
     match
231  0       2016-05-01
141  0       2016-05-30
186  0       2016-10-13
161  0       2016-10-19
413  0       2016-11-01
dtype: datetime64[ns]
</pre>
<p>The grader wants a Series with the indices of the original data put in the order of the sorted dates.</p>
<pre class="code ipython"><a name="rest_code_8b1ec468304743d9af86de787065a82d-1"></a><span class="n">answer</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">sorted_dates</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a name="rest_code_8b1ec468304743d9af86de787065a82d-2"></a><span class="k">print</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
<pre class="literal-block">
0     9
1    84
2     2
3    53
4    28
dtype: int16
</pre>
</div>
<div class="section" id="the-date-sorter-function">
<h2>8 The date_sorter Function</h2>
<p>This is the function called by the grader. Since the work was done outside of it we just need to make sure that it returns our answer.</p>
<pre class="code ipython"><a name="rest_code_9d14237f12654a98b9d9dd249ad4bb2f-1"></a><span class="k">def</span> <span class="nf">date_sorter</span><span class="p">():</span>
<a name="rest_code_9d14237f12654a98b9d9dd249ad4bb2f-2"></a>    <span class="k">return</span> <span class="n">answer</span>
</pre>
<p><strong>note:</strong> This produced a 94% score, so there are still some cases not correctly handled.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/evaluating-a-model/" class="u-url">Evaluating a Model</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/hades/">hades</a>
            </span></p>
            <p class="dateline"><a href="posts/evaluating-a-model/" rel="bookmark"><time class="published dt-published" datetime="2017-06-12T15:05:00-07:00" title="2017-06-12 15:05">2017-06-12 15:05</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In this assignment you will train several models and evaluate how effectively they predict instances of credit-card fraud using data based on <a class="reference external" href="https://www.kaggle.com/dalpozz/creditcardfraud">this dataset from Kaggle</a>. This is their description:</p>
<pre class="literal-block">
The datasets contains transactions made by credit cards in September 2013 by european cardholders. This dataset presents transactions that occurred in two days, where we have 492 frauds out of 284,807 transactions. The dataset is highly unbalanced, the positive class (frauds) account for 0.172% of all transactions.

It contains only numerical input variables which are the result of a PCA transformation. Unfortunately, due to confidentiality issues, we cannot provide the original features and more background information about the data. Features V1, V2, ... V28 are the principal components obtained with PCA, the only features which have not been transformed with PCA are 'Time' and 'Amount'. Feature 'Time' contains the seconds elapsed between each transaction and the first transaction in the dataset. The feature 'Amount' is the transaction Amount, this feature can be used for example-dependant cost-senstive learning. Feature 'Class' is the response variable and it takes value 1 in case of fraud and 0 otherwise.

Given the class imbalance ratio, we recommend measuring the accuracy using the Area Under the Precision-Recall Curve (AUPRC). Confusion matrix accuracy is not meaningful for unbalanced classification.

The dataset has been collected and analysed during a research collaboration of Worldline and the Machine Learning Group (`http://mlg.ulb.ac.be &lt;http://mlg.ulb.ac.be&gt;`_) of ULB (Universit Libre de Bruxelles) on big data mining and fraud detection. More details on current and past projects on related topics are available on `http://mlg.ulb.ac.be/BruFence &lt;http://mlg.ulb.ac.be/BruFence&gt;`_ and `http://mlg.ulb.ac.be/ARTML &lt;http://mlg.ulb.ac.be/ARTML&gt;`_

Please cite: Andrea Dal Pozzolo, Olivier Caelen, Reid A. Johnson and Gianluca Bontempi. Calibrating Probability with Undersampling for Unbalanced Classification. In Symposium on Computational Intelligence and Data Mining (CIDM), IEEE, 2015
</pre>
<p>Each row in `fraud_data.csv` corresponds to a credit card transaction. Features include confidential variables `V1` through `V28` as well as `Amount` which is the amount of the transaction.</p>
<p>The target is stored in the `class` column, where a value of 1 corresponds to an instance of fraud and 0 corresponds to an instance of not fraud.</p>
<div class="section" id="imports">
<h2>1 Imports</h2>
<pre class="code ipython"><a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-1"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-3"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-4"></a><span class="kn">import</span> <span class="nn">seaborn</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-5"></a>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-6"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-7"></a>    <span class="n">GridSearchCV</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-8"></a>    <span class="n">train_test_split</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-9"></a>    <span class="p">)</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-10"></a><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-11"></a><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-12"></a><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-13"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-14"></a>    <span class="n">auc</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-15"></a>    <span class="n">confusion_matrix</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-16"></a>    <span class="n">precision_recall_curve</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-17"></a>    <span class="n">precision_score</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-18"></a>    <span class="n">recall_score</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-19"></a>    <span class="n">roc_curve</span><span class="p">,</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-20"></a>    <span class="p">)</span>
<a name="rest_code_33a6dc68ea1c40de94a26f087a84f818-21"></a><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</pre>
<pre class="code ipython"><a name="rest_code_11343ec315ef4c099147e3058c9447ff-1"></a><span class="n">DATA</span> <span class="o">=</span> <span class="s2">"data/fraud_data.csv"</span>
</pre>
</div>
<div class="section" id="setup-the-plotting">
<h2>2 Setup the plotting</h2>
<pre class="code ipython"><a name="rest_code_51ccf9e28f924764ad6d1b3b2c5b74d9-1"></a><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">magic</span><span class="p">(</span><span class="s1">'matplotlib inline'</span><span class="p">)</span>
<a name="rest_code_51ccf9e28f924764ad6d1b3b2c5b74d9-2"></a><span class="n">style</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<a name="rest_code_51ccf9e28f924764ad6d1b3b2c5b74d9-3"></a><span class="n">style</span><span class="p">[</span><span class="s2">"axes.grid"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_51ccf9e28f924764ad6d1b3b2c5b74d9-4"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="exploring-the-data">
<h2>3 Exploring the data</h2>
<div class="section" id="how-much-fraud-is-there">
<h3>3.1 How much fraud is there?</h3>
<p>Import the data from `fraud_data.csv`. What percentage of the observations in the dataset are instances of fraud?</p>
<pre class="code ipython"><a name="rest_code_66c086227b2146609c54bca3f53a0367-1"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_93cbbd89449543098c4f4ec80978df09-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Fraction of cases that were fraud: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">Class</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
</pre>
<pre class="literal-block">
Fraction of cases that were fraud: 0.02
</pre>
<pre class="code ipython"><a name="rest_code_5387b9775178499d8b5a99af73545746-1"></a><span class="n">seaborn</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Class"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre>
<img alt="fraud.png" src="posts/evaluating-a-model/fraud.png"><p>So it appears that most of the cases aren't fraudulent.</p>
</div>
</div>
<div class="section" id="setting-up-the-training-and-testing-sets">
<h2>4 Setting up the training and testing sets</h2>
<p>As always, we split the data into training and testing sets so there's no `data leakage`.</p>
<pre class="code ipython"><a name="rest_code_46176deba6e64557a35827fa57d58f70-1"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
<a name="rest_code_46176deba6e64557a35827fa57d58f70-2"></a>
<a name="rest_code_46176deba6e64557a35827fa57d58f70-3"></a><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_46176deba6e64557a35827fa57d58f70-4"></a><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_46176deba6e64557a35827fa57d58f70-5"></a>
<a name="rest_code_46176deba6e64557a35827fa57d58f70-6"></a><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="scores">
<h2>5 Scores</h2>
<p>This is a convenience class to store the scores for the models.</p>
<pre class="code ipython"><a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-1"></a><span class="k">class</span> <span class="nc">ScoreKeeper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-2"></a>    <span class="sd">"""only holds scores, doesn't create them"""</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="s2">"N/A"</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="s2">"N/A"</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">=</span> <span class="s2">"N/A"</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-7"></a>        <span class="k">return</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-8"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-9"></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-10"></a>        <span class="sd">"""calculates the difference between the three scores</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-11"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-12"></a><span class="sd">        Args:</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-13"></a><span class="sd">         other (Scores): the right-hand side of the subtraction</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-14"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-15"></a><span class="sd">        Returns:</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-16"></a><span class="sd">         ScoreKeeper: object with the differences</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-17"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-18"></a><span class="sd">        Raises:</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-19"></a><span class="sd">         TypeError: one of the values wasn't set on one of the Scores</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-20"></a><span class="sd">        """</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-21"></a>        <span class="n">scores</span> <span class="o">=</span> <span class="n">ScoreKeeper</span><span class="p">()</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-22"></a>        <span class="n">scores</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">accuracy</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-23"></a>        <span class="n">scores</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">precision</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-24"></a>        <span class="n">scores</span><span class="o">.</span><span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">recall</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-25"></a>        <span class="k">return</span> <span class="n">scores</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-26"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-27"></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-28"></a>        <span class="sd">"""compares scores</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-29"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-30"></a><span class="sd">        Args:</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-31"></a><span class="sd">         other (Scores): object to compare to</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-32"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-33"></a><span class="sd">        Returns:</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-34"></a><span class="sd">         bool: True if all three scores are greater than other's</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-35"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-36"></a><span class="sd">        Raises:</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-37"></a><span class="sd">         TypeError: one of the values wasn't set</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-38"></a><span class="sd">        """</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-39"></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-40"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-41"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">recall</span><span class="p">))</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-42"></a>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-43"></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-44"></a>        <span class="k">return</span> <span class="s2">"Precision: {0:.2f}, Accuracy: {1:.2f}, Recall: {2:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-45"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span>
<a name="rest_code_5eb0ab0268ab47979cf9db21ee0005d4-47"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-1"></a><span class="k">class</span> <span class="nc">Scores</span><span class="p">(</span><span class="n">ScoreKeeper</span><span class="p">):</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-2"></a>    <span class="sd">"""holds scores"""</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-4"></a>        <span class="sd">"""fits and scores the model</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-5"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-6"></a><span class="sd">        Args:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-7"></a><span class="sd">         model: model that has been fit to the data</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-8"></a><span class="sd">         x_test: input for accuracy measurement</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-9"></a><span class="sd">         y_test: labels for scoring the model</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-10"></a><span class="sd">        """</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">x_test</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_scores</span> <span class="o">=</span> <span class="bp">None</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-19"></a>        <span class="k">return</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-20"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-21"></a>    <span class="nd">@property</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-22"></a>    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-23"></a>        <span class="sd">"""the model's predictions</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-24"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-25"></a><span class="sd">        Returns:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-26"></a><span class="sd">         array: predictions for x-test</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-27"></a><span class="sd">        """</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-28"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-30"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-31"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-32"></a>    <span class="nd">@property</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-33"></a>    <span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-34"></a>        <span class="sd">"""the accuracy of the model's predictions</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-35"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-36"></a><span class="sd">        the fraction that was correctly predicted</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-37"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-38"></a><span class="sd">        (tp + tn)/(tp + tn + fp + fn)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-39"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-40"></a><span class="sd">        Returns:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-41"></a><span class="sd">         float: accuracy of predictions for x-test</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-42"></a><span class="sd">        """</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-43"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-44"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-45"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accuracy</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-46"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-47"></a>    <span class="nd">@property</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-48"></a>    <span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-49"></a>        <span class="sd">"""the recall score for the predictions</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-50"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-51"></a><span class="sd">        The fraction of true-positives penalized for missing any</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-52"></a><span class="sd">        This is the better metric when missing a case is more costly</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-53"></a><span class="sd">        than accidentally identifying a case.</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-54"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-55"></a><span class="sd">        tp / (tp + fn)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-56"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-57"></a><span class="sd">        Returns:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-58"></a><span class="sd">         float: recall of the predictions</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-59"></a><span class="sd">        """</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-60"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-62"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recall</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-63"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-64"></a>    <span class="nd">@property</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-65"></a>    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-66"></a>        <span class="sd">"""the precision of the test predictions</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-67"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-68"></a><span class="sd">        The fraction of true-positives penalized for false-positives</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-69"></a><span class="sd">        This is the better metric when accidentally identifying a case</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-70"></a><span class="sd">        is more costly than missing a case</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-71"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-72"></a><span class="sd">        tp / (tp + fp)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-73"></a>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-74"></a><span class="sd">        Returns:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-75"></a><span class="sd">         float: precision score</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-76"></a><span class="sd">        """</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-77"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
<a name="rest_code_d2cceb43ce264bc3be56c9edec21a0a3-79"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision</span>
</pre>
</div>
<div class="section" id="a-dummy-classifier-baseline">
<h2>6 A Dummy Classifier (baseline)</h2>
<p>Using `X_train`, `X_test`, `y_train`, and `y_test` (as defined above), we're going to train a <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html">dummy classifier</a> that classifies everything as the majority class of the training data, so we will have a baseline to compare with the other models.</p>
<p>First we create and train it</p>
<pre class="code ipython"><a name="rest_code_23a15096a5574f0790da4f23ad4809a3-1"></a><span class="n">strategy</span> <span class="o">=</span> <span class="s2">"most_frequent"</span>
<a name="rest_code_23a15096a5574f0790da4f23ad4809a3-2"></a><span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">)</span>
<a name="rest_code_23a15096a5574f0790da4f23ad4809a3-3"></a><span class="n">dummy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_23a15096a5574f0790da4f23ad4809a3-4"></a><span class="n">dummy_scores</span> <span class="o">=</span> <span class="n">Scores</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<p>Now we make our predctions and score them</p>
<pre class="code ipython"><a name="rest_code_18779f562b6c40edb2e1da74acfb9a51-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Dummy Classifier: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dummy_scores</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Dummy Classifier: Precision: 0.00, Accuracy: 0.99, Recall: 0.00
</pre>
<p>Since the model is always predicting that the data-points are not fraudulent (the majority case), it never returns any true positives and since both precision and recall have true positive as their numerators, they are both 0.</p>
<p>For the accuracy we can look at the count of each class:</p>
<pre class="code ipython"><a name="rest_code_1fb98b647c95444fa54615d2b7c5b741-1"></a><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre>
<pre class="literal-block">
0    5344
1      80
Name: Class, dtype: int64
</pre>
<p>And since we know it will always predict 0, we can double-check it (the true and false positives are both 0).</p>
<pre class="code ipython"><a name="rest_code_3223cfd9d72e46e088fad526a1d24733-1"></a><span class="n">true_positive</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-2"></a><span class="n">true_negative</span> <span class="o">=</span> <span class="mi">5344</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-3"></a><span class="n">false_positive</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-4"></a><span class="n">false_negative</span> <span class="o">=</span> <span class="mi">80</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-5"></a><span class="n">accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">true_positive</span> <span class="o">+</span> <span class="n">true_negative</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">true_positive</span> <span class="o">+</span> <span class="n">true_negative</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-6"></a>                                            <span class="o">+</span> <span class="n">false_positive</span> <span class="o">+</span> <span class="n">false_negative</span><span class="p">)</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-7"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Accuracy: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
<a name="rest_code_3223cfd9d72e46e088fad526a1d24733-8"></a><span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">dummy_scores</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Accuracy: 0.99
</pre>
</div>
<div class="section" id="svc-accuracy-recall-and-precision">
<h2>7 SVC Accuracy, Recall and Precision</h2>
<p>Now we're going to create a <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html">Support Vector Classifier</a> that uses the sklearn default valuse.</p>
<pre class="code ipython"><a name="rest_code_8365d687bce84bebb40539dca0694703-1"></a><span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>
<a name="rest_code_8365d687bce84bebb40539dca0694703-2"></a><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_8365d687bce84bebb40539dca0694703-3"></a><span class="n">svc_scores</span> <span class="o">=</span> <span class="n">Scores</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<pre class="code ipython"><a name="rest_code_03806c3d512646158449e5a944573edc-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores</span><span class="p">))</span>
</pre>
<pre class="literal-block">
SVC: Precision: 1.00, Accuracy: 0.99, Recall: 0.38
</pre>
<p>We can now compare it to the Dummy Classifier to see how it did against the baseline.</p>
<pre class="code ipython"><a name="rest_code_b47e26f4bd894c08a9221a05f9501050-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC - Dummy: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores</span> <span class="o">-</span> <span class="n">dummy_scores</span><span class="p">))</span>
<a name="rest_code_b47e26f4bd894c08a9221a05f9501050-2"></a><span class="k">assert</span> <span class="n">svc_scores</span> <span class="o">&gt;</span> <span class="n">dummy_scores</span>
</pre>
<pre class="literal-block">
SVC - Dummy: Precision: 1.00, Accuracy: 0.01, Recall: 0.38
</pre>
<p>The SVC was much better on precision and recall (as expected) and slightly better on accuracy.</p>
</div>
<div class="section" id="confusion-matrix">
<h2>8 Confusion Matrix</h2>
<p>We're going to create a Support Vector Classifier with ``C=1e9`` and ``gamma=1e-07`` (the ``e`` is the equivalent of ``**``). Then, using the <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html#sklearn.svm.SVC.decision_function">decision function</a> and a threshold of -220, we're going to make our predictions and create a confusion matrix. The decision-function calculates the distance of each data point from the label, so the further a value is from 0, the further it is from the separating hyper-plane.</p>
<pre class="code ipython"><a name="rest_code_c1cf797ebdf243b6a0fb3d74e5b1d1f8-1"></a><span class="n">error_penalty</span> <span class="o">=</span> <span class="mf">1e9</span>
<a name="rest_code_c1cf797ebdf243b6a0fb3d74e5b1d1f8-2"></a><span class="n">kernel_coefficient</span> <span class="o">=</span> <span class="mf">1e-07</span>
<a name="rest_code_c1cf797ebdf243b6a0fb3d74e5b1d1f8-3"></a><span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">220</span>
</pre>
<pre class="code ipython"><a name="rest_code_534ab819ac924f4997c51e537ec6eeb3-1"></a><span class="n">svc_2</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">error_penalty</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">kernel_coefficient</span><span class="p">)</span>
<a name="rest_code_534ab819ac924f4997c51e537ec6eeb3-2"></a><span class="n">svc_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_534ab819ac924f4997c51e537ec6eeb3-3"></a><span class="n">svc_scores_2</span> <span class="o">=</span> <span class="n">Scores</span><span class="p">(</span><span class="n">svc_2</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<p>The decision_function gives us the distances which we then need to convert to labels. In this case we're going to label anything greater than -220 as a 1 and anything less as a 0.</p>
<pre class="code ipython"><a name="rest_code_bc32f3472b354e7daa3852f734f3e143-1"></a><span class="n">decisions</span> <span class="o">=</span> <span class="n">svc_2</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a name="rest_code_bc32f3472b354e7daa3852f734f3e143-2"></a><span class="n">decisions</span><span class="p">[</span><span class="n">decisions</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_bc32f3472b354e7daa3852f734f3e143-3"></a><span class="n">decisions</span><span class="p">[</span><span class="n">decisions</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a name="rest_code_bc32f3472b354e7daa3852f734f3e143-4"></a><span class="n">matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">decisions</span><span class="p">)</span>
<a name="rest_code_bc32f3472b354e7daa3852f734f3e143-5"></a><span class="n">matrix</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"Actual Positive"</span><span class="p">,</span> <span class="s2">"Actual Negative"</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Predicted Positive"</span><span class="p">,</span> <span class="s2">"Predicted Negative"</span><span class="p">])</span>
<a name="rest_code_bc32f3472b354e7daa3852f734f3e143-6"></a><span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
<a name="rest_code_bc32f3472b354e7daa3852f734f3e143-7"></a>               <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">))</span>
</pre>
<table border="1" class="docutils">
<colgroup>
<col width="30%">
<col width="35%">
<col width="35%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head"></th>
<th class="head">Predicted Positive</th>
<th class="head">Predicted Negative</th>
</tr></thead>
<tbody valign="top">
<tr>
<td>Actual Positive</td>
<td>5320</td>
<td>24</td>
</tr>
<tr>
<td>Actual Negative</td>
<td>14</td>
<td>66</td>
</tr>
</tbody>
</table>
<pre class="code ipython"><a name="rest_code_747061c42a4a485ca934562f1e62dc9b-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC 2: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores_2</span><span class="p">))</span>
<a name="rest_code_747061c42a4a485ca934562f1e62dc9b-2"></a><span class="k">assert</span> <span class="n">svc_scores_2</span> <span class="o">&gt;</span> <span class="n">dummy_scores</span>
</pre>
<pre class="literal-block">
SVC 2: Precision: 0.94, Accuracy: 1.00, Recall: 0.80
</pre>
<pre class="code ipython"><a name="rest_code_b0b828f11b834f818ce0d2badaa939ed-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"SVC 2 - SVC Default: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">svc_scores_2</span> <span class="o">-</span> <span class="n">svc_scores</span><span class="p">))</span>
</pre>
<pre class="literal-block">
SVC 2 - SVC Default: Precision: -0.06, Accuracy: 0.01, Recall: 0.43
</pre>
<p>This model did slightly worse with precision that the default, slightly better for accuracy but quite a bit better for recall. So if we didn't care as much about false positives it would be the better model.</p>
</div>
<div class="section" id="logistic-regression">
<h2>9 Logistic Regression</h2>
<p>This model will be a Logistic Regression model built with the default parameters.</p>
<p>For the logisitic regression classifier, we'll create a precision recall curve and a roc curve using y_test and the probability estimates for X_test (probability it is fraud).</p>
<p>Looking at the precision recall curve, what is the recall when the precision is `0.75`?
Looking at the roc curve, what is the true positive rate when the false positive rate is `0.16`?</p>
<pre class="code ipython"><a name="rest_code_6b77cd69885d4a75981932a1fed10d73-1"></a><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-2"></a><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-3"></a><span class="n">y_scores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-4"></a><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-5"></a><span class="n">closest_zero</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-6"></a><span class="n">closest_zero_precision</span> <span class="o">=</span> <span class="n">precision</span><span class="p">[</span><span class="n">closest_zero</span><span class="p">]</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-7"></a><span class="n">closest_zero_recall</span> <span class="o">=</span> <span class="n">recall</span><span class="p">[</span><span class="n">closest_zero</span><span class="p">]</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-8"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">precision</span><span class="o">==</span><span class="mf">0.75</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-9"></a><span class="n">recall_at_precision</span> <span class="o">=</span> <span class="n">recall</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-10"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-11"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-12"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Precision-Recall Curve"</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-13"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">closest_zero_precision</span><span class="p">,</span> <span class="n">closest_zero_recall</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-14"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Precision"</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-15"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Recall"</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-16"></a><span class="n">axe</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">recall_at_precision</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"r"</span><span class="p">)</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-17"></a><span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a name="rest_code_6b77cd69885d4a75981932a1fed10d73-18"></a><span class="n">title</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Precision vs Recall"</span><span class="p">)</span>
</pre>
<img alt="logistic_regression_precision_recall.png" src="posts/evaluating-a-model/logistic_regression_precision_recall.png"><pre class="code ipython"><a name="rest_code_8e226e3341394c54a6ba1583f79d5557-1"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">precision</span><span class="o">==</span><span class="mf">0.75</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_8e226e3341394c54a6ba1583f79d5557-2"></a><span class="n">recall_at_precision</span> <span class="o">=</span> <span class="n">recall</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a name="rest_code_8e226e3341394c54a6ba1583f79d5557-3"></a><span class="k">print</span><span class="p">(</span><span class="s2">"Recall at precision 0.75: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall_at_precision</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Recall at precision 0.75: 0.825
</pre>
<p>When the precision is 0.75, the recall is 0.825.</p>
<pre class="code ipython"><a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-1"></a><span class="n">y_score_lr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-2"></a><span class="n">false_positive_rate</span><span class="p">,</span> <span class="n">true_positive_rate</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_score_lr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-3"></a><span class="n">area_under_the_curve</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="n">true_positive_rate</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-4"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mf">0.16</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-5"></a><span class="n">figure</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-6"></a><span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-7"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="n">true_positive_rate</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"ROC Curve (area={0:.2f})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area_under_the_curve</span><span class="p">))</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-8"></a><span class="n">axe</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">true_positive_rate</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-9"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"False Positive Rate"</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-10"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"True Positive Rate"</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-11"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"ROC Curve"</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-12"></a><span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'navy'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-13"></a><span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a name="rest_code_f3bcb03d0ed44b58bd0638ffb635a7d8-14"></a><span class="n">axe</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>
</pre>
<img alt="lr_roc.png" src="posts/evaluating-a-model/lr_roc.png"><pre class="code ipython"><a name="rest_code_e7bb74b3a4644a4ea2492f46ed6f65bc-1"></a><span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">false_positive_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mf">0.16</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_e7bb74b3a4644a4ea2492f46ed6f65bc-2"></a><span class="k">print</span><span class="p">(</span><span class="s2">"True positive rate where false positive rate is 0.16: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">true_positive_rate</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</pre>
<pre class="literal-block">
True positive rate where false positive rate is 0.16: 0.9375
</pre>
<dl class="docutils">
<dt>def true_positive_where_false(model, threshold):</dt>
<dd>"""get the true-positive value matching the threshold for false-positive</dd>
<dt>Args:</dt>
<dd>model: the model fit to the data with predict_proba method</dd>
<dt>Return:</dt>
<dd>float: True Positive rate</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 466)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>"""
y_score_lr = model.predict_proba(X_test)
false_positive_rate, true_positive_rate, _ = roc_curve(y_test, y_score_lr[:, 1])
index = numpy.where(numpy.round(false_positive_rate, 2)==0.16)[0][0]
return true_positive_rate[index]</p>
<dl class="docutils">
<dt>def recall_where_precision(model, threshold):</dt>
<dd>"""return recall where the first precision matches threshold</dd>
<dt>Args:</dt>
<dd>model: model fit to the data with decision_function
threshold (float): point to find matching recall</dd>
<dt>Returns:</dt>
<dd>float: recall matching precision threshold</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 482)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>"""
y_scores = model.decision_function(X_test)
precision, recall, thresholds = precision_recall_curve(y_test, y_scores)
return recall[numpy.where(precision==threshold)[0][0]]</p>
<dl class="docutils">
<dt>def answer_five():</dt>
<dd>model = LogisticRegression()
model.fit(X_train, y_train)
recall_score = recall_where_precision(model, 0.75)
true_positive = true_positive_where_false(model, threshold=0.16)
return (recall_score, true_positive)</dd>
</dl>
<p>answer_five()</p>
<p>parameters = dict(penalty=["l1", "l2"], C=[10**power for power in range(-2, 3)])
model = LogisticRegression()</p>
<p>grid = GridSearchCV(model, parameters, scoring="recall")
grid.fit(X_train, y_train)</p>
<p>grid.cv_results_</p>
<p>len(grid.cv_results_["mean_test_score"])</p>
<p>grid.cv_results_
l1 = [grid.cv_results_["mean_test_score"][index] for index in range(0, len(grid.cv_results_['mean_test_score']), 2)]
l2 = [grid.cv_results_["mean_test_score"][index] for index in range(1, len(grid.cv_results_["mean_test_score"])+ 1, 2)]
l1</p>
<p>l2</p>
<dl class="docutils">
<dt>def answer_six():</dt>
<dd>parameters = dict(penalty=["l1", "l2"], C=[10**power for power in range(-2, 3)])
model = LogisticRegression()
grid = GridSearchCV(model, parameters, scoring="recall")
grid.fit(X_train, y_train)
l1 = [grid.cv_results_["mean_test_score"][index] for index in range(0, len(grid.cv_results_['mean_test_score']), 2)]
l2 = [grid.cv_results_["mean_test_score"][index] for index in range(1, len(grid.cv_results_["mean_test_score"])+ 1, 2)]
return numpy.array([l1, l2]).T</dd>
</dl>
<p>answer_six()</p>
<dl class="docutils">
<dt>def GridSearch_Heatmap(scores):</dt>
<dd>get_ipython().magic('matplotlib inline')
import seaborn as sns
import matplotlib.pyplot as plt
plt.figure()
scores = answer_six()
sns.heatmap(scores, xticklabels=['l1','l2'], yticklabels=[0.01, 0.1, 1, 10, 100])
plt.yticks(rotation=0);</dd>
<dt>if VERBOSE:</dt>
<dd>GridSearch_Heatmap(answer_six())</dd>
</dl>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/predicting-cancer/" class="u-url">Predicting Cancer (Course 3, Assignment 1)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/predicting-cancer/" rel="bookmark"><time class="published dt-published" datetime="2017-06-03T16:32:14-07:00" title="2017-06-03 16:32">2017-06-03 16:32</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This assignment uses the Breast Cancer Wisconsin (Diagnostic) Database to create a classifier that can help diagnose patients.</p>
<div class="section" id="imports">
<h2>Imports</h2>
<pre class="code python"><a name="rest_code_c7fc14c3af244e20a9e931c26f7c7995-1"></a><span class="kn">import</span> <span class="nn">numpy</span>
<a name="rest_code_c7fc14c3af244e20a9e931c26f7c7995-2"></a><span class="kn">import</span> <span class="nn">pandas</span>
<a name="rest_code_c7fc14c3af244e20a9e931c26f7c7995-3"></a><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span>
</pre>
</div>
<div class="section" id="the-data">
<h2>The data</h2>
<pre class="code python"><a name="rest_code_09e399a144b64db98e1a439b6cdd935b-1"></a><span class="n">cancer</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
</pre>
<p>This data set has 569 rows (cases) with 30 numeric features. The outcomes are either 1 - <em>malignant</em>, or 0 - <em>benign</em>.</p>
<p>From their description:</p>
<pre class="literal-block">
Features are computed from a digitized image of a fine needle aspirate (FNA) of a breast mass.  They describe characteristics of the cell nuclei present in the image.
</pre>
<p>The object returned by <tt class="docutils literal">load_breast_cancer()</tt> is a scikit-learn Bunch object, which is similar to a dictionary, but like pandas, also supports using dot-notation to retrieve attributes when possible (i.e. no spaces in the keys).</p>
<pre class="code python"><a name="rest_code_168a4d0357164c04a2d0edc233e7da3f-1"></a><span class="k">print</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre>
<pre class="literal-block">
dict_keys(['DESCR', 'target', 'feature_names', 'data', 'target_names'])
</pre>
</div>
<div class="section" id="question-0-example">
<h2>Question 0 (Example)</h2>
<p>How many features does the breast cancer dataset have?</p>
<pre class="code python"><a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-1"></a><span class="k">def</span> <span class="nf">answer_zero</span><span class="p">():</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-2"></a>    <span class="sd">"""number of feature names in the data</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-3"></a>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-5"></a><span class="sd">     int: count of feature names in the 'cancer' data-set</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-6"></a><span class="sd">    """</span>
<a name="rest_code_33fc15f77c2245b8b42d16611c721ebf-7"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">cancer</span><span class="p">[</span><span class="s1">'feature_names'</span><span class="p">])</span>
</pre>
<pre class="code python"><a name="rest_code_3a103505aa0e49d397f21a59cf3900fa-1"></a><span class="n">answer_zero</span><span class="p">()</span>
</pre>
<pre class="literal-block">
30
</pre>
</div>
<div class="section" id="question-1">
<h2>Question 1</h2>
<p>Scikit-learn works with lists, numpy arrays, scipy-sparse matrices, and pandas DataFrames, so converting the dataset to a DataFrame is not necessary for training this model. Using a DataFrame does however help make many things easier such as munging data, so let's practice creating a classifier with a pandas DataFrame.</p>
<pre class="code python"><a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-1"></a><span class="k">def</span> <span class="nf">answer_one</span><span class="p">():</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-2"></a>    <span class="sd">"""converts the sklearn 'cancer' bunch</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-3"></a>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-5"></a><span class="sd">     pandas.DataFrame: cancer data</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-6"></a><span class="sd">    """</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-7"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">cancer</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-8"></a>    <span class="n">columns</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">feature_names</span><span class="p">,</span> <span class="p">[</span><span class="s2">"target"</span><span class="p">])</span>
<a name="rest_code_b3d659d1c8f548e9b70b88ddf5abff0f-9"></a>    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_1a98be338b894117849c588e30875b68-1"></a><span class="n">frame</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_1a98be338b894117849c588e30875b68-2"></a><span class="k">assert</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cancer</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="mi">31</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="question-2">
<h2>Question 2</h2>
<p>What is the class distribution? (i.e. how many instances of <tt class="docutils literal">malignant</tt> and how many <tt class="docutils literal">benign</tt>?)</p>
<pre class="code python"><a name="rest_code_42f1476214a8419cac3ecd027425862b-1"></a><span class="k">def</span> <span class="nf">answer_two</span><span class="p">():</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-2"></a>    <span class="sd">"""calculates number of malignent and benign</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-3"></a>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-5"></a><span class="sd">     pandas.Series: counts of each</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-6"></a><span class="sd">    """</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-7"></a>    <span class="n">cancerdf</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-8"></a>    <span class="n">counts</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-9"></a>    <span class="n">counts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s2">"malignant benign"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a name="rest_code_42f1476214a8419cac3ecd027425862b-10"></a>    <span class="k">return</span> <span class="n">counts</span>
</pre>
<pre class="code python"><a name="rest_code_4de616c2524042ebb34c2705c4cf6ba7-1"></a><span class="n">output</span> <span class="o">=</span> <span class="n">answer_two</span><span class="p">()</span>
<a name="rest_code_4de616c2524042ebb34c2705c4cf6ba7-2"></a><span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">malignant</span> <span class="o">==</span> <span class="mi">212</span>
<a name="rest_code_4de616c2524042ebb34c2705c4cf6ba7-3"></a><span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">benign</span> <span class="o">==</span> <span class="mi">357</span>
</pre>
</div>
<div class="section" id="question-3">
<h2>Question 3</h2>
<p>Split the DataFrame into `X` (the data) and `y` (the labels).</p>
<pre class="code python"><a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-1"></a><span class="k">def</span> <span class="nf">answer_three</span><span class="p">():</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-2"></a>    <span class="sd">"""splits the data into data and labels</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-3"></a>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-5"></a><span class="sd">     (pandas.DataFrame, pandas.Series): data, labels</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-6"></a><span class="sd">    """</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-7"></a>    <span class="n">cancerdf</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-8"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="p">[</span><span class="n">cancerdf</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-9"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="o">.</span><span class="n">target</span>
<a name="rest_code_14c6a1690a7e4250b0a80cdd98c28fef-10"></a>    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</pre>
<pre class="code python"><a name="rest_code_9919328ff14647d6aef49f90f0829545-1"></a><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">answer_three</span><span class="p">()</span>
<a name="rest_code_9919328ff14647d6aef49f90f0829545-2"></a><span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">569</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a name="rest_code_9919328ff14647d6aef49f90f0829545-3"></a><span class="k">assert</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">569</span><span class="p">,)</span>
</pre>
</div>
<div class="section" id="question-4">
<h2>Question 4</h2>
<p>Using <tt class="docutils literal">train_test_split()</tt>, split <tt class="docutils literal">X</tt> and <tt class="docutils literal">y</tt> into training and test sets <tt class="docutils literal">(X_train, X_test, y_train, and y_test)</tt>.</p>
<pre class="code python"><a name="rest_code_0c59601156ea4c649b68814e95988aa6-1"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-2"></a>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-3"></a><span class="k">def</span> <span class="nf">answer_four</span><span class="p">():</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-4"></a>    <span class="sd">"""splits data into training and testing sets</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-5"></a>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-7"></a><span class="sd">     tuple(pandas.DataFrame): x_train, y_train, x_test, y_test</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-8"></a><span class="sd">    """</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-9"></a>    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">answer_three</span><span class="p">()</span>
<a name="rest_code_0c59601156ea4c649b68814e95988aa6-10"></a>    <span class="k">return</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mi">426</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mi">143</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-1"></a><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-2"></a><span class="k">assert</span> <span class="n">x_train</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">426</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-3"></a><span class="k">assert</span> <span class="n">x_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">143</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-4"></a><span class="k">assert</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">426</span><span class="p">,)</span>
<a name="rest_code_c9db356cb5b84463b9cff45dcab628d9-5"></a><span class="k">assert</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">143</span><span class="p">,)</span>
</pre>
</div>
<div class="section" id="question-5">
<h2>Question 5</h2>
<p>Using KNeighborsClassifier, fit a k-nearest neighbors (knn) classifier with <tt class="docutils literal">X_train</tt>, <tt class="docutils literal">y_train</tt> and using one nearest neighbor (<tt class="docutils literal">n_neighbors = 1</tt>).</p>
<pre class="code python"><a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-1"></a><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-2"></a>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-3"></a><span class="k">def</span> <span class="nf">answer_five</span><span class="p">():</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-4"></a>    <span class="sd">"""Fits a KNN-1 model to the data</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-5"></a>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-7"></a><span class="sd">     sklearn.neighbors.KNeighborsClassifier: trained data</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-8"></a><span class="sd">    """</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-9"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-10"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-11"></a>    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a name="rest_code_125cb1ade5564bf2b226cbb25b82cc85-12"></a>    <span class="k">return</span> <span class="n">model</span>
</pre>
<pre class="code python"><a name="rest_code_5ce594db5f63485e969f541f23bc2615-1"></a><span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_5ce594db5f63485e969f541f23bc2615-2"></a><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">knn</span><span class="p">)</span> <span class="o">==</span> <span class="n">KNeighborsClassifier</span>
<a name="rest_code_5ce594db5f63485e969f541f23bc2615-3"></a><span class="k">assert</span> <span class="n">knn</span><span class="o">.</span><span class="n">n_neighbors</span> <span class="o">==</span> <span class="mi">1</span>
</pre>
</div>
<div class="section" id="question-6">
<h2>Question 6</h2>
<p>Using your knn classifier, predict the class label using the mean value for each feature.</p>
<p>You can use <tt class="docutils literal"><span class="pre">cancerdf.mean()[:-1].values.reshape(1,</span> <span class="pre">-1)</span></tt> which gets the mean value for each feature, ignores the target column, and reshapes the data from 1 dimension to 2 (necessary for the predict method of KNeighborsClassifier).</p>
<pre class="code python"><a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-1"></a><span class="k">def</span> <span class="nf">answer_six</span><span class="p">():</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-2"></a>    <span class="sd">"""Predicts the class labels for the means of all features</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-3"></a>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-5"></a><span class="sd">     numpy.array: prediction (0 or 1)</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-6"></a><span class="sd">    """</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-7"></a>    <span class="n">cancerdf</span> <span class="o">=</span> <span class="n">answer_one</span><span class="p">()</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-8"></a>    <span class="n">means</span> <span class="o">=</span> <span class="n">cancerdf</span><span class="o">.</span><span class="n">mean</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-9"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_2aeb0ee62f104078a3216c39ba55d990-10"></a>    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_b97acb920cb04b71814ef44e235e35b4-1"></a><span class="n">answer_six</span><span class="p">()</span>
</pre>
<pre class="literal-block">
array([ 1.])
</pre>
</div>
<div class="section" id="question-7">
<h2>Question 7</h2>
<p>Using your knn classifier, predict the class labels for the test set <tt class="docutils literal">X_test</tt>.</p>
<pre class="code python"><a name="rest_code_730d1f64e89a4f1689ac989e708b421c-1"></a><span class="k">def</span> <span class="nf">answer_seven</span><span class="p">():</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-2"></a>    <span class="sd">"""predicts likelihood of cancer for test set</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-3"></a>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-5"></a><span class="sd">     numpy.array: vector of predictions</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-6"></a><span class="sd">    """</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-7"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-8"></a>    <span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_730d1f64e89a4f1689ac989e708b421c-9"></a>    <span class="k">return</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_d63162c8e44b43fe85f13e3308281ba8-1"></a><span class="n">predictions</span> <span class="o">=</span> <span class="n">answer_seven</span><span class="p">()</span>
<a name="rest_code_d63162c8e44b43fe85f13e3308281ba8-2"></a><span class="k">assert</span> <span class="n">predictions</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">143</span><span class="p">,)</span>
<a name="rest_code_d63162c8e44b43fe85f13e3308281ba8-3"></a><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">}</span>
</pre>
<pre class="code python"><a name="rest_code_8bcb0654ef15444a835dfc5bca610e33-1"></a><span class="k">print</span><span class="p">(</span><span class="s2">"no cancer: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">predictions</span><span class="o">==</span><span class="mi">0</span><span class="p">])))</span>
<a name="rest_code_8bcb0654ef15444a835dfc5bca610e33-2"></a><span class="k">print</span><span class="p">(</span><span class="s2">"cancer: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">predictions</span><span class="o">==</span><span class="mi">1</span><span class="p">])))</span>
</pre>
</div>
<div class="section" id="question-8">
<h2>Question 8</h2>
<p>Find the score (mean accuracy) of your knn classifier using <tt class="docutils literal">X_test</tt> and <tt class="docutils literal">y_test</tt>.</p>
<pre class="code python"><a name="rest_code_714ff61fb3d84b01949cd891539b61b0-1"></a><span class="k">def</span> <span class="nf">answer_eight</span><span class="p">():</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-2"></a>    <span class="sd">"""calculates the mean accuracy of the KNN model</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-3"></a>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-5"></a><span class="sd">     float: mean accuracy of the model predicting cancer</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-6"></a><span class="sd">    """</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-7"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-8"></a>    <span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_714ff61fb3d84b01949cd891539b61b0-9"></a>    <span class="k">return</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre>
<pre class="code python"><a name="rest_code_2e49b8f6f8ba4835af17d93952a09bc9-1"></a><span class="n">answer_eight</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="optional-plot">
<h2>Optional plot</h2>
<p>Try using the plotting function below to visualize the differet predicition scores between training and test sets, as well as malignant and benign cells.</p>
<pre class="code python"><a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-1"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-2"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-3"></a><span class="k">def</span> <span class="nf">accuracy_plot</span><span class="p">():</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-4"></a>    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-5"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-6"></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-7"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-8"></a>    <span class="c1"># Find the training and testing accuracies by target value (i.e. malignant, benign)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-9"></a>    <span class="n">mal_train_X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-10"></a>    <span class="n">mal_train_y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-11"></a>    <span class="n">ben_train_X</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-12"></a>    <span class="n">ben_train_y</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-13"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-14"></a>    <span class="n">mal_test_X</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-15"></a>    <span class="n">mal_test_y</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-16"></a>    <span class="n">ben_test_X</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-17"></a>    <span class="n">ben_test_y</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-18"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-19"></a>    <span class="n">knn</span> <span class="o">=</span> <span class="n">answer_five</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-20"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-21"></a>    <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">mal_train_X</span><span class="p">,</span> <span class="n">mal_train_y</span><span class="p">),</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ben_train_X</span><span class="p">,</span> <span class="n">ben_train_y</span><span class="p">),</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-22"></a>              <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">mal_test_X</span><span class="p">,</span> <span class="n">mal_test_y</span><span class="p">),</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ben_test_X</span><span class="p">,</span> <span class="n">ben_test_y</span><span class="p">)]</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-23"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-24"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-25"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-26"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-27"></a>    <span class="c1"># Plot the scores as a bar chart</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-28"></a>    <span class="n">bars</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">'#4c72b0'</span><span class="p">,</span><span class="s1">'#4c72b0'</span><span class="p">,</span><span class="s1">'#55a868'</span><span class="p">,</span><span class="s1">'#55a868'</span><span class="p">])</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-29"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-30"></a>    <span class="c1"># directly label the score onto the bars</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-31"></a>    <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-32"></a>        <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-33"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">*.</span><span class="mi">90</span><span class="p">,</span> <span class="s1">'{0:.{1}f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-34"></a>                     <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-35"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-36"></a>    <span class="c1"># remove all the ticks (both axes), and tick labels on the Y axis</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-37"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="s1">'off'</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="s1">'on'</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-38"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-39"></a>    <span class="c1"># remove the frame of the chart</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-40"></a>    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-41"></a>        <span class="n">spine</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-42"></a>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-43"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s1">'Malignant</span><span class="se">\n</span><span class="s1">Training'</span><span class="p">,</span> <span class="s1">'Benign</span><span class="se">\n</span><span class="s1">Training'</span><span class="p">,</span> <span class="s1">'Malignant</span><span class="se">\n</span><span class="s1">Test'</span><span class="p">,</span> <span class="s1">'Benign</span><span class="se">\n</span><span class="s1">Test'</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">);</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-44"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Training and Test Accuracies for Malignant and Benign Cells'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<a name="rest_code_f5ec1deb255f4ec4bfc6268b690d7429-45"></a><span class="n">accuracy_plot</span><span class="p">()</span>
</pre>
<img alt="accuracies.png" src="posts/predicting-cancer/accuracies.png">
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/bokeh-test/" class="u-url">Bokeh Test</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/bokeh-test/" rel="bookmark"><time class="published dt-published" datetime="2017-05-24T12:29:09-07:00" title="2017-05-24 12:29">2017-05-24 12:29</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="the-plot">
<h2>The Plot</h2>
<script src="posts/bokeh-test/portland_unemployment.js" id="686c5dd6-168a-4f7d-acbc-524875d93b59" data-bokeh-model-id="c473232a-dc2c-4b75-988c-f9bc6517b4b9" data-bokeh-doc-id="402d8e3c-1595-4d65-9f76-e11068c629ab"></script>
</div>
<div class="section" id="what-this-is">
<h2>What This Is</h2>
<p>This is a re-do of the final plot done for data-science with python course 2 week 4. The original was done with matplotlib and this was done with bokeh to get some interaction working. When I tried to create it the first time bokeh raised some errors saying that <tt class="docutils literal">height</tt> had been defined more than once. I don't know what really caused it - possibly a namespace clash where I was re-using something I didn't intend to re-use - but when I created a new notebook that only created the one plot it worked. Since this uses javascript I used Jupyter and the web-inteface to test it out (emacs ipython doesn't seem to be able to render javascript (unless I'm doing it wrong)).</p>
</div>
<div class="section" id="how-it-got-exported">
<h2>How It Got Exported</h2>
<p>I won't go over the creating of the data (since I just copied it from an earlier notebook) but this is how the bokeh plot was created.</p>
<div class="section" id="imports">
<h3>Imports</h3>
<p>These were the bokeh parts I needed.</p>
<pre class="code python"><a name="rest_code_6fdd1928445f47c2aee381e930466867-1"></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-2"></a>    <span class="n">BoxAnnotation</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-3"></a>    <span class="n">CustomJS</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-4"></a>    <span class="n">Span</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-5"></a>    <span class="n">Toggle</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-6"></a><span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-7"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-8"></a><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-9"></a>    <span class="n">output_file</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-10"></a>    <span class="n">output_notebook</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-11"></a>    <span class="n">show</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-12"></a><span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-13"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-14"></a><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-15"></a>    <span class="n">figure</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-16"></a>    <span class="n">ColumnDataSource</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-17"></a> <span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-18"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-19"></a><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-20"></a>    <span class="n">CrosshairTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-21"></a>    <span class="n">HoverTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-22"></a>    <span class="n">PanTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-23"></a>    <span class="n">ResetTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-24"></a>    <span class="n">ResizeTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-25"></a>    <span class="n">SaveTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-26"></a>    <span class="n">UndoTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-27"></a>    <span class="n">WheelZoomTool</span><span class="p">,</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-28"></a>    <span class="p">)</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-29"></a>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-30"></a><span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">column</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-31"></a><span class="kn">from</span> <span class="nn">bokeh.resources</span> <span class="kn">import</span> <span class="n">CDN</span>
<a name="rest_code_6fdd1928445f47c2aee381e930466867-32"></a><span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">autoload_static</span>
</pre>
</div>
<div class="section" id="some-constants">
<h3>Some Constants</h3>
<pre class="code python"><a name="rest_code_006662e13b804d2a9a33b79c74db13f0-1"></a><span class="n">NATIONAL_COLOR</span> <span class="o">=</span> <span class="s2">"slategrey"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-2"></a><span class="n">NATIONAL_LABEL</span> <span class="o">=</span> <span class="s2">"National"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-3"></a><span class="n">PORTLAND_COLOR</span> <span class="o">=</span> <span class="s2">"cornflowerblue"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-4"></a><span class="n">PORTLAND_LABEL</span> <span class="o">=</span> <span class="s2">"Portland-Hillsboro-Vancouver"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-5"></a><span class="n">S_AND_P_COLOR</span> <span class="o">=</span> <span class="s2">"#90151B"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-6"></a><span class="n">S_AND_P_LABEL</span> <span class="o">=</span> <span class="s2">"S &amp; P 500 Index"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-7"></a><span class="n">HOUSING_COLOR</span> <span class="o">=</span> <span class="s2">"#D89159"</span>
<a name="rest_code_006662e13b804d2a9a33b79c74db13f0-8"></a><span class="n">HOUSING_LABEL</span> <span class="o">=</span> <span class="s2">"House Price Index"</span>
</pre>
</div>
<div class="section" id="the-data">
<h3>The Data</h3>
<p><tt class="docutils literal">bokeh</tt> doesn't work with <tt class="docutils literal">pandas</tt> <tt class="docutils literal">DataFrame</tt>'s (or at least I couldn't get it to work). Instead you create a DataFrame-like object using the <tt class="docutils literal">ColumnDataSource</tt>.</p>
<pre class="code python"><a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-1"></a><span class="n">portland_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-2"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-3"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-4"></a>        <span class="n">unemployment</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">unemployment_rate</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-5"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">portland</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-6"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-7"></a><span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-8"></a>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-9"></a><span class="n">national_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-10"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-11"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-12"></a>        <span class="n">unemployment</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">unemployment_rate</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-13"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">national</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-14"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-15"></a>    <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-16"></a>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-17"></a><span class="n">housing_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-18"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-19"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">house_price_index</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-20"></a>        <span class="n">price</span><span class="o">=</span><span class="n">house_price_index</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-21"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-22"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-23"></a>    <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-24"></a>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-25"></a><span class="n">s_and_p_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-26"></a>    <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-27"></a>        <span class="n">month_data</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-28"></a>        <span class="n">value</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">VALUE</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-29"></a>        <span class="n">month_label</span><span class="o">=</span><span class="n">s_and_p_index</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-30"></a>        <span class="p">)</span>
<a name="rest_code_84b1f751633c412bac4fa754ba15ffaf-31"></a><span class="p">)</span>
</pre>
</div>
<div class="section" id="the-tools">
<h3>The Tools</h3>
<p>These are the things that add interactivity to the plot. You have to create new ones for each figure so I made a function to get them.</p>
<pre class="code python"><a name="rest_code_dea109b0974f472da1ee62dacab2c118-1"></a><span class="k">def</span> <span class="nf">make_tools</span><span class="p">():</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-2"></a>    <span class="sd">"""makes the tools for the figures</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-3"></a>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-5"></a><span class="sd">     list: tool objects</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-6"></a><span class="sd">    """</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-7"></a>    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-8"></a>    <span class="p">(</span><span class="s2">"month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-9"></a>    <span class="p">(</span><span class="s2">"unemployment"</span><span class="p">,</span> <span class="s2">"@unemployment"</span><span class="p">),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-10"></a>    <span class="p">])</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-11"></a>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-12"></a>    <span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-13"></a>        <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-14"></a>        <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-15"></a>        <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-16"></a>        <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-17"></a>        <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-18"></a>        <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-19"></a>        <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-20"></a>        <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-21"></a>    <span class="p">]</span>
<a name="rest_code_dea109b0974f472da1ee62dacab2c118-22"></a>    <span class="k">return</span> <span class="n">tools</span>
</pre>
<p>The <tt class="docutils literal">HoverTool tooltips</tt> argument is a list of tuples - one tuple for each dimension of the data. The first argument of the tuple (e.g. "month") is the label that will appear when the user hover's over the data point, while the second (e.g. "@month_label") tells bokeh which column to use for the data (so it has to match the key you used in the <tt class="docutils literal">ColumnDataSource</tt> creation).</p>
</div>
<div class="section" id="helper-functions">
<h3>Helper Functions</h3>
<p>The sub-figures needed some common elements so I created functions for them.</p>
<div class="section" id="scaling-the-timestamps">
<h4>Scaling The Timestamps</h4>
<p>The timestamps by default are unreadable (because there are so many). This re-scales them so they are more readable.</p>
<pre class="code python"><a name="rest_code_10864e10bcd84d67978a9addead9edc8-1"></a><span class="k">def</span> <span class="nf">scale_timestamp</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-2"></a>    <span class="sd">"""gets the scaled timestamp for element location</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-3"></a>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-4"></a><span class="sd">    Args:</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-5"></a><span class="sd">     index: index in the portland.datetime series</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-6"></a><span class="sd">    Returns:</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-7"></a><span class="sd">     epoch timestamp used to locate place in plot</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-8"></a><span class="sd">    """</span>
<a name="rest_code_10864e10bcd84d67978a9addead9edc8-9"></a>    <span class="k">return</span> <span class="n">portland</span><span class="o">.</span><span class="n">datetime</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">*</span> <span class="n">TIME_SCALE</span>
</pre>
</div>
<div class="section" id="drawing-the-recession">
<h4>Drawing the Recession</h4>
<p>The recession is indicated as a blue box on each plot.</p>
<pre class="code python"><a name="rest_code_dda80a34e41641f3aa46953e365f4eba-1"></a><span class="k">def</span> <span class="nf">make_recession</span><span class="p">():</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-2"></a>    <span class="sd">"""Makes the box for the recession</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-3"></a>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-4"></a><span class="sd">    Returns:</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-5"></a><span class="sd">     BoxAnnotation to color the recession</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-6"></a><span class="sd">    """</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-7"></a>    <span class="k">return</span> <span class="n">BoxAnnotation</span><span class="p">(</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-8"></a>        <span class="n">left</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">recession_start</span><span class="p">),</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-9"></a>        <span class="n">right</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">recession_end</span><span class="p">),</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-10"></a>        <span class="n">fill_color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
<a name="rest_code_dda80a34e41641f3aa46953e365f4eba-11"></a>        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="vertical-lines">
<h4>Vertical Lines</h4>
<p>Things like the unemployment lows and highs are indicated by a vertical line.</p>
<pre class="code python"><a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-1"></a><span class="k">def</span> <span class="nf">make_vertical</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">):</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-2"></a>    <span class="sd">"""makes a vertical line</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-3"></a>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-4"></a><span class="sd">    Args:</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-5"></a><span class="sd">     location: place on the x-axis for the line</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-6"></a><span class="sd">     color (str): line-color for the line</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-7"></a><span class="sd">    Returns:</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-8"></a><span class="sd">     Span at index</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-9"></a><span class="sd">    """</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-10"></a>    <span class="k">return</span> <span class="n">Span</span><span class="p">(</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-11"></a>        <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-12"></a>        <span class="n">line_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-13"></a>        <span class="n">dimension</span><span class="o">=</span><span class="s2">"height"</span><span class="p">,</span>
<a name="rest_code_fad287d6047f4e6ebee448e1a4fae050-14"></a>    <span class="p">)</span>
</pre>
</div>
<div class="section" id="make-verticals">
<h4>Make Verticals</h4>
<p>Since there's more than one line, this function adds all the lines.</p>
<pre class="code python"><a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-1"></a><span class="k">def</span> <span class="nf">make_verticals</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-2"></a>    <span class="sd">"""makes the verticals and adds them to the figures"""</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-3"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-4"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">unemployment_peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-5"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-6"></a>    <span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-7"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-8"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">s_and_p_nadir</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-9"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"crimson"</span><span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-10"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-11"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">housing_nadir</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-12"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"limegreen"</span><span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-13"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_vertical</span><span class="p">(</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-14"></a>        <span class="n">location</span><span class="o">=</span><span class="n">scale_timestamp</span><span class="p">(</span><span class="n">national_peak</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-15"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">))</span>
<a name="rest_code_153598f0d7f04e17913fb37f0b4e95bd-16"></a>    <span class="k">return</span>
</pre>
</div>
</div>
<div class="section" id="the-figures">
<h3>The Figures</h3>
<p>This plot has three sub-figures, each of which is created separately then added to the <tt class="docutils literal">Column</tt>.</p>
<div class="section" id="unemployment">
<h4>Unemployment</h4>
<pre class="code python"><a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-1"></a><span class="n">tools</span> <span class="o">=</span> <span class="n">make_tools</span><span class="p">()</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-2"></a><span class="n">unemployment_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-3"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-4"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-5"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-6"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-7"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"Portland Unemployment (2007-2017)"</span>
<a name="rest_code_2bc8c815bf3d4f789b5af2fcda943dcb-8"></a><span class="p">)</span>
</pre>
<p>Next the lines for the time-series data are added.</p>
<pre class="code python"><a name="rest_code_daa52556f183451c9f5cbdb9c218494d-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-2"></a>    <span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"unemployment"</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-3"></a>    <span class="n">source</span><span class="o">=</span><span class="n">portland_source</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-4"></a>    <span class="n">line_color</span><span class="o">=</span><span class="n">PORTLAND_COLOR</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-5"></a>    <span class="n">legend</span><span class="o">=</span><span class="n">PORTLAND_LABEL</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-6"></a>          <span class="p">)</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-7"></a>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-8"></a><span class="n">line</span> <span class="o">=</span> <span class="n">unemployment_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-9"></a>    <span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"unemployment"</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-10"></a>    <span class="n">source</span><span class="o">=</span><span class="n">national_source</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-11"></a>    <span class="n">line_color</span><span class="o">=</span><span class="n">NATIONAL_COLOR</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-12"></a>    <span class="n">legend</span><span class="o">=</span><span class="n">NATIONAL_LABEL</span><span class="p">,</span>
<a name="rest_code_daa52556f183451c9f5cbdb9c218494d-13"></a><span class="p">)</span>
</pre>
<p>Now the recession-box and high and low points for each plot is added.</p>
<pre class="code python"><a name="rest_code_3911a35ae6af46b3ae37a99f8d6263d4-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_3911a35ae6af46b3ae37a99f8d6263d4-2"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">unemployment_figure</span><span class="p">)</span>
</pre>
<p>Now some labels are added and the grid is turned off.</p>
<pre class="code python"><a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-1"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"% Unemployment"</span>
<a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-2"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-3"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_0d99d4a80ad74a75974d96f13088cc19-4"></a><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
</pre>
</div>
<div class="section" id="s-p-500">
<h4>S &amp; P 500</h4>
<p>The S &amp; P 500 had didn't have unemployment as the dependent variable so I made a different set of tools to change the label for the hover.</p>
<pre class="code python"><a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-1"></a><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-2"></a>    <span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-3"></a>    <span class="p">(</span><span class="s2">"Value"</span><span class="p">,</span> <span class="s2">"@value"</span><span class="p">),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-4"></a><span class="p">])</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-5"></a><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-6"></a>    <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-7"></a>    <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-8"></a>    <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-9"></a>    <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-10"></a>    <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-11"></a>    <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-12"></a>    <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-13"></a>    <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-14"></a><span class="p">]</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-15"></a><span class="n">s_and_p_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-16"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-17"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-18"></a>    <span class="n">x_range</span><span class="o">=</span><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-19"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-20"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-21"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"S &amp; P 500 Index"</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-22"></a><span class="p">)</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-23"></a><span class="n">line</span> <span class="o">=</span> <span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-24"></a>                    <span class="n">source</span><span class="o">=</span><span class="n">s_and_p_source</span><span class="p">,</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-25"></a>                    <span class="n">line_color</span><span class="o">=</span><span class="n">S_AND_P_COLOR</span><span class="p">)</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-26"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-27"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">s_and_p_figure</span><span class="p">)</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-28"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"S &amp; P 500 Valuation"</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-29"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-30"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-31"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_af1fb1c9b24244fbba92e5a3fdbe0966-32"></a><span class="n">s_and_p_figure</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
</pre>
</div>
<div class="section" id="housing">
<h4>Housing</h4>
<pre class="code python"><a name="rest_code_e8c2026d5451488292ad21b127b65a8b-1"></a><span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-2"></a>    <span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="s2">"@month_label"</span><span class="p">),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-3"></a>    <span class="p">(</span><span class="s2">"Price"</span><span class="p">,</span> <span class="s2">"@price"</span><span class="p">),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-4"></a><span class="p">])</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-5"></a><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-6"></a>    <span class="n">hover</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-7"></a>    <span class="n">CrosshairTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-8"></a>    <span class="n">PanTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-9"></a>    <span class="n">ResetTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-10"></a>    <span class="n">ResizeTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-11"></a>    <span class="n">SaveTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-12"></a>    <span class="n">UndoTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-13"></a>    <span class="n">WheelZoomTool</span><span class="p">(),</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-14"></a><span class="p">]</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-15"></a><span class="n">housing_figure</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-16"></a>    <span class="n">plot_width</span><span class="o">=</span><span class="n">FIGURE_WIDTH</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-17"></a>    <span class="n">plot_height</span><span class="o">=</span><span class="n">FIGURE_HEIGHT</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-18"></a>    <span class="n">x_range</span><span class="o">=</span><span class="n">unemployment_figure</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-19"></a>    <span class="n">x_axis_type</span><span class="o">=</span><span class="s2">"datetime"</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-20"></a>    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-21"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">"House Price Index"</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-22"></a><span class="p">)</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-23"></a><span class="n">line</span> <span class="o">=</span> <span class="n">housing_figure</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s2">"month_data"</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-24"></a>                           <span class="n">source</span><span class="o">=</span><span class="n">housing_source</span><span class="p">,</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-25"></a>                           <span class="n">line_color</span><span class="o">=</span><span class="n">HOUSING_COLOR</span><span class="p">)</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-26"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">make_recession</span><span class="p">())</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-27"></a><span class="n">make_verticals</span><span class="p">(</span><span class="n">housing_figure</span><span class="p">)</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-28"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Sale Price ($1,000)"</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-29"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">"Month"</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-30"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-31"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<a name="rest_code_e8c2026d5451488292ad21b127b65a8b-32"></a><span class="n">housing_figure</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
</pre>
</div>
</div>
<div class="section" id="combining">
<h3>Combining</h3>
<p>Once the figures were created I combined them into a <tt class="docutils literal">column</tt>, since I wanted them stacked verticallly.</p>
<pre class="code python"><a name="rest_code_7f9a96af6524449babcfe03399e43b8d-1"></a><span class="n">combined</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">unemployment_figure</span><span class="p">,</span> <span class="n">s_and_p_figure</span><span class="p">,</span> <span class="n">housing_figure</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="outputting-the-code">
<h3>Outputting The Code</h3>
<p>In order to be able to embed the code, you need to have bokeh export it. There are multiple ways to do this, but I chose the <tt class="docutils literal">autoload_static</tt> method.</p>
<pre class="code python"><a name="rest_code_7915c39cbee2401f8cf94bf97e6a06a3-1"></a><span class="n">OUTPUT_JAVASCRIPT</span> <span class="o">=</span> <span class="s2">"portland_unemployment.js"</span>
<a name="rest_code_7915c39cbee2401f8cf94bf97e6a06a3-2"></a><span class="n">js</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">autoload_static</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">CDN</span><span class="p">,</span> <span class="n">OUTPUT_JAVASCRIPT</span><span class="p">)</span>
</pre>
<p>The third argument (<tt class="docutils literal">OUTPUT_JAVASCRIPT</tt>) is the path you want to refer to in the tag. The returned <tt class="docutils literal">js</tt> variable contains the javascript you need to save (using the filename you gave <tt class="docutils literal">autoload_static</tt>) and the <tt class="docutils literal">tag</tt> contains the HTML tag that you embed to let the server know you want to use the javascript that was saved.</p>
<p>Since both values are just strings, and nothing was saved to disk, I saved it for later.</p>
<pre class="code python"><a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">OUTPUT_JAVASCRIPT</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-2"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-3"></a>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-4"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"portland_tag.html"</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<a name="rest_code_d5c6a9157d664f8ebee6661ef66261d8-5"></a>    <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="getting-it-into-nikola">
<h3>Getting It Into Nikola</h3>
<p>The first thing was to create this file using <tt class="docutils literal">nikola new_post</tt> (it's called bokeh-test.rst). Next I created a directory in the <tt class="docutils literal">files</tt> folder that had the same name as this file (without the ".rst" extension) to put the javascript in so nikola would find it when I built the HTML.</p>
<pre class="code bash"><a name="rest_code_3612d3ea9550434c9b0bdc024a3b44c0-1"></a>mkdir files/posts/bokeh-test
</pre>
<p>Once I copied the <tt class="docutils literal">portland_unemployment.js</tt> file to the <tt class="docutils literal"><span class="pre">bokeh-test</span></tt> directory I opened the <tt class="docutils literal">portland_tag.html</tt> file and embedded it directly into the post sing the <tt class="docutils literal">raw</tt> restructureText directive.</p>
<pre class="code rst"><a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-1"></a><span class="p">..</span> <span class="ow">raw</span><span class="p">::</span> html
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-2"></a>
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-3"></a>   &lt;script
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-4"></a>       src="portland_unemployment.js"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-5"></a>       id="686c5dd6-168a-4f7d-acbc-524875d93b59"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-6"></a>       data-bokeh-model-id="c473232a-dc2c-4b75-988c-f9bc6517b4b9"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-7"></a>       data-bokeh-doc-id="402d8e3c-1595-4d65-9f76-e11068c629ab"
<a name="rest_code_48c6770af9ce4b528c1dabf1c1e2cc3c-8"></a>   &gt;&lt;/script&gt;
</pre>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/assignment-4/" class="u-url">Assignment 4</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/assignment-4/" rel="bookmark"><time class="published dt-published" datetime="2017-04-30T22:32:02-07:00" title="2017-04-30 22:32">2017-04-30 22:32</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
This notebook looks at the unemployment rate for the Portland-Hillsboro-Vancouver area (in Oregon and Washington State) from January 2007 through February 2017. I want to answer the questions - <i>How has Portland's unemployment rate changed over the last ten years and how does it compare to the national unemployment rate?</i> Additionally, I'd like to see how well this metric follows the <i>S&amp;P 500 Index</i> and the <i>Housing Price Index</i>.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Imports and Setup</h2>
<div class="outline-text-2" id="text-1">
<div class="highlight"><pre><span></span># python standard library
import os

# third-party
import matplotlib.pyplot as pyplot
import numpy
import pandas
import pygal
import requests
import seaborn
</pre></div>

<div class="highlight"><pre><span></span>% matplotlib inline
seaborn.set_style("whitegrid")
</pre></div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Data</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Dropbox</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">National Unemployment</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
<a href="https://www.dropbox.com/s/qw2l5hmu061l8x2/national_unemployment.csv?dl=1">https://www.dropbox.com/s/qw2l5hmu061l8x2/national_unemployment.csv?dl=1</a>
</p>
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">Portland Hillsboro Vancouver</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
<a href="https://www.dropbox.com/s/wvux3d7dcaae5t0/portland_unemployment_2007_2017.csv?dl=1">https://www.dropbox.com/s/wvux3d7dcaae5t0/portland_unemployment_2007_2017.csv?dl=1</a>
</p>
</div>
</div>
<div id="outline-container-sec-2-1-3" class="outline-4">
<h4 id="sec-2-1-3">Purchase Only House Price:</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
<a href="https://www.dropbox.com/s/4hu2jpjkhcnr35k/purchase_only_house_price_index.csv?dl=1">https://www.dropbox.com/s/4hu2jpjkhcnr35k/purchase_only_house_price_index.csv?dl=1</a>
</p>
</div>
</div>
<div id="outline-container-sec-2-1-4" class="outline-4">
<h4 id="sec-2-1-4">S&amp;P 500 Index</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
<a href="https://www.dropbox.com/s/ojj5zp7feid6wwl/SP500_index.csv?dl=1">https://www.dropbox.com/s/ojj5zp7feid6wwl/SP500_index.csv?dl=1</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Constants</h3>
<div class="outline-text-3" id="text-2-2">
<div class="highlight"><pre><span></span>class Urls(object):
    national = "https://www.dropbox.com/s/qw2l5hmu061l8x2/national_unemployment.csv?dl=1"
    portland = "https://www.dropbox.com/s/wvux3d7dcaae5t0/portland_unemployment_2007_2017.csv?dl=1"
    house_price = "https://www.dropbox.com/s/4hu2jpjkhcnr35k/purchase_only_house_price_index.csv?dl=1"
    s_and_p = "https://www.dropbox.com/s/ojj5zp7feid6wwl/SP500_index.csv?dl=1"
</pre></div>

<div class="highlight"><pre><span></span>class Paths(object):
    portland = "portland_unemployment_2007_2017.csv"
    national = "national_unemployment.csv"
    s_and_p = "SP500_index.csv"
    house_price = "purchase_only_house_price_index.csv"
</pre></div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Downloading</h3>
<div class="outline-text-3" id="text-2-3">
<div class="highlight"><pre><span></span>def download_data(path, url):
    """downloads the file if it doesn't exist
    Args:
     path (str): path to the file
     url (str): download url

    """
    if not os.path.isfile(path):
	response = requests.get(url)
	with open(path, 'w') as writer:
	    writer.write(response.text)
    return
</pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Portland</h2>
<div class="outline-text-2" id="text-3">
<p>
The data represents  `Local Area Unemployment Statistics` for the <b>Portland-Hillsboro-Vancouver</b> area in Oregon and was taken from the <a href="https://beta.bls.gov/dataViewer/view/timeseries/LAUMT413890000000003">Bureau of Labor Statistics</a> (the <i>Portland-Vancouver-Hillsboro, OR-WA Metropolitan Statistical Area</i>).  It has monthly values starting from January 2007 and continues through February 2017.
</p>


<p>
Data extracted on: Apr 30, 2017 (6:54:00 PM)
</p>

<p>
Local Area Unemployment Statistics
</p>

<p>
Series Title        :        Unemployment Rate: Portland-Vancouver-Hillsboro, OR-WA Metropolitan Statistical Area (U)
Series ID        :        LAUMT413890000000003
Seasonality        :        Not Seasonally Adjusted
Survey Name        :        Local Area Unemployment Statistics
Measure Data Type        :        unemployment rate
Area        :        Portland-Vancouver-Hillsboro, OR-WA Metropolitan Statistical Area
Area Type        :        Metropolitan areas
</p>


<div class="highlight"><pre><span></span>download_data(Paths.portland, Urls.portland)
portland = pandas.read_csv(Paths.portland)
</pre></div>

<div class="highlight"><pre><span></span>portland.describe()
</pre></div>

<div class="highlight"><pre><span></span>portland.head()
</pre></div>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Cleaning</h3>
<div class="outline-text-3" id="text-3-1">
<p>
I changed to a slightly different data-source so that I could get direct links to the data, so I'm going  to re-name some of the columns to match what I was using befroe
</p>

<div class="highlight"><pre><span></span>column_renames = {"Value": "unemployment_rate",
		  "Label": "date"}
portland.rename(columns=column_renames,
		inplace=True)
portland.columns
</pre></div>

<p>
Now I'll re-do the dates.
</p>

<div class="highlight"><pre><span></span>portland.Period.unique()
</pre></div>

<p>
I use the months in one of the plots as labels so I'm going to create a column with just their (abbreviated) names.
</p>

<div class="highlight"><pre><span></span>month_map = dict(M01="Jan", M02="Feb", M03="Mar", M04="Apr", M05="May",
		 M06="Jun", M07="Jul", M08="Aug", M09="Sep", M10="Oct",
		 M11="Nov", M12="Dec")
portland["month"] = portland.Period.apply(lambda x: month_map[x])
portland.head()
</pre></div>

<p>
In the plot I'm going to mark where the unemployment was at its highest point.
</p>

<div class="highlight"><pre><span></span>highest_unemployment = portland.unemployment_rate.max()
print(highest_unemployment)
unemployment_peaks = numpy.where(portland.unemployment_rate==highest_unemployment)[0]
</pre></div>

<div class="highlight"><pre><span></span>unemployment_peaks
</pre></div>

<div class="highlight"><pre><span></span>print(portland.date.ix[unemployment_peaks[0]])
print(portland.date.ix[unemployment_peaks[1]])
</pre></div>

<p>
It looks like it reached 11.4% twice - on June, 2009 and January of 2010.
</p>

<div class="highlight"><pre><span></span>lowest_unemployment = portland.unemployment_rate.min()
print(lowest_unemployment)
print(highest_unemployment/lowest_unemployment)
print(str(portland.date.ix[numpy.where(
    portland.unemployment_rate==lowest_unemployment)]))
</pre></div>

<p>
At its peak, the unemployment rate for the Portland-Hillsboro-Vancouver area was almost three times higher than the most recent (preliminary) unemployment rate.
</p>

<p>
According to the <a href="https://www.nber.org/cycles.html">National Bureau of Economic Research</a>, the most recent economic contraction occurred from December 2007 through June 2009 which falls within the data set so I'll highlight that on the plot.
</p>

<div class="highlight"><pre><span></span>recession_start = numpy.where(portland.date=="2007 Dec")[0][0]
recession_end = numpy.where(portland.date=="2009 Jun")[0][0]
portland_recession_start = portland.unemployment_rate.iloc[recession_start]
print(portland_recession_start)
print(portland.unemployment_rate.iloc[recession_end])
</pre></div>

<p>
When did it reach the recession-start rate?
</p>

<div class="highlight"><pre><span></span>portland.date.iloc[numpy.where(portland.unemployment_rate==portland_recession_start)[0][1]]
</pre></div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Unemployment Rate Over Time</h3>
<div class="outline-text-3" id="text-3-2">
<p>
First I'll plot how the unemployment rate changed over time.
</p>

<div class="highlight"><pre><span></span>figure = pyplot.figure(figsize=(10, 10))
axe = figure.gca()
seaborn.set_style("whitegrid")
portland.plot(x="date", y="unemployment_rate", ax=axe, legend=False)
axe.set_title("Portland-Hillsboro-Vancouver Unemployment Over Time")
axe.set_ylabel("% Unemployed")
axe.set_xlabel("Month")
seaborn.despine()
</pre></div>


<p>
It looks like unemployment was relatively low until September of 2008, when it suddenly spiked before beginning a steady downward trend.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">National</h2>
<div class="outline-text-2" id="text-4">
<p>
As a comparison, I downloaded the unemployment rate data for the nation as a whole (also taken from the <a href="https://beta.bls.gov/dataViewer/view/timeseries/LNU04000000">Bureau of Labor Statistics</a>.
</p>

<div class="highlight"><pre><span></span>NATIONAL_PATH = "national_unemployment.csv"
NATIONAL_URL = "https://www.dropbox.com/s/qw2l5hmu061l8x2/national_unemployment.csv?dl=1"
download_data(NATIONAL_PATH, NATIONAL_URL)
national = pandas.read_csv(NATIONAL_PATH)
national.head()
</pre></div>

<div class="highlight"><pre><span></span>national.rename(columns=column_renames, inplace=True)
national.head()
</pre></div>

<p>
The local data has one fewer month than the national one so I'll remove it here.
</p>

<div class="highlight"><pre><span></span>national.tail()
</pre></div>

<div class="highlight"><pre><span></span>national.drop([122], inplace=True)
national.tail()
</pre></div>

<div class="highlight"><pre><span></span>peak = national.unemployment_rate.max()
print(peak)
national_peak = numpy.where(national.unemployment_rate==peak)
print(portland.date.iloc[national_peak])
</pre></div>

<p>
When did it reach the same level it was at when the recession began?
</p>

<div class="highlight"><pre><span></span>national_recession_start = national.unemployment_rate.iloc[recession_start]
post_recession = national[national.Year &gt; 2009]
index = numpy.where(post_recession.unemployment_rate==national_recession_start)[0][0]
post_recession.date.iloc[index]
</pre></div>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Plotting</h3>
<div class="outline-text-3" id="text-4-1">
<p>
I'm not going to be looking at the numbers so much as comparing plots from now on so I'll remove the grid.
</p>

<div class="highlight"><pre><span></span>style = seaborn.axes_style("whitegrid")
style["axes.grid"] = False
seaborn.set_style("whitegrid", style)
</pre></div>

<div class="highlight"><pre><span></span>figure = pyplot.figure(figsize=(10, 10))
axe = figure.gca()
national.plot(x="date", y="unemployment_rate", ax=axe, legend=False)
portland.plot(x="date", y="unemployment_rate", ax=axe, legend=False)
axe.set_ylabel("% Unemployment")
axe.set_title("Unemployment Rate (Jan 2007 - Feb 2017)")

last = portland.date.count()
axe.text(last, national["unemployment_rate"].iloc[-1], "National")
axe.text(last, portland["unemployment_rate"].iloc[-1], "Portland-Hillsboro-Vancouver")
seaborn.despine()
</pre></div>


<div class="figure">
<p><img src="posts/assignment-4/national_unemployment.png" alt="national_unemployment.png"></p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">S&amp;P 500</h2>
<div class="outline-text-2" id="text-5">
<p>
Now I'm going to compare the unemployment rate to the S&amp;P 500 index for the same period. The S&amp;P 500 data came from the <a href="https://fred.stlouisfed.org/series/SP500/downloaddata">Federal Reserve Bank of St. Louis</a>. It contains the S&amp;P 500 monthly index from May 2007 through February 2017.
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">S and P Index</h3>
<div class="outline-text-3" id="text-5-1">
<div class="highlight"><pre><span></span>download_data(Paths.s_and_p, Urls.s_and_p)
s_and_p_index = pandas.read_csv("SP500_index.csv", na_values=".")
s_and_p_index.describe()
</pre></div>

<div class="highlight"><pre><span></span>pre = pandas.DataFrame({"DATE": ["2007-01-01", "2007-02-01", "2007-03-01"], "VALUE": [numpy.nan, numpy.nan, numpy.nan]})
s_and_p_index = pre.append(s_and_p_index)
s_and_p_index["date"] = portland.date.values
s_and_p_index = s_and_p_index.reset_index(drop=True)
s_and_p_index.head()
</pre></div>

<div class="highlight"><pre><span></span>s_and_p_index.tail()
</pre></div>



<div class="highlight"><pre><span></span>s_and_p_nadir = s_and_p_index.VALUE.min()
print(s_and_p_nadir)
s_and_p_nadir = numpy.where(s_and_p_index.VALUE==s_and_p_nadir)[0]
print(s_and_p_index.date.iloc[s_and_p_nadir])
</pre></div>

<p>
So the stock-market hit bottom in December of 2008, six months before the Portland-Hillsboro-Vancouver unemployment rate reached its (first) high-point and ten months before the national unemployment rate hit its peak.
</p>

<p>
Next I'll see if plotting the S&amp;P 500 Index vs Unemployment Rate data shows anything interesting.
</p>

<div class="highlight"><pre><span></span>figure = pyplot.figure(figsize=(10, 10))
axe = figure.gca()
# the S&amp;P data is missing the first four months so slice
# the unemployment data
axe.plot(s_and_p_index.VALUE, national.unemployment_rate)
axe.plot(s_and_p_index.VALUE, portland.unemployment_rate)
axe.set_title("Unemployment Rate vs S&amp;P 500")
axe.set_xlabel("S&amp;P 500 Index")
axe.set_ylabel("% Unemployment")
last_x = s_and_p_index.VALUE.iloc[-1] + 100
axe.text(last_x, national.unemployment_rate.iloc[-1], "National")
axe.text(last_x, portland.unemployment_rate.iloc[-1], "Portland-Hillsboro-Vancouver")
seaborn.despine()
</pre></div>


<div class="figure">
<p><img src="posts/assignment-4/s_and_p_index.png" alt="s_and_p_index.png"></p>
</div>

<p>
It looks like as the S&amp;P 500 goes down, the unemployment rate goes up, then, while the unemployment rate is at its peak, the S&amp;P 500 starts to increase, even as the unemployment rate stays high, until around the time when it reached 1200, the unemployment rates began to go down as the stock market improved.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Purchase Only House Price Index for the United States.</h2>
<div class="outline-text-2" id="text-6">
<p>
This data also came from the <a href="https://fred.stlouisfed.org/series/HPIPONM226S">Federal Reserve Bank of St. Louis</a>. It is based on more than six million repeat sales transactions on the same single-family properties. The original source of the data was the <a href="https://www.fhfa.gov/DataTools/Downloads/Pages/House-Price-Index.aspx">Federal Housing Finance Agency</a> (but it only provides an <code>xls</code> file, not a <code>csv</code>, so I took it from the FED). From the FHFA: 
</p>

<blockquote>
<p>
The HPI is a broad measure of the movement of single-family house prices. The HPI is a weighted, repeat-sales index, meaning that it measures average price changes in repeat sales or refinancings on the same properties. This information is obtained by reviewing repeat mortgage transactions on single-family properties whose mortgages have been purchased or securitized by Fannie Mae or Freddie Mac since January 1975.
</p>

<p>
The HPI serves as a timely, accurate indicator of house price trends at various geographic levels. Because of the breadth of the sample, it provides more information than is available in other house price indexes. It also provides housing economists with an improved analytical tool that is useful for estimating changes in the rates of mortgage defaults, prepayments and housing affordability in specific geographic areas.
</p>

<p>
The HPI includes house price figures for the nine Census Bureau divisions, for the 50 states and the District of Columbia, and for Metropolitan Statistical Areas (MSAs) and Divisions.
</p>
</blockquote>

<div class="highlight"><pre><span></span>download_data(Paths.house_price, Urls.house_price)
house_price_index = pandas.read_csv("purchase_only_house_price_index.csv")
house_price_index.describe()
</pre></div>

<div class="highlight"><pre><span></span>house_price_index.head()
</pre></div>

<div class="highlight"><pre><span></span>house_price_index["price"] = house_price_index.HPIPONM226S
house_price_index["date"] = portland.date[1:].values
house_price_index.head()
</pre></div>

<div class="highlight"><pre><span></span>pre = pandas.DataFrame({"DATE": ["2007-01-01"], "HPIPONM226S": [numpy.nan], "price": [numpy.nan], "date": ["2007 Jan"]})
house_price_index = pre.append(house_price_index)
house_price_index = house_price_index.reset_index(drop=True)
house_price_index.head()
</pre></div>

<div class="highlight"><pre><span></span>house_price_index.tail()
</pre></div>

<div class="highlight"><pre><span></span>housing_nadir = house_price_index.price.min()
print(housing_nadir)
housing_nadir = numpy.where(house_price_index.price==housing_nadir)[0]
print(house_price_index.date.iloc[housing_nadir])
</pre></div>

<p>
The House Price Index hit its low point about two and a half years after the stock market hit its low point.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">The Final Plot</h2>
<div class="outline-text-2" id="text-7">
<div class="highlight"><pre><span></span>figure , axes = pyplot.subplots(3,
				sharex=True)
(sp_axe, housing_axe, unemployment_axe) = axes
figure.set_size_inches(10, 10)

# plot the data
s_and_p_index.plot(x="date", y="VALUE", ax=sp_axe,
		   legend=False)
house_price_index.plot(x="date", y="price", ax=housing_axe,
		       legend=False)

national.plot(x="date", y="unemployment_rate", ax=unemployment_axe,
	      legend=False)
portland.plot(x="date", y="unemployment_rate", ax=unemployment_axe,
	      legend=False)

# plot the peaks/low-points as vertical lines
peak_color = "darkorange"
# portland-unemployment peaks
for peak in unemployment_peaks:
    for axe in axes:
	axe.axvline(peak, color=peak_color)

points = ((s_and_p_nadir, "crimson"),
	  (housing_nadir, "limegreen"),
	  (national_peak, "grey"))

for point, color in points:
    for axe in axes:
	axe.axvline(point, color=color)

# level at the start of the recession (it was the same for both Portland and the U.S.)
unemployment_axe.axhline(national.unemployment_rate.iloc[recession_start], alpha=0.25)
housing_axe.axhline(
    house_price_index.price.iloc[
	numpy.where(house_price_index.date=="2007 Dec")[0][0]], alpha=0.25)
sp_axe.axhline(
    s_and_p_index.VALUE.iloc[
	numpy.where(s_and_p_index.date=="2007 Dec")[0][0]], alpha=0.25)

# add labels 
unemployment_axe.set_ylabel("% Unemployment")
unemployment_axe.set_xlabel("")

housing_axe.set_ylabel("Sale Price ($1,000)")
sp_axe.set_ylabel("S&amp;P 500 Index")

figure.suptitle("Unemployment Rate April 2007 To February 2017 with S&amp;P 500 Index and House Price Index",
		weight="bold")

# label the data lines
last = portland.date.count()
unemployment_axe.text(last, national.unemployment_rate.iloc[-1], "National")
unemployment_axe.text(last, portland.unemployment_rate.iloc[-1], "Portland-Hillsboro-Vancouver")
sp_axe.text(last, s_and_p_index.VALUE.iloc[-1], "S&amp;P 500")
housing_axe.text(last, house_price_index.price.iloc[-1], "House Price Index")

# color in the recession
sp_axe.axvspan(recession_start, recession_end, alpha=0.25, facecolor='royalblue')
housing_axe.axvspan(recession_start, recession_end, alpha=0.25, facecolor='royalblue')
unemployment_axe.axvspan(recession_start, recession_end, alpha=0.25, facecolor='royalblue')

# label the vertical lines
sp_axe.text(s_and_p_nadir, s_and_p_index.VALUE.max() + 450, "S&amp;P Low", rotation=45)
sp_axe.text(unemployment_peaks[0], s_and_p_index.VALUE.max() + 575,  "Portland High", rotation=45)
sp_axe.text(housing_nadir, s_and_p_index.VALUE.max() + 550, "Housing Low", rotation=45)
sp_axe.text(36, s_and_p_index.VALUE.max() + 450, "U.S. High", rotation=45)
seaborn.despine()

# add a caption
# the coursera sight gives you the option to add a caption via the GUI
# figure.text(.1,.000001, """
#    Monthly Unadjusted Unemployment Rates for the Portland-Hillsboro-Vancouver area and the entire United States of America compared with the S&amp;P 500 Index and
#    House Price Index for the same period. The blue highlighted area is a period of economic contraction (December 2007 through June 2009) defined by the National 
#    Bureau of Economic Research. The vertical lines represent (red) the low-point for the S&amp;P 500, (orange) the first peak of the Portland-Hillsboro-Vancouver area 
#    unemployment, (gray) the peak of U.S. unemployment (overlaps second Portland-area value matching its first peak), and (green) the low-point for the house-price index.
#    The horizontal lines are the values for the metrics at the start of the recession.""")
</pre></div>


<div class="figure">
<p><img src="posts/assignment-4/unemployment_portland_vs_us_2004_2017.png" alt="unemployment_portland_vs_us_2004_2017.png"></p>
</div>

<div class="highlight"><pre><span></span>line = pygal.Line()
line.x_labels = s_and_p_index.date
line.add("date", house_price_index.price)
line.render_to_file("unemployment_portland_vs_us_2004_2017.svg")
# plot the data
# add a caption
# the coursera sight gives you the option to add a caption via the GUI
# figure.text(.1,.000001, """
#    Monthly Unadjusted Unemployment Rates for the Portland-Hillsboro-Vancouver area and the entire United States of America compared with the S&amp;P 500 Index and
#    House Price Index for the same period. The blue highlighted area is a period of economic contraction (December 2007 through June 2009) defined by the National 
#    Bureau of Economic Research. The vertical lines represent (red) the low-point for the S&amp;P 500, (orange) the first peak of the Portland-Hillsboro-Vancouver area 
#    unemployment, (gray) the peak of U.S. unemployment (overlaps second Portland-area value matching its first peak), and (green) the low-point for the house-price index.
#    The horizontal lines are the values for the metrics at the start of the recession.""")
</pre></div>

<p>
The visualization created was meant to show how Portland, Oregon, United States' unemployment rate related to the national unemployment rate, the stock market, and housing prices. The seasonally unadjusted employment rates for the Portland-Vancouver-Hillsboro area were retrieved from the Bureau of Labor Statistics' web-site, along with the unadjusted unemployment rates for the nation as a whole for the months from January 2017 through February 2017. Hillsboro is an incorporated part of metropolitan Portland and Vancouver is just North of Portland so many of its residents commute to Portland to work, and vice-versa. The monthly S&amp;P 500 Index from May 2007 through February 2017 along with the Purchase Only Price Index from February 2007 through February 2017 were retrieved from the St. Louis Federal Reserve website. The S&amp;P 500 index is the market capitalization of 500 large companies listed on the New York Stock Exchange or NASDAQ. The Purchase Only House Price Index is the average price change in repeat sales or refinancing of the same houses and is maintained by Federal Housing Finance Agency. The beginning and ending of the recession within this time period was taken from the National Bureau of Economic Research (<a href="https://www.nber.org/cycles.html">https://www.nber.org/cycles.html</a>). 
</p>

<p>
The visualization shows that during the recession, beginning in roughly September 2008, Portland's unemployment rate rose faster than the nation as a whole did, but by roughly May 2011 (coinciding with the lowest valuation for the House Price Index) it had dropped slightly lower than the national rate and has stayed in step with it, although it has thus far not followed the uptick in the national rate that began in November of 2016. Additionally the visualization shows the relative timing of the changes in the three metrics. In the year leading up to the recession, unemployment was relatively flat (ignoring the seasonal changes) and the S&amp;P also began relatively flat but then began a downward trend later in the year, the House Price Index, on the other hand, spent most of it starting what would become a four-year decline (since this was during the sub-prime mortgage crisis, this is perhaps not so surprising). The S&amp;P 500 hit its low point during the recession, as might be expected, but the peaks for the unemployment rates occurred when the recession was already over. Also, while the S&amp;P 500 recovered relatively quickly, the unemployment rates for both Portland and the United States as a whole did not reach the level that they were at when the recession began until October 2015.
</p>

<p>
Truthfulness:
</p>

<p>
To provide a baseline of trustworthiness I used only government sources (although, of course, some might see that as a negative). 
</p>

<p>
Beauty:
</p>

<p>
The internal grid was left out and in its place only vertical and horizontal lines for key values were highlighted (the vertical line represent the worst points for each metric, the horizontal lines the values that the metrics held when the recession began - so the point at which the horizontal line intersects the line after the recession is its recovery point) in an attempt to increase the data-ink ratio.
</p>

<p>
Functionality:
</p>

<p>
The data was plotted with a shared x-axis and three separate y-axes so that the states of each could be compared at the same point in time without distorting the plots due to the differing scales for each metric. I didn't include 0 on the y-axes, but the point was to observe inflection points and trends rather than measure exact values so I felt that this was unnecessary (it added a lot of whitespace without actually changing the shapes). As mentioned in the previous section, key points in the data were highlighted (including the time of the recession) so that the viewer could have some additional background information with regard to what was happening, and not just wonder what the strange spike in unemployment was about (or needing to know all the dates ahead of time).
</p>

<p>
Insightfulness:
</p>

<p>
By comparing the Portland unemployment rates to the national rates it hopefully revealed the story of how Portland did with regards to the rest of the country - initially doing worse than the nation, then catching up, and currently doing a little better. Additionally, by adding the context of the recession, as well as the performance of the S&amp;P 500 index and the House Price Index during the same period, I hoped to show how unemployment (at least in this time period) moved in relation to other parts of the economy.
</p>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Sources</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">U.S. Federal Housing Finance Agency, Purchase Only House Price Index for the United States [HPIPONM226S], retrieved from FRED, Federal Reserve Bank of St. Louis; <a href="https://fred.stlouisfed.org/series/HPIPONM226S">https://fred.stlouisfed.org/series/HPIPONM226S</a>, April 29, 2017.</h3>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/plotting-with-uncertainty-part-iii/" class="u-url">Plotting With Uncertainty (Part III)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/plotting-with-uncertainty-part-iii/" rel="bookmark"><time class="published dt-published" datetime="2017-04-23T18:27:46-07:00" title="2017-04-23 18:27">2017-04-23 18:27</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is an implementation of the <em>harder</em> option for Assignment 3 of coursera's <a href="https://www.coursera.org/learn/python-plotting/home/welcome">Applied Plotting, Charting &amp; Data Representation in Python</a>.</p>
<h2 id="Description">Description<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Description"></a>
</h2>
<p>A challenge that users face is that, for a given y-axis value (e.g.
42,000), it is difficult to know which x-axis values are most likely to
be representative, because the confidence levels overlap and their
distributions are different (the lengths of the confidence interval bars
are unequal). One of the solutions the authors propose for this problem
(Figure 2c) is to allow users to indicate the y-axis value of interest
(e.g. 42,000) and then draw a horizontal line and color bars based on
this value. So bars might be colored red if they are definitely above
this value (given the confidence interval), blue if they are definitely
below this value, or white if they contain this value.</p>
<p><em>Even Harder option:</em> Add interactivity to the above, which allows the
user to click on the y axis to set the value of interest. The bar colors
should change with respect to what value the user has selected.</p>
<h2 id="Imports">Imports<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Imports"></a>
</h2>
<p>All the imports were created by third-parties (taken from pypi).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Some-Plotting-Setup">Some Plotting Setup<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Some-Plotting-Setup"></a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="n">style</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">style</span><span class="p">[</span><span class="s2">"axes.grid"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Data">The Data<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#The-Data"></a>
</h2>
<p>There data set will be four normally-distributed, randomly generated data sets each representing a simulated data set for a given year.</p>
<h3 id="numpy.random.normal">
<code>numpy.random.normal</code><a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#numpy.random.normal"></a>
</h3>
<p>This is from the <code>numpy.random.normal</code> doc-string:</p>
<p><code>normal(loc=0.0, scale=1.0, size=None)</code></p>
<p>Draw random samples from a normal (Gaussian) distribution.</p>
<p>The probability density function of the normal distribution, first
derived by De Moivre and 200 years later by both Gauss and Laplace
independently [2]_, is often called the bell curve because of
its characteristic shape (see the example below).</p>
<p>The normal distributions occurs often in nature.  For example, it
describes the commonly occurring distribution of samples influenced
by a large number of tiny, random disturbances, each with its own
unique distribution.</p>
<h3 id="Parameters">Parameters<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Parameters"></a>
</h3>
<h4 id="loc-:-float-or-array_like-of-floats">
<code>loc</code> : float or array_like of floats<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#loc-:-float-or-array_like-of-floats"></a>
</h4>
<p>Mean ("centre") of the distribution.</p>
<h4 id="scale-:-float-or-array_like-of-floats">
<code>scale</code> : float or array_like of floats<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#scale-:-float-or-array_like-of-floats"></a>
</h4>
<p>Standard deviation (spread or "width") of the distribution.</p>
<h4 id="size-:-int-or-tuple-of-ints,-optional">
<code>size</code> : int or tuple of ints, optional<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#size-:-int-or-tuple-of-ints,-optional"></a>
</h4>
<p>Output shape.  If the given shape is, e.g., <code>(m, n, k)</code>, then
<code>m * n * k</code> samples are drawn.  If size is <code>None</code> (default),
a single value is returned if <code>loc</code> and <code>scale</code> are both scalars.
Otherwise, <code>np.broadcast(loc, scale).size</code> samples are drawn.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">33500</span><span class="p">,</span><span class="mi">150000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
                         <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">90000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
                         <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">120000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
                         <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">48000</span><span class="p">,</span><span class="mi">55000</span><span class="p">,</span><span class="mi">3650</span><span class="p">)],</span> 
                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1992</span><span class="p">,</span><span class="mi">1993</span><span class="p">,</span><span class="mi">1994</span><span class="p">,</span><span class="mi">1995</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead><tr style="text-align: right;">
<th></th>
      <th>1992</th>
      <th>1993</th>
      <th>1994</th>
      <th>1995</th>
    </tr></thead>
<tbody>
<tr>
<th>count</th>
      <td>3650.000000</td>
      <td>3650.000000</td>
      <td>3650.000000</td>
      <td>3650.000000</td>
    </tr>
<tr>
<th>mean</th>
      <td>34484.080607</td>
      <td>39975.673587</td>
      <td>37565.689950</td>
      <td>47798.504333</td>
    </tr>
<tr>
<th>std</th>
      <td>150473.176164</td>
      <td>88558.520583</td>
      <td>120317.078777</td>
      <td>54828.074297</td>
    </tr>
<tr>
<th>min</th>
      <td>-528303.381600</td>
      <td>-287127.421315</td>
      <td>-382709.382654</td>
      <td>-138894.685422</td>
    </tr>
<tr>
<th>25%</th>
      <td>-67555.298773</td>
      <td>-21665.471992</td>
      <td>-45516.912051</td>
      <td>11680.007981</td>
    </tr>
<tr>
<th>50%</th>
      <td>31756.198287</td>
      <td>41001.778992</td>
      <td>39197.241173</td>
      <td>49103.396625</td>
    </tr>
<tr>
<th>75%</th>
      <td>135081.379021</td>
      <td>99766.920131</td>
      <td>121367.183244</td>
      <td>84271.976610</td>
    </tr>
<tr>
<th>max</th>
      <td>622629.206119</td>
      <td>358327.854561</td>
      <td>423792.855746</td>
      <td>262363.983464</td>
    </tr>
</tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Comparing the sample to the values fed to the <code>normal</code> function it appears that even with 3,650 values, it's still not exactly what we asked for.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>





<div id="20c9ed81-0744-435e-b7c6-efd494e9de8f"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#20c9ed81-0744-435e-b7c6-efd494e9de8f');
/* Put everything inside the global mpl namespace */
window.mpl = {};


mpl.get_websocket_type = function() {
    if (typeof(WebSocket) !== 'undefined') {
        return WebSocket;
    } else if (typeof(MozWebSocket) !== 'undefined') {
        return MozWebSocket;
    } else {
        alert('Your browser does not have WebSocket support.' +
              'Please try Chrome, Safari or Firefox  6. ' +
              'Firefox 4 and 5 are also supported but you ' +
              'have to enable WebSockets in about:config.');
    };
}

mpl.figure = function(figure_id, websocket, ondownload, parent_element) {
    this.id = figure_id;

    this.ws = websocket;

    this.supports_binary = (this.ws.binaryType != undefined);

    if (!this.supports_binary) {
        var warnings = document.getElementById("mpl-warnings");
        if (warnings) {
            warnings.style.display = 'block';
            warnings.textContent = (
                "This browser does not support binary websocket messages. " +
                    "Performance may be slow.");
        }
    }

    this.imageObj = new Image();

    this.context = undefined;
    this.message = undefined;
    this.canvas = undefined;
    this.rubberband_canvas = undefined;
    this.rubberband_context = undefined;
    this.format_dropdown = undefined;

    this.image_mode = 'full';

    this.root = $('<div/>');
    this._root_extra_style(this.root)
    this.root.attr('style', 'display: inline-block');

    $(parent_element).append(this.root);

    this._init_header(this);
    this._init_canvas(this);
    this._init_toolbar(this);

    var fig = this;

    this.waiting = false;

    this.ws.onopen =  function () {
            fig.send_message("supports_binary", {value: fig.supports_binary});
            fig.send_message("send_image_mode", {});
            if (mpl.ratio != 1) {
                fig.send_message("set_dpi_ratio", {'dpi_ratio': mpl.ratio});
            }
            fig.send_message("refresh", {});
        }

    this.imageObj.onload = function() {
            if (fig.image_mode == 'full') {
                // Full images could contain transparency (where diff images
                // almost always do), so we need to clear the canvas so that
                // there is no ghosting.
                fig.context.clearRect(0, 0, fig.canvas.width, fig.canvas.height);
            }
            fig.context.drawImage(fig.imageObj, 0, 0);
        };

    this.imageObj.onunload = function() {
        this.ws.close();
    }

    this.ws.onmessage = this._make_on_message_function(this);

    this.ondownload = ondownload;
}

mpl.figure.prototype._init_header = function() {
    var titlebar = $(
        '<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ' +
        'ui-helper-clearfix"/>');
    var titletext = $(
        '<div class="ui-dialog-title" style="width: 100%; ' +
        'text-align: center; padding: 3px;"/>');
    titlebar.append(titletext)
    this.root.append(titlebar);
    this.header = titletext[0];
}



mpl.figure.prototype._canvas_extra_style = function(canvas_div) {

}


mpl.figure.prototype._root_extra_style = function(canvas_div) {

}

mpl.figure.prototype._init_canvas = function() {
    var fig = this;

    var canvas_div = $('<div/>');

    canvas_div.attr('style', 'position: relative; clear: both; outline: 0');

    function canvas_keyboard_event(event) {
        return fig.key_event(event, event['data']);
    }

    canvas_div.keydown('key_press', canvas_keyboard_event);
    canvas_div.keyup('key_release', canvas_keyboard_event);
    this.canvas_div = canvas_div
    this._canvas_extra_style(canvas_div)
    this.root.append(canvas_div);

    var canvas = $('<canvas/>');
    canvas.addClass('mpl-canvas');
    canvas.attr('style', "left: 0; top: 0; z-index: 0; outline: 0")

    this.canvas = canvas[0];
    this.context = canvas[0].getContext("2d");

    var backingStore = this.context.backingStorePixelRatio ||
	this.context.webkitBackingStorePixelRatio ||
	this.context.mozBackingStorePixelRatio ||
	this.context.msBackingStorePixelRatio ||
	this.context.oBackingStorePixelRatio ||
	this.context.backingStorePixelRatio || 1;

    mpl.ratio = (window.devicePixelRatio || 1) / backingStore;

    var rubberband = $('<canvas/>');
    rubberband.attr('style', "position: absolute; left: 0; top: 0; z-index: 1;")

    var pass_mouse_events = true;

    canvas_div.resizable({
        start: function(event, ui) {
            pass_mouse_events = false;
        },
        resize: function(event, ui) {
            fig.request_resize(ui.size.width, ui.size.height);
        },
        stop: function(event, ui) {
            pass_mouse_events = true;
            fig.request_resize(ui.size.width, ui.size.height);
        },
    });

    function mouse_event_fn(event) {
        if (pass_mouse_events)
            return fig.mouse_event(event, event['data']);
    }

    rubberband.mousedown('button_press', mouse_event_fn);
    rubberband.mouseup('button_release', mouse_event_fn);
    // Throttle sequential mouse events to 1 every 20ms.
    rubberband.mousemove('motion_notify', mouse_event_fn);

    rubberband.mouseenter('figure_enter', mouse_event_fn);
    rubberband.mouseleave('figure_leave', mouse_event_fn);

    canvas_div.on("wheel", function (event) {
        event = event.originalEvent;
        event['data'] = 'scroll'
        if (event.deltaY < 0) {
            event.step = 1;
        } else {
            event.step = -1;
        }
        mouse_event_fn(event);
    });

    canvas_div.append(canvas);
    canvas_div.append(rubberband);

    this.rubberband = rubberband;
    this.rubberband_canvas = rubberband[0];
    this.rubberband_context = rubberband[0].getContext("2d");
    this.rubberband_context.strokeStyle = "#000000";

    this._resize_canvas = function(width, height) {
        // Keep the size of the canvas, canvas container, and rubber band
        // canvas in synch.
        canvas_div.css('width', width)
        canvas_div.css('height', height)

        canvas.attr('width', width * mpl.ratio);
        canvas.attr('height', height * mpl.ratio);
        canvas.attr('style', 'width: ' + width + 'px; height: ' + height + 'px;');

        rubberband.attr('width', width);
        rubberband.attr('height', height);
    }

    // Set the figure to an initial 600x600px, this will subsequently be updated
    // upon first draw.
    this._resize_canvas(600, 600);

    // Disable right mouse context menu.
    $(this.rubberband_canvas).bind("contextmenu",function(e){
        return false;
    });

    function set_focus () {
        canvas.focus();
        canvas_div.focus();
    }

    window.setTimeout(set_focus, 100);
}

mpl.figure.prototype._init_toolbar = function() {
    var fig = this;

    var nav_element = $('<div/>')
    nav_element.attr('style', 'width: 100%');
    this.root.append(nav_element);

    // Define a callback function for later on.
    function toolbar_event(event) {
        return fig.toolbar_button_onclick(event['data']);
    }
    function toolbar_mouse_event(event) {
        return fig.toolbar_button_onmouseover(event['data']);
    }

    for(var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            // put a spacer in here.
            continue;
        }
        var button = $('<button/>');
        button.addClass('ui-button ui-widget ui-state-default ui-corner-all ' +
                        'ui-button-icon-only');
        button.attr('role', 'button');
        button.attr('aria-disabled', 'false');
        button.click(method_name, toolbar_event);
        button.mouseover(tooltip, toolbar_mouse_event);

        var icon_img = $('<span/>');
        icon_img.addClass('ui-button-icon-primary ui-icon');
        icon_img.addClass(image);
        icon_img.addClass('ui-corner-all');

        var tooltip_span = $('<span/>');
        tooltip_span.addClass('ui-button-text');
        tooltip_span.html(tooltip);

        button.append(icon_img);
        button.append(tooltip_span);

        nav_element.append(button);
    }

    var fmt_picker_span = $('<span/>');

    var fmt_picker = $('<select/>');
    fmt_picker.addClass('mpl-toolbar-option ui-widget ui-widget-content');
    fmt_picker_span.append(fmt_picker);
    nav_element.append(fmt_picker_span);
    this.format_dropdown = fmt_picker[0];

    for (var ind in mpl.extensions) {
        var fmt = mpl.extensions[ind];
        var option = $(
            '<option/>', {selected: fmt === mpl.default_extension}).html(fmt);
        fmt_picker.append(option)
    }

    // Add hover states to the ui-buttons
    $( ".ui-button" ).hover(
        function() { $(this).addClass("ui-state-hover");},
        function() { $(this).removeClass("ui-state-hover");}
    );

    var status_bar = $('<span class="mpl-message"/>');
    nav_element.append(status_bar);
    this.message = status_bar[0];
}

mpl.figure.prototype.request_resize = function(x_pixels, y_pixels) {
    // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,
    // which will in turn request a refresh of the image.
    this.send_message('resize', {'width': x_pixels, 'height': y_pixels});
}

mpl.figure.prototype.send_message = function(type, properties) {
    properties['type'] = type;
    properties['figure_id'] = this.id;
    this.ws.send(JSON.stringify(properties));
}

mpl.figure.prototype.send_draw_message = function() {
    if (!this.waiting) {
        this.waiting = true;
        this.ws.send(JSON.stringify({type: "draw", figure_id: this.id}));
    }
}


mpl.figure.prototype.handle_save = function(fig, msg) {
    var format_dropdown = fig.format_dropdown;
    var format = format_dropdown.options[format_dropdown.selectedIndex].value;
    fig.ondownload(fig, format);
}


mpl.figure.prototype.handle_resize = function(fig, msg) {
    var size = msg['size'];
    if (size[0] != fig.canvas.width || size[1] != fig.canvas.height) {
        fig._resize_canvas(size[0], size[1]);
        fig.send_message("refresh", {});
    };
}

mpl.figure.prototype.handle_rubberband = function(fig, msg) {
    var x0 = msg['x0'] / mpl.ratio;
    var y0 = (fig.canvas.height - msg['y0']) / mpl.ratio;
    var x1 = msg['x1'] / mpl.ratio;
    var y1 = (fig.canvas.height - msg['y1']) / mpl.ratio;
    x0 = Math.floor(x0) + 0.5;
    y0 = Math.floor(y0) + 0.5;
    x1 = Math.floor(x1) + 0.5;
    y1 = Math.floor(y1) + 0.5;
    var min_x = Math.min(x0, x1);
    var min_y = Math.min(y0, y1);
    var width = Math.abs(x1 - x0);
    var height = Math.abs(y1 - y0);

    fig.rubberband_context.clearRect(
        0, 0, fig.canvas.width, fig.canvas.height);

    fig.rubberband_context.strokeRect(min_x, min_y, width, height);
}

mpl.figure.prototype.handle_figure_label = function(fig, msg) {
    // Updates the figure title.
    fig.header.textContent = msg['label'];
}

mpl.figure.prototype.handle_cursor = function(fig, msg) {
    var cursor = msg['cursor'];
    switch(cursor)
    {
    case 0:
        cursor = 'pointer';
        break;
    case 1:
        cursor = 'default';
        break;
    case 2:
        cursor = 'crosshair';
        break;
    case 3:
        cursor = 'move';
        break;
    }
    fig.rubberband_canvas.style.cursor = cursor;
}

mpl.figure.prototype.handle_message = function(fig, msg) {
    fig.message.textContent = msg['message'];
}

mpl.figure.prototype.handle_draw = function(fig, msg) {
    // Request the server to send over a new figure.
    fig.send_draw_message();
}

mpl.figure.prototype.handle_image_mode = function(fig, msg) {
    fig.image_mode = msg['mode'];
}

mpl.figure.prototype.updated_canvas_event = function() {
    // Called whenever the canvas gets updated.
    this.send_message("ack", {});
}

// A function to construct a web socket function for onmessage handling.
// Called in the figure constructor.
mpl.figure.prototype._make_on_message_function = function(fig) {
    return function socket_on_message(evt) {
        if (evt.data instanceof Blob) {
            /* FIXME: We get "Resource interpreted as Image but
             * transferred with MIME type text/plain:" errors on
             * Chrome.  But how to set the MIME type?  It doesn't seem
             * to be part of the websocket stream */
            evt.data.type = "image/png";

            /* Free the memory for the previous frames */
            if (fig.imageObj.src) {
                (window.URL || window.webkitURL).revokeObjectURL(
                    fig.imageObj.src);
            }

            fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(
                evt.data);
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }
        else if (typeof evt.data === 'string' && evt.data.slice(0, 21) == "data:image/png;base64") {
            fig.imageObj.src = evt.data;
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }

        var msg = JSON.parse(evt.data);
        var msg_type = msg['type'];

        // Call the  "handle_{type}" callback, which takes
        // the figure and JSON message as its only arguments.
        try {
            var callback = fig["handle_" + msg_type];
        } catch (e) {
            console.log("No handler for the '" + msg_type + "' message type: ", msg);
            return;
        }

        if (callback) {
            try {
                // console.log("Handling '" + msg_type + "' message: ", msg);
                callback(fig, msg);
            } catch (e) {
                console.log("Exception inside the 'handler_" + msg_type + "' callback:", e, e.stack, msg);
            }
        }
    };
}

// from http://stackoverflow.com/questions/1114465/getting-mouse-location-in-canvas
mpl.findpos = function(e) {
    //this section is from http://www.quirksmode.org/js/events_properties.html
    var targ;
    if (!e)
        e = window.event;
    if (e.target)
        targ = e.target;
    else if (e.srcElement)
        targ = e.srcElement;
    if (targ.nodeType == 3) // defeat Safari bug
        targ = targ.parentNode;

    // jQuery normalizes the pageX and pageY
    // pageX,Y are the mouse positions relative to the document
    // offset() returns the position of the element relative to the document
    var x = e.pageX - $(targ).offset().left;
    var y = e.pageY - $(targ).offset().top;

    return {"x": x, "y": y};
};

/*
 * return a copy of an object with only non-object keys
 * we need this to avoid circular references
 * http://stackoverflow.com/a/24161582/3208463
 */
function simpleKeys (original) {
  return Object.keys(original).reduce(function (obj, key) {
    if (typeof original[key] !== 'object')
        obj[key] = original[key]
    return obj;
  }, {});
}

mpl.figure.prototype.mouse_event = function(event, name) {
    var canvas_pos = mpl.findpos(event)

    if (name === 'button_press')
    {
        this.canvas.focus();
        this.canvas_div.focus();
    }

    var x = canvas_pos.x * mpl.ratio;
    var y = canvas_pos.y * mpl.ratio;

    this.send_message(name, {x: x, y: y, button: event.button,
                             step: event.step,
                             guiEvent: simpleKeys(event)});

    /* This prevents the web browser from automatically changing to
     * the text insertion cursor when the button is pressed.  We want
     * to control all of the cursor setting manually through the
     * 'cursor' event from matplotlib */
    event.preventDefault();
    return false;
}

mpl.figure.prototype._key_event_extra = function(event, name) {
    // Handle any extra behaviour associated with a key event
}

mpl.figure.prototype.key_event = function(event, name) {

    // Prevent repeat events
    if (name == 'key_press')
    {
        if (event.which === this._key)
            return;
        else
            this._key = event.which;
    }
    if (name == 'key_release')
        this._key = null;

    var value = '';
    if (event.ctrlKey && event.which != 17)
        value += "ctrl+";
    if (event.altKey && event.which != 18)
        value += "alt+";
    if (event.shiftKey && event.which != 16)
        value += "shift+";

    value += 'k';
    value += event.which.toString();

    this._key_event_extra(event, name);

    this.send_message(name, {key: value,
                             guiEvent: simpleKeys(event)});
    return false;
}

mpl.figure.prototype.toolbar_button_onclick = function(name) {
    if (name == 'download') {
        this.handle_save(this, null);
    } else {
        this.send_message("toolbar_button", {name: name});
    }
};

mpl.figure.prototype.toolbar_button_onmouseover = function(tooltip) {
    this.message.textContent = tooltip;
};
mpl.toolbar_items = [["Home", "Reset original view", "fa fa-home icon-home", "home"], ["Back", "Back to  previous view", "fa fa-arrow-left icon-arrow-left", "back"], ["Forward", "Forward to next view", "fa fa-arrow-right icon-arrow-right", "forward"], ["", "", "", ""], ["Pan", "Pan axes with left mouse, zoom with right", "fa fa-arrows icon-move", "pan"], ["Zoom", "Zoom to rectangle", "fa fa-square-o icon-check-empty", "zoom"], ["", "", "", ""], ["Download", "Download plot", "fa fa-floppy-o icon-save", "download"]];

mpl.extensions = ["eps", "jpeg", "pdf", "png", "ps", "raw", "svg", "tif"];

mpl.default_extension = "png";var comm_websocket_adapter = function(comm) {
    // Create a "websocket"-like object which calls the given IPython comm
    // object with the appropriate methods. Currently this is a non binary
    // socket, so there is still some room for performance tuning.
    var ws = {};

    ws.close = function() {
        comm.close()
    };
    ws.send = function(m) {
        //console.log('sending', m);
        comm.send(m);
    };
    // Register the callback with on_msg.
    comm.on_msg(function(msg) {
        //console.log('receiving', msg['content']['data'], msg);
        // Pass the mpl event to the overriden (by mpl) onmessage function.
        ws.onmessage(msg['content']['data'])
    });
    return ws;
}

mpl.mpl_figure_comm = function(comm, msg) {
    // This is the function which gets called when the mpl process
    // starts-up an IPython Comm through the "matplotlib" channel.

    var id = msg.content.data.id;
    // Get hold of the div created by the display call when the Comm
    // socket was opened in Python.
    var element = $("#" + id);
    var ws_proxy = comm_websocket_adapter(comm)

    function ondownload(figure, format) {
        window.open(figure.imageObj.src);
    }

    var fig = new mpl.figure(id, ws_proxy,
                           ondownload,
                           element.get(0));

    // Call onopen now - mpl needs it, as it is assuming we've passed it a real
    // web socket which is closed, not our websocket->open comm proxy.
    ws_proxy.onopen();

    fig.parent_element = element.get(0);
    fig.cell_info = mpl.find_output_cell("<div id='" + id + "'></div>");
    if (!fig.cell_info) {
        console.error("Failed to find cell for figure", id, fig);
        return;
    }

    var output_index = fig.cell_info[2]
    var cell = fig.cell_info[0];

};

mpl.figure.prototype.handle_close = function(fig, msg) {
    var width = fig.canvas.width/mpl.ratio
    fig.root.unbind('remove')

    // Update the output cell to use the data from the current canvas.
    fig.push_to_output();
    var dataURL = fig.canvas.toDataURL();
    // Re-enable the keyboard manager in IPython - without this line, in FF,
    // the notebook keyboard shortcuts fail.
    IPython.keyboard_manager.enable()
    $(fig.parent_element).html('<img src="' + dataURL + '" width="' + width + '">');
    fig.close_ws(fig, msg);
}

mpl.figure.prototype.close_ws = function(fig, msg){
    fig.send_message('closing', msg);
    // fig.ws.close()
}

mpl.figure.prototype.push_to_output = function(remove_interactive) {
    // Turn the data on the canvas into data in the output cell.
    var width = this.canvas.width/mpl.ratio
    var dataURL = this.canvas.toDataURL();
    this.cell_info[1]['text/html'] = '<img src="' + dataURL + '" width="' + width + '">';
}

mpl.figure.prototype.updated_canvas_event = function() {
    // Tell IPython that the notebook contents must change.
    IPython.notebook.set_dirty(true);
    this.send_message("ack", {});
    var fig = this;
    // Wait a second, then push the new image to the DOM so
    // that it is saved nicely (might be nice to debounce this).
    setTimeout(function () { fig.push_to_output() }, 1000);
}

mpl.figure.prototype._init_toolbar = function() {
    var fig = this;

    var nav_element = $('<div/>')
    nav_element.attr('style', 'width: 100%');
    this.root.append(nav_element);

    // Define a callback function for later on.
    function toolbar_event(event) {
        return fig.toolbar_button_onclick(event['data']);
    }
    function toolbar_mouse_event(event) {
        return fig.toolbar_button_onmouseover(event['data']);
    }

    for(var toolbar_ind in mpl.toolbar_items){
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) { continue; };

        var button = $('<button class="btn btn-default" href="#" title="' + name + '"><i class="fa ' + image + ' fa-lg"></i></button>');
        button.click(method_name, toolbar_event);
        button.mouseover(tooltip, toolbar_mouse_event);
        nav_element.append(button);
    }

    // Add the status bar.
    var status_bar = $('<span class="mpl-message" style="text-align:right; float: right;"/>');
    nav_element.append(status_bar);
    this.message = status_bar[0];

    // Add the close button to the window.
    var buttongrp = $('<div class="btn-group inline pull-right"></div>');
    var button = $('<button class="btn btn-mini btn-primary" href="#" title="Stop Interaction"><i class="fa fa-power-off icon-remove icon-large"></i></button>');
    button.click(function (evt) { fig.handle_close(fig, {}); } );
    button.mouseover('Stop Interaction', toolbar_mouse_event);
    buttongrp.append(button);
    var titlebar = this.root.find($('.ui-dialog-titlebar'));
    titlebar.prepend(buttongrp);
}

mpl.figure.prototype._root_extra_style = function(el){
    var fig = this
    el.on("remove", function(){
	fig.close_ws(fig, {});
    });
}

mpl.figure.prototype._canvas_extra_style = function(el){
    // this is important to make the div 'focusable
    el.attr('tabindex', 0)
    // reach out to IPython and tell the keyboard manager to turn it's self
    // off when our div gets focus

    // location in version 3
    if (IPython.notebook.keyboard_manager) {
        IPython.notebook.keyboard_manager.register_events(el);
    }
    else {
        // location in version 2
        IPython.keyboard_manager.register_events(el);
    }

}

mpl.figure.prototype._key_event_extra = function(event, name) {
    var manager = IPython.notebook.keyboard_manager;
    if (!manager)
        manager = IPython.keyboard_manager;

    // Check for shift+enter
    if (event.shiftKey && event.which == 13) {
        this.canvas_div.blur();
        // select the cell after this one
        var index = IPython.notebook.find_cell_index(this.cell_info[0]);
        IPython.notebook.select(index + 1);
    }
}

mpl.figure.prototype.handle_save = function(fig, msg) {
    fig.ondownload(fig, null);
}


mpl.find_output_cell = function(html_output) {
    // Return the cell and output element which can be found *uniquely* in the notebook.
    // Note - this is a bit hacky, but it is done because the "notebook_saving.Notebook"
    // IPython event is triggered only after the cells have been serialised, which for
    // our purposes (turning an active figure into a static one), is too late.
    var cells = IPython.notebook.get_cells();
    var ncells = cells.length;
    for (var i=0; i<ncells; i++) {
        var cell = cells[i];
        if (cell.cell_type === 'code'){
            for (var j=0; j<cell.output_area.outputs.length; j++) {
                var data = cell.output_area.outputs[j];
                if (data.data) {
                    // IPython >= 3 moved mimebundle to data attribute of output
                    data = data.data;
                }
                if (data['text/html'] == html_output) {
                    return [cell, data, j];
                }
            }
        }
    }
}

// Register the function which deals with the matplotlib target/channel.
// The kernel may be null if the page has been refreshed.
if (IPython.notebook.kernel != null) {
    IPython.notebook.kernel.comm_manager.register_target('matplotlib', mpl.mpl_figure_comm);
}

</script>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAHgCAYAAAA10dzkAAAgAElEQVR4XuydB3RVxfbGv7npgYCgUqJIS85N6EpXOiKIiMCDp+gT5AlKUUQQEAQRBQQB8aGiFJ908UmxAAoqRZRmQHruOYkUKaGKlDSS3PmvOSn/IKTcm5Dc8s1aLC73zJ69928f4MvMmTkCbCRAAiRAAiRAAiRAAl5FQHhVtkyWBEiABEiABEiABEgAFIC8CUiABEiABEiABEjAywhQAHpZwZkuCZAACZAACZAACVAA8h4gARIgARIgARIgAS8jQAHoZQVnuiRAAiRAAiRAAiRAAch7gARIgARIgARIgAS8jAAFoJcVnOmSAAmQAAmQAAmQAAUg7wESIAESIAESIAES8DICFIBeVnCmSwIkQAIkQAIkQAIUgLwHSIAESIAESIAESMDLCFAAelnBmS4JkAAJkAAJkAAJUADyHiABEiABEiABEiABLyNAAehlBWe6JEACJEACJEACJEAByHuABEiABEiABEiABLyMAAWglxWc6ZIACZAACZAACZAABSDvARIgARIgARIgARLwMgIUgF5WcKZLAiRAAiRAAiRAAhSAvAdIgARIgARIgARIwMsIUAB6WcGZLgmQAAmQAAmQAAlQAPIeIAESIAESIAESIAEvI0AB6GUFZ7okQAIkQAIkQAIkQAHIe4AESIAESIAESIAEvIwABaCXFZzpkgAJkAAJkAAJkAAFIO8BEiABEiABEiABEvAyAhSAXlZwpksCJEACJEACJEACFIC8B0iABEiABEiABEjAywhQAHpZwZkuCZAACZAACZAACVAA8h4gARIgARIgARIgAS8jQAHoZQVnuiRAAiRAAiRAAiRAAch7gARIgARIgARIgAS8jAAFoJcVnOmSAAmQAAmQAAmQAAUg7wESIAESIAESIAES8DICFIBeVnCmSwIkQAIkQAIkQAIUgLwHSIAESIAESIAESMDLCFAAelnBmS4JkAAJkAAJkAAJUADyHiABEiABEiABEiABLyNAAehlBWe6JEACJEACJEACJEAByHuABEiABEiABEiABLyMAAWglxWc6ZIACZAACZAACZAABSDvARIgARIgARIgARLwMgIUgF5WcKZLAiRAAiRAAiRAAhSAvAdIgARIgARIgARIwMsIUAB6WcGZLgmQAAmQAAmQAAlQAPIe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hm63eyFjTKyhLAbwpKqqC3wFCW+J+AxAH8aYWDt4p6Zp33rDmVfw3wogHsA3uq7f4tut3a9fv84Wi2Uh5/xSAE4A71gslhm5ublG32iq7GYb24ETZGZmNtrHO7DprTbN+///Sc75QADCE/5GTU3N7B07dlS1Zmw42eNSqw0PcwaKolR5q2DxvooxAKqqimUhYlwO29jSmrLDjJWKB0ACkLoBESACRIAIEAEiQASijAAJwChrcDKXCBABIkAEiAARIAIkAKkPEAEiQASIABEgAkQgygiQAIyyBidziQARIAJEgAgQASJAApD6ABEgAkSACBABIkAEoowACcAoa3AylwgQASJABIgAESACJACpDxABIkAEiAARIAJEIMoIkACMsgYnc4kAESACRIAIEAEiQAKQ+gARIAJEgAgQASJABKKMAAnAKGtwMpcIEAEiQASIABEgAiQAqQ8QASJABIgAESACRCDKCJAAjLIGJ3OJABEgAkSACBABIkACkPoAESACRIAIEAEiQASijAAJwChrcDKXCBABIkAEiAARIAIkAKkPEAEiQASIABEgAkQgygiQAIyyBidziQARIAJEgAgQASJAApD6ABEgAkSACBABIkAEoowACcAoa3AylwgQASJABIgAESACJACpDxABIkAEiAARIAJEIMoIkACMsgYnc4kAESACRIAIEAEiQAKQ+gARIAJEgAgQASJABKKMAAnAKGtwMpcIEAEiQASIABEgAiQAqQ8QASJABIgAESACRCDKCJAAjLIGJ3OJABEgAkSACBABIkACkPoAESACRIAIEAEiQASijAAJwChrcDKXCBABIkAEiAARIAIkAKkPEAEiQASIABEgAkQgygiQAIyyBidziQARIAJEgAgQASJAApD6ABEgAkSACBABIkAEoowACcAoa3AylwgQASJABIgAESACJACpDxABIkAEiAARIAJEIMoIkACMsgYnc4kAESACRIAIEAEi8P8XieC+W1QqUwAAAABJRU5ErkJggg==" width="640">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>1992, the plot with the largest spread looks kind of lumpy. Their means look surprisingly close, but that's probably because the large standaard deviation distorts the scale.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>





<div id="eff9e197-d0ae-4e98-a681-a92fd1065e2c"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#eff9e197-d0ae-4e98-a681-a92fd1065e2c');
/* Put everything inside the global mpl namespace */
window.mpl = {};


mpl.get_websocket_type = function() {
    if (typeof(WebSocket) !== 'undefined') {
        return WebSocket;
    } else if (typeof(MozWebSocket) !== 'undefined') {
        return MozWebSocket;
    } else {
        alert('Your browser does not have WebSocket support.' +
              'Please try Chrome, Safari or Firefox  6. ' +
              'Firefox 4 and 5 are also supported but you ' +
              'have to enable WebSockets in about:config.');
    };
}

mpl.figure = function(figure_id, websocket, ondownload, parent_element) {
    this.id = figure_id;

    this.ws = websocket;

    this.supports_binary = (this.ws.binaryType != undefined);

    if (!this.supports_binary) {
        var warnings = document.getElementById("mpl-warnings");
        if (warnings) {
            warnings.style.display = 'block';
            warnings.textContent = (
                "This browser does not support binary websocket messages. " +
                    "Performance may be slow.");
        }
    }

    this.imageObj = new Image();

    this.context = undefined;
    this.message = undefined;
    this.canvas = undefined;
    this.rubberband_canvas = undefined;
    this.rubberband_context = undefined;
    this.format_dropdown = undefined;

    this.image_mode = 'full';

    this.root = $('<div/>');
    this._root_extra_style(this.root)
    this.root.attr('style', 'display: inline-block');

    $(parent_element).append(this.root);

    this._init_header(this);
    this._init_canvas(this);
    this._init_toolbar(this);

    var fig = this;

    this.waiting = false;

    this.ws.onopen =  function () {
            fig.send_message("supports_binary", {value: fig.supports_binary});
            fig.send_message("send_image_mode", {});
            if (mpl.ratio != 1) {
                fig.send_message("set_dpi_ratio", {'dpi_ratio': mpl.ratio});
            }
            fig.send_message("refresh", {});
        }

    this.imageObj.onload = function() {
            if (fig.image_mode == 'full') {
                // Full images could contain transparency (where diff images
                // almost always do), so we need to clear the canvas so that
                // there is no ghosting.
                fig.context.clearRect(0, 0, fig.canvas.width, fig.canvas.height);
            }
            fig.context.drawImage(fig.imageObj, 0, 0);
        };

    this.imageObj.onunload = function() {
        this.ws.close();
    }

    this.ws.onmessage = this._make_on_message_function(this);

    this.ondownload = ondownload;
}

mpl.figure.prototype._init_header = function() {
    var titlebar = $(
        '<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ' +
        'ui-helper-clearfix"/>');
    var titletext = $(
        '<div class="ui-dialog-title" style="width: 100%; ' +
        'text-align: center; padding: 3px;"/>');
    titlebar.append(titletext)
    this.root.append(titlebar);
    this.header = titletext[0];
}



mpl.figure.prototype._canvas_extra_style = function(canvas_div) {

}


mpl.figure.prototype._root_extra_style = function(canvas_div) {

}

mpl.figure.prototype._init_canvas = function() {
    var fig = this;

    var canvas_div = $('<div/>');

    canvas_div.attr('style', 'position: relative; clear: both; outline: 0');

    function canvas_keyboard_event(event) {
        return fig.key_event(event, event['data']);
    }

    canvas_div.keydown('key_press', canvas_keyboard_event);
    canvas_div.keyup('key_release', canvas_keyboard_event);
    this.canvas_div = canvas_div
    this._canvas_extra_style(canvas_div)
    this.root.append(canvas_div);

    var canvas = $('<canvas/>');
    canvas.addClass('mpl-canvas');
    canvas.attr('style', "left: 0; top: 0; z-index: 0; outline: 0")

    this.canvas = canvas[0];
    this.context = canvas[0].getContext("2d");

    var backingStore = this.context.backingStorePixelRatio ||
	this.context.webkitBackingStorePixelRatio ||
	this.context.mozBackingStorePixelRatio ||
	this.context.msBackingStorePixelRatio ||
	this.context.oBackingStorePixelRatio ||
	this.context.backingStorePixelRatio || 1;

    mpl.ratio = (window.devicePixelRatio || 1) / backingStore;

    var rubberband = $('<canvas/>');
    rubberband.attr('style', "position: absolute; left: 0; top: 0; z-index: 1;")

    var pass_mouse_events = true;

    canvas_div.resizable({
        start: function(event, ui) {
            pass_mouse_events = false;
        },
        resize: function(event, ui) {
            fig.request_resize(ui.size.width, ui.size.height);
        },
        stop: function(event, ui) {
            pass_mouse_events = true;
            fig.request_resize(ui.size.width, ui.size.height);
        },
    });

    function mouse_event_fn(event) {
        if (pass_mouse_events)
            return fig.mouse_event(event, event['data']);
    }

    rubberband.mousedown('button_press', mouse_event_fn);
    rubberband.mouseup('button_release', mouse_event_fn);
    // Throttle sequential mouse events to 1 every 20ms.
    rubberband.mousemove('motion_notify', mouse_event_fn);

    rubberband.mouseenter('figure_enter', mouse_event_fn);
    rubberband.mouseleave('figure_leave', mouse_event_fn);

    canvas_div.on("wheel", function (event) {
        event = event.originalEvent;
        event['data'] = 'scroll'
        if (event.deltaY < 0) {
            event.step = 1;
        } else {
            event.step = -1;
        }
        mouse_event_fn(event);
    });

    canvas_div.append(canvas);
    canvas_div.append(rubberband);

    this.rubberband = rubberband;
    this.rubberband_canvas = rubberband[0];
    this.rubberband_context = rubberband[0].getContext("2d");
    this.rubberband_context.strokeStyle = "#000000";

    this._resize_canvas = function(width, height) {
        // Keep the size of the canvas, canvas container, and rubber band
        // canvas in synch.
        canvas_div.css('width', width)
        canvas_div.css('height', height)

        canvas.attr('width', width * mpl.ratio);
        canvas.attr('height', height * mpl.ratio);
        canvas.attr('style', 'width: ' + width + 'px; height: ' + height + 'px;');

        rubberband.attr('width', width);
        rubberband.attr('height', height);
    }

    // Set the figure to an initial 600x600px, this will subsequently be updated
    // upon first draw.
    this._resize_canvas(600, 600);

    // Disable right mouse context menu.
    $(this.rubberband_canvas).bind("contextmenu",function(e){
        return false;
    });

    function set_focus () {
        canvas.focus();
        canvas_div.focus();
    }

    window.setTimeout(set_focus, 100);
}

mpl.figure.prototype._init_toolbar = function() {
    var fig = this;

    var nav_element = $('<div/>')
    nav_element.attr('style', 'width: 100%');
    this.root.append(nav_element);

    // Define a callback function for later on.
    function toolbar_event(event) {
        return fig.toolbar_button_onclick(event['data']);
    }
    function toolbar_mouse_event(event) {
        return fig.toolbar_button_onmouseover(event['data']);
    }

    for(var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            // put a spacer in here.
            continue;
        }
        var button = $('<button/>');
        button.addClass('ui-button ui-widget ui-state-default ui-corner-all ' +
                        'ui-button-icon-only');
        button.attr('role', 'button');
        button.attr('aria-disabled', 'false');
        button.click(method_name, toolbar_event);
        button.mouseover(tooltip, toolbar_mouse_event);

        var icon_img = $('<span/>');
        icon_img.addClass('ui-button-icon-primary ui-icon');
        icon_img.addClass(image);
        icon_img.addClass('ui-corner-all');

        var tooltip_span = $('<span/>');
        tooltip_span.addClass('ui-button-text');
        tooltip_span.html(tooltip);

        button.append(icon_img);
        button.append(tooltip_span);

        nav_element.append(button);
    }

    var fmt_picker_span = $('<span/>');

    var fmt_picker = $('<select/>');
    fmt_picker.addClass('mpl-toolbar-option ui-widget ui-widget-content');
    fmt_picker_span.append(fmt_picker);
    nav_element.append(fmt_picker_span);
    this.format_dropdown = fmt_picker[0];

    for (var ind in mpl.extensions) {
        var fmt = mpl.extensions[ind];
        var option = $(
            '<option/>', {selected: fmt === mpl.default_extension}).html(fmt);
        fmt_picker.append(option)
    }

    // Add hover states to the ui-buttons
    $( ".ui-button" ).hover(
        function() { $(this).addClass("ui-state-hover");},
        function() { $(this).removeClass("ui-state-hover");}
    );

    var status_bar = $('<span class="mpl-message"/>');
    nav_element.append(status_bar);
    this.message = status_bar[0];
}

mpl.figure.prototype.request_resize = function(x_pixels, y_pixels) {
    // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,
    // which will in turn request a refresh of the image.
    this.send_message('resize', {'width': x_pixels, 'height': y_pixels});
}

mpl.figure.prototype.send_message = function(type, properties) {
    properties['type'] = type;
    properties['figure_id'] = this.id;
    this.ws.send(JSON.stringify(properties));
}

mpl.figure.prototype.send_draw_message = function() {
    if (!this.waiting) {
        this.waiting = true;
        this.ws.send(JSON.stringify({type: "draw", figure_id: this.id}));
    }
}


mpl.figure.prototype.handle_save = function(fig, msg) {
    var format_dropdown = fig.format_dropdown;
    var format = format_dropdown.options[format_dropdown.selectedIndex].value;
    fig.ondownload(fig, format);
}


mpl.figure.prototype.handle_resize = function(fig, msg) {
    var size = msg['size'];
    if (size[0] != fig.canvas.width || size[1] != fig.canvas.height) {
        fig._resize_canvas(size[0], size[1]);
        fig.send_message("refresh", {});
    };
}

mpl.figure.prototype.handle_rubberband = function(fig, msg) {
    var x0 = msg['x0'] / mpl.ratio;
    var y0 = (fig.canvas.height - msg['y0']) / mpl.ratio;
    var x1 = msg['x1'] / mpl.ratio;
    var y1 = (fig.canvas.height - msg['y1']) / mpl.ratio;
    x0 = Math.floor(x0) + 0.5;
    y0 = Math.floor(y0) + 0.5;
    x1 = Math.floor(x1) + 0.5;
    y1 = Math.floor(y1) + 0.5;
    var min_x = Math.min(x0, x1);
    var min_y = Math.min(y0, y1);
    var width = Math.abs(x1 - x0);
    var height = Math.abs(y1 - y0);

    fig.rubberband_context.clearRect(
        0, 0, fig.canvas.width, fig.canvas.height);

    fig.rubberband_context.strokeRect(min_x, min_y, width, height);
}

mpl.figure.prototype.handle_figure_label = function(fig, msg) {
    // Updates the figure title.
    fig.header.textContent = msg['label'];
}

mpl.figure.prototype.handle_cursor = function(fig, msg) {
    var cursor = msg['cursor'];
    switch(cursor)
    {
    case 0:
        cursor = 'pointer';
        break;
    case 1:
        cursor = 'default';
        break;
    case 2:
        cursor = 'crosshair';
        break;
    case 3:
        cursor = 'move';
        break;
    }
    fig.rubberband_canvas.style.cursor = cursor;
}

mpl.figure.prototype.handle_message = function(fig, msg) {
    fig.message.textContent = msg['message'];
}

mpl.figure.prototype.handle_draw = function(fig, msg) {
    // Request the server to send over a new figure.
    fig.send_draw_message();
}

mpl.figure.prototype.handle_image_mode = function(fig, msg) {
    fig.image_mode = msg['mode'];
}

mpl.figure.prototype.updated_canvas_event = function() {
    // Called whenever the canvas gets updated.
    this.send_message("ack", {});
}

// A function to construct a web socket function for onmessage handling.
// Called in the figure constructor.
mpl.figure.prototype._make_on_message_function = function(fig) {
    return function socket_on_message(evt) {
        if (evt.data instanceof Blob) {
            /* FIXME: We get "Resource interpreted as Image but
             * transferred with MIME type text/plain:" errors on
             * Chrome.  But how to set the MIME type?  It doesn't seem
             * to be part of the websocket stream */
            evt.data.type = "image/png";

            /* Free the memory for the previous frames */
            if (fig.imageObj.src) {
                (window.URL || window.webkitURL).revokeObjectURL(
                    fig.imageObj.src);
            }

            fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(
                evt.data);
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }
        else if (typeof evt.data === 'string' && evt.data.slice(0, 21) == "data:image/png;base64") {
            fig.imageObj.src = evt.data;
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }

        var msg = JSON.parse(evt.data);
        var msg_type = msg['type'];

        // Call the  "handle_{type}" callback, which takes
        // the figure and JSON message as its only arguments.
        try {
            var callback = fig["handle_" + msg_type];
        } catch (e) {
            console.log("No handler for the '" + msg_type + "' message type: ", msg);
            return;
        }

        if (callback) {
            try {
                // console.log("Handling '" + msg_type + "' message: ", msg);
                callback(fig, msg);
            } catch (e) {
                console.log("Exception inside the 'handler_" + msg_type + "' callback:", e, e.stack, msg);
            }
        }
    };
}

// from http://stackoverflow.com/questions/1114465/getting-mouse-location-in-canvas
mpl.findpos = function(e) {
    //this section is from http://www.quirksmode.org/js/events_properties.html
    var targ;
    if (!e)
        e = window.event;
    if (e.target)
        targ = e.target;
    else if (e.srcElement)
        targ = e.srcElement;
    if (targ.nodeType == 3) // defeat Safari bug
        targ = targ.parentNode;

    // jQuery normalizes the pageX and pageY
    // pageX,Y are the mouse positions relative to the document
    // offset() returns the position of the element relative to the document
    var x = e.pageX - $(targ).offset().left;
    var y = e.pageY - $(targ).offset().top;

    return {"x": x, "y": y};
};

/*
 * return a copy of an object with only non-object keys
 * we need this to avoid circular references
 * http://stackoverflow.com/a/24161582/3208463
 */
function simpleKeys (original) {
  return Object.keys(original).reduce(function (obj, key) {
    if (typeof original[key] !== 'object')
        obj[key] = original[key]
    return obj;
  }, {});
}

mpl.figure.prototype.mouse_event = function(event, name) {
    var canvas_pos = mpl.findpos(event)

    if (name === 'button_press')
    {
        this.canvas.focus();
        this.canvas_div.focus();
    }

    var x = canvas_pos.x * mpl.ratio;
    var y = canvas_pos.y * mpl.ratio;

    this.send_message(name, {x: x, y: y, button: event.button,
                             step: event.step,
                             guiEvent: simpleKeys(event)});

    /* This prevents the web browser from automatically changing to
     * the text insertion cursor when the button is pressed.  We want
     * to control all of the cursor setting manually through the
     * 'cursor' event from matplotlib */
    event.preventDefault();
    return false;
}

mpl.figure.prototype._key_event_extra = function(event, name) {
    // Handle any extra behaviour associated with a key event
}

mpl.figure.prototype.key_event = function(event, name) {

    // Prevent repeat events
    if (name == 'key_press')
    {
        if (event.which === this._key)
            return;
        else
            this._key = event.which;
    }
    if (name == 'key_release')
        this._key = null;

    var value = '';
    if (event.ctrlKey && event.which != 17)
        value += "ctrl+";
    if (event.altKey && event.which != 18)
        value += "alt+";
    if (event.shiftKey && event.which != 16)
        value += "shift+";

    value += 'k';
    value += event.which.toString();

    this._key_event_extra(event, name);

    this.send_message(name, {key: value,
                             guiEvent: simpleKeys(event)});
    return false;
}

mpl.figure.prototype.toolbar_button_onclick = function(name) {
    if (name == 'download') {
        this.handle_save(this, null);
    } else {
        this.send_message("toolbar_button", {name: name});
    }
};

mpl.figure.prototype.toolbar_button_onmouseover = function(tooltip) {
    this.message.textContent = tooltip;
};
mpl.toolbar_items = [["Home", "Reset original view", "fa fa-home icon-home", "home"], ["Back", "Back to  previous view", "fa fa-arrow-left icon-arrow-left", "back"], ["Forward", "Forward to next view", "fa fa-arrow-right icon-arrow-right", "forward"], ["", "", "", ""], ["Pan", "Pan axes with left mouse, zoom with right", "fa fa-arrows icon-move", "pan"], ["Zoom", "Zoom to rectangle", "fa fa-square-o icon-check-empty", "zoom"], ["", "", "", ""], ["Download", "Download plot", "fa fa-floppy-o icon-save", "download"]];

mpl.extensions = ["eps", "jpeg", "pdf", "png", "ps", "raw", "svg", "tif"];

mpl.default_extension = "png";var comm_websocket_adapter = function(comm) {
    // Create a "websocket"-like object which calls the given IPython comm
    // object with the appropriate methods. Currently this is a non binary
    // socket, so there is still some room for performance tuning.
    var ws = {};

    ws.close = function() {
        comm.close()
    };
    ws.send = function(m) {
        //console.log('sending', m);
        comm.send(m);
    };
    // Register the callback with on_msg.
    comm.on_msg(function(msg) {
        //console.log('receiving', msg['content']['data'], msg);
        // Pass the mpl event to the overriden (by mpl) onmessage function.
        ws.onmessage(msg['content']['data'])
    });
    return ws;
}

mpl.mpl_figure_comm = function(comm, msg) {
    // This is the function which gets called when the mpl process
    // starts-up an IPython Comm through the "matplotlib" channel.

    var id = msg.content.data.id;
    // Get hold of the div created by the display call when the Comm
    // socket was opened in Python.
    var element = $("#" + id);
    var ws_proxy = comm_websocket_adapter(comm)

    function ondownload(figure, format) {
        window.open(figure.imageObj.src);
    }

    var fig = new mpl.figure(id, ws_proxy,
                           ondownload,
                           element.get(0));

    // Call onopen now - mpl needs it, as it is assuming we've passed it a real
    // web socket which is closed, not our websocket->open comm proxy.
    ws_proxy.onopen();

    fig.parent_element = element.get(0);
    fig.cell_info = mpl.find_output_cell("<div id='" + id + "'></div>");
    if (!fig.cell_info) {
        console.error("Failed to find cell for figure", id, fig);
        return;
    }

    var output_index = fig.cell_info[2]
    var cell = fig.cell_info[0];

};

mpl.figure.prototype.handle_close = function(fig, msg) {
    var width = fig.canvas.width/mpl.ratio
    fig.root.unbind('remove')

    // Update the output cell to use the data from the current canvas.
    fig.push_to_output();
    var dataURL = fig.canvas.toDataURL();
    // Re-enable the keyboard manager in IPython - without this line, in FF,
    // the notebook keyboard shortcuts fail.
    IPython.keyboard_manager.enable()
    $(fig.parent_element).html('<img src="' + dataURL + '" width="' + width + '">');
    fig.close_ws(fig, msg);
}

mpl.figure.prototype.close_ws = function(fig, msg){
    fig.send_message('closing', msg);
    // fig.ws.close()
}

mpl.figure.prototype.push_to_output = function(remove_interactive) {
    // Turn the data on the canvas into data in the output cell.
    var width = this.canvas.width/mpl.ratio
    var dataURL = this.canvas.toDataURL();
    this.cell_info[1]['text/html'] = '<img src="' + dataURL + '" width="' + width + '">';
}

mpl.figure.prototype.updated_canvas_event = function() {
    // Tell IPython that the notebook contents must change.
    IPython.notebook.set_dirty(true);
    this.send_message("ack", {});
    var fig = this;
    // Wait a second, then push the new image to the DOM so
    // that it is saved nicely (might be nice to debounce this).
    setTimeout(function () { fig.push_to_output() }, 1000);
}

mpl.figure.prototype._init_toolbar = function() {
    var fig = this;

    var nav_element = $('<div/>')
    nav_element.attr('style', 'width: 100%');
    this.root.append(nav_element);

    // Define a callback function for later on.
    function toolbar_event(event) {
        return fig.toolbar_button_onclick(event['data']);
    }
    function toolbar_mouse_event(event) {
        return fig.toolbar_button_onmouseover(event['data']);
    }

    for(var toolbar_ind in mpl.toolbar_items){
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) { continue; };

        var button = $('<button class="btn btn-default" href="#" title="' + name + '"><i class="fa ' + image + ' fa-lg"></i></button>');
        button.click(method_name, toolbar_event);
        button.mouseover(tooltip, toolbar_mouse_event);
        nav_element.append(button);
    }

    // Add the status bar.
    var status_bar = $('<span class="mpl-message" style="text-align:right; float: right;"/>');
    nav_element.append(status_bar);
    this.message = status_bar[0];

    // Add the close button to the window.
    var buttongrp = $('<div class="btn-group inline pull-right"></div>');
    var button = $('<button class="btn btn-mini btn-primary" href="#" title="Stop Interaction"><i class="fa fa-power-off icon-remove icon-large"></i></button>');
    button.click(function (evt) { fig.handle_close(fig, {}); } );
    button.mouseover('Stop Interaction', toolbar_mouse_event);
    buttongrp.append(button);
    var titlebar = this.root.find($('.ui-dialog-titlebar'));
    titlebar.prepend(buttongrp);
}

mpl.figure.prototype._root_extra_style = function(el){
    var fig = this
    el.on("remove", function(){
	fig.close_ws(fig, {});
    });
}

mpl.figure.prototype._canvas_extra_style = function(el){
    // this is important to make the div 'focusable
    el.attr('tabindex', 0)
    // reach out to IPython and tell the keyboard manager to turn it's self
    // off when our div gets focus

    // location in version 3
    if (IPython.notebook.keyboard_manager) {
        IPython.notebook.keyboard_manager.register_events(el);
    }
    else {
        // location in version 2
        IPython.keyboard_manager.register_events(el);
    }

}

mpl.figure.prototype._key_event_extra = function(event, name) {
    var manager = IPython.notebook.keyboard_manager;
    if (!manager)
        manager = IPython.keyboard_manager;

    // Check for shift+enter
    if (event.shiftKey && event.which == 13) {
        this.canvas_div.blur();
        // select the cell after this one
        var index = IPython.notebook.find_cell_index(this.cell_info[0]);
        IPython.notebook.select(index + 1);
    }
}

mpl.figure.prototype.handle_save = function(fig, msg) {
    fig.ondownload(fig, null);
}


mpl.find_output_cell = function(html_output) {
    // Return the cell and output element which can be found *uniquely* in the notebook.
    // Note - this is a bit hacky, but it is done because the "notebook_saving.Notebook"
    // IPython event is triggered only after the cells have been serialised, which for
    // our purposes (turning an active figure into a static one), is too late.
    var cells = IPython.notebook.get_cells();
    var ncells = cells.length;
    for (var i=0; i<ncells; i++) {
        var cell = cells[i];
        if (cell.cell_type === 'code'){
            for (var j=0; j<cell.output_area.outputs.length; j++) {
                var data = cell.output_area.outputs[j];
                if (data.data) {
                    // IPython >= 3 moved mimebundle to data attribute of output
                    data = data.data;
                }
                if (data['text/html'] == html_output) {
                    return [cell, data, j];
                }
            }
        }
    }
}

// Register the function which deals with the matplotlib target/channel.
// The kernel may be null if the page has been refreshed.
if (IPython.notebook.kernel != null) {
    IPython.notebook.kernel.comm_manager.register_target('matplotlib', mpl.mpl_figure_comm);
}

</script>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<img src="data:image/png;base64,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" width="640">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The box-plot shows once again that there centers are relatively close. But 1992 and 1994 have considerably more spread than 1993 and especially more than 1995.</p>
<h2 id="Interval-Check">Interval Check<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Interval-Check"></a>
</h2>
<p>This is the class that implements the plotting. It colors the bar-plots based on whether the value given is within a bar's confidence interval (white), below the confidence interval (blue) or above the confidence interval (red). It's set up to work with the easiest case so the <code>color_bars</code> method has to be overridden to make it work for this case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">IntervalCheck</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""colors plot based on whether a value is in range</span>
<span class="sd">    Args:</span>
<span class="sd">     data (DataFrame): frame with data of interest as columns</span>
<span class="sd">     confidence_interval (float): probability we want to exceed</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">confidence_interval</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Confidence Intervals"</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span> <span class="o">=</span> <span class="n">confidence_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bars</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="sd">"""A pyplot figure"""</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="sd">"""the current axes for self.figure"""</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""the bar-plot-objects"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">,</span> 
                                       <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bars</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""list of high and low interval tuples"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">,</span>
                                                   <span class="n">loc</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                                                   <span class="n">scale</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">sem</span><span class="p">())</span>
                               <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""the low-ends for the confidence intervals</span>
<span class="sd">        Returns:</span>
<span class="sd">         numpy.array of low-end confidence interval values</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">low</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""high-ends for the confidence intervals</span>
<span class="sd">        Returns:</span>
<span class="sd">         numpy.array of high-end values for confidence intervals</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">high</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">means</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""the means of the data-arrays"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""The size of the errors, rather than the ci values"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span>

    <span class="k">def</span> <span class="nf">print_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""print org-mode formatted table of the confidence intervals"""</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">column</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                                      <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)},</span>
                                     <span class="n">index</span><span class="o">=</span><span class="s2">"low high"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="c1"># not supported</span>
            <span class="k">pass</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">draw_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">"""draws the horizontal line and value"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_label</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">"</span><span class="si">{0:.2f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">horizontal_line</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> 
                                                    <span class="n">axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
                                                    <span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_label</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                          <span class="n">value</span><span class="p">,</span>
                                          <span class="s2">"</span><span class="si">{0:.2f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                                          <span class="n">axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">"facecolor"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">,</span> <span class="s2">"boxstyle"</span><span class="p">:</span> <span class="s2">"round"</span><span class="p">})</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">setup_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">"""sets up the horizontal line, value and bars</span>
<span class="sd">        Args:</span>
<span class="sd">         value (float): value to compare to distributions</span>
<span class="sd">        """</span>
        <span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">x_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">color_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">"""colors the bars based on the value</span>
<span class="sd">        this is the easiest case</span>
<span class="sd">        Args:</span>
<span class="sd">         value (float): value to compare to the distribution</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'crimson'</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'w'</span><span class="p">)</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
        <span class="k">return</span>

        
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">"""plots the data and value</span>
<span class="sd">        * blue bar if value above c.i.</span>
<span class="sd">        * white bar if value in c.i.</span>
<span class="sd">        * red bar if value is below c.i.</span>

<span class="sd">        Args:</span>
<span class="sd">         value (float): what to compare to the data</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_bars</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color_bars</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Harder">Harder<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Harder"></a>
</h2>
<p>This is the class that implements the harder coloring scheme were a gradient is used instead of just three colors.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Harder</span><span class="p">(</span><span class="n">IntervalCheck</span><span class="p">):</span>
    <span class="sd">"""implements the harder problem</span>
<span class="sd">    Uses a gradient instead of just 3 colors</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Harder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""array of rgb color triples"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># could have been done with straight fractions</span>
            <span class="c1"># but I find it easier to think in terms of</span>
            <span class="c1"># 0..255</span>
            <span class="n">base</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">51</span><span class="p">))</span>
            <span class="n">full</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span>
            <span class="n">blue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">full</span><span class="p">)</span>
            <span class="n">blue</span> <span class="o">=</span> <span class="n">blue</span><span class="o">/</span><span class="mi">255</span>
            <span class="n">base</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">red</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">full</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span>
            <span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="o">/</span><span class="mi">255</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:]</span>
            <span class="n">base</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">green</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">proportions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""array of upper limits for the value to find the matching color</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span>

    <span class="k">def</span> <span class="nf">color_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">"""colors the bars based on the value</span>
<span class="sd">        this is the harder case</span>
<span class="sd">        Args:</span>
<span class="sd">         value (float): value to compare to the distribution</span>
<span class="sd">        """</span>
        <span class="n">mapped_values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">value</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">mapped_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mapped_values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mapped_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">mapped_value</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">p_index</span><span class="p">,</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportions</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mapped_value</span> <span class="o">&lt;=</span> <span class="n">proportion</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">p_index</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">return</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Even-Harder">Even Harder<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Even-Harder"></a>
</h2>
<p>This is the class that adds interactivity to the Harder case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">EvenHarder</span><span class="p">(</span><span class="n">Harder</span><span class="p">):</span>
    <span class="sd">"""the interactive version of Harder"""</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""pyplot figure</span>
<span class="sd">        As a side-effect registers on_click with the canvas</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">"button_press_event"</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span>
    
    <span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""event-handler to update the plot"""</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_value</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color_bars</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""add a default value since this is interactive"""</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EvenHarder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Examples">Examples<a class="anchor-link" href="posts/plotting-with-uncertainty-part-iii/#Examples"></a>
</h2>
<p>First, I'll take a look at the values for the confidence intervals so that I can find values to plot. Here are the confidence intervals for the data I created.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plotter</span> <span class="o">=</span> <span class="n">EvenHarder</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">print_intervals</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here's a value that is below all the confidence intervals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">42000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>





<div id="8af8e5aa-443b-4e20-ba29-64b5f3a79fd1"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#8af8e5aa-443b-4e20-ba29-64b5f3a79fd1');
/* Put everything inside the global mpl namespace */
window.mpl = {};


mpl.get_websocket_type = function() {
    if (typeof(WebSocket) !== 'undefined') {
        return WebSocket;
    } else if (typeof(MozWebSocket) !== 'undefined') {
        return MozWebSocket;
    } else {
        alert('Your browser does not have WebSocket support.' +
              'Please try Chrome, Safari or Firefox  6. ' +
              'Firefox 4 and 5 are also supported but you ' +
              'have to enable WebSockets in about:config.');
    };
}

mpl.figure = function(figure_id, websocket, ondownload, parent_element) {
    this.id = figure_id;

    this.ws = websocket;

    this.supports_binary = (this.ws.binaryType != undefined);

    if (!this.supports_binary) {
        var warnings = document.getElementById("mpl-warnings");
        if (warnings) {
            warnings.style.display = 'block';
            warnings.textContent = (
                "This browser does not support binary websocket messages. " +
                    "Performance may be slow.");
        }
    }

    this.imageObj = new Image();

    this.context = undefined;
    this.message = undefined;
    this.canvas = undefined;
    this.rubberband_canvas = undefined;
    this.rubberband_context = undefined;
    this.format_dropdown = undefined;

    this.image_mode = 'full';

    this.root = $('<div/>');
    this._root_extra_style(this.root)
    this.root.attr('style', 'display: inline-block');

    $(parent_element).append(this.root);

    this._init_header(this);
    this._init_canvas(this);
    this._init_toolbar(this);

    var fig = this;

    this.waiting = false;

    this.ws.onopen =  function () {
            fig.send_message("supports_binary", {value: fig.supports_binary});
            fig.send_message("send_image_mode", {});
            if (mpl.ratio != 1) {
                fig.send_message("set_dpi_ratio", {'dpi_ratio': mpl.ratio});
            }
            fig.send_message("refresh", {});
        }

    this.imageObj.onload = function() {
            if (fig.image_mode == 'full') {
                // Full images could contain transparency (where diff images
                // almost always do), so we need to clear the canvas so that
                // there is no ghosting.
                fig.context.clearRect(0, 0, fig.canvas.width, fig.canvas.height);
            }
            fig.context.drawImage(fig.imageObj, 0, 0);
        };

    this.imageObj.onunload = function() {
        this.ws.close();
    }

    this.ws.onmessage = this._make_on_message_function(this);

    this.ondownload = ondownload;
}

mpl.figure.prototype._init_header = function() {
    var titlebar = $(
        '<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ' +
        'ui-helper-clearfix"/>');
    var titletext = $(
        '<div class="ui-dialog-title" style="width: 100%; ' +
        'text-align: center; padding: 3px;"/>');
    titlebar.append(titletext)
    this.root.append(titlebar);
    this.header = titletext[0];
}



mpl.figure.prototype._canvas_extra_style = function(canvas_div) {

}


mpl.figure.prototype._root_extra_style = function(canvas_div) {

}

mpl.figure.prototype._init_canvas = function() {
    var fig = this;

    var canvas_div = $('<div/>');

    canvas_div.attr('style', 'position: relative; clear: both; outline: 0');

    function canvas_keyboard_event(event) {
        return fig.key_event(event, event['data']);
    }

    canvas_div.keydown('key_press', canvas_keyboard_event);
    canvas_div.keyup('key_release', canvas_keyboard_event);
    this.canvas_div = canvas_div
    this._canvas_extra_style(canvas_div)
    this.root.append(canvas_div);

    var canvas = $('<canvas/>');
    canvas.addClass('mpl-canvas');
    canvas.attr('style', "left: 0; top: 0; z-index: 0; outline: 0")

    this.canvas = canvas[0];
    this.context = canvas[0].getContext("2d");

    var backingStore = this.context.backingStorePixelRatio ||
	this.context.webkitBackingStorePixelRatio ||
	this.context.mozBackingStorePixelRatio ||
	this.context.msBackingStorePixelRatio ||
	this.context.oBackingStorePixelRatio ||
	this.context.backingStorePixelRatio || 1;

    mpl.ratio = (window.devicePixelRatio || 1) / backingStore;

    var rubberband = $('<canvas/>');
    rubberband.attr('style', "position: absolute; left: 0; top: 0; z-index: 1;")

    var pass_mouse_events = true;

    canvas_div.resizable({
        start: function(event, ui) {
            pass_mouse_events = false;
        },
        resize: function(event, ui) {
            fig.request_resize(ui.size.width, ui.size.height);
        },
        stop: function(event, ui) {
            pass_mouse_events = true;
            fig.request_resize(ui.size.width, ui.size.height);
        },
    });

    function mouse_event_fn(event) {
        if (pass_mouse_events)
            return fig.mouse_event(event, event['data']);
    }

    rubberband.mousedown('button_press', mouse_event_fn);
    rubberband.mouseup('button_release', mouse_event_fn);
    // Throttle sequential mouse events to 1 every 20ms.
    rubberband.mousemove('motion_notify', mouse_event_fn);

    rubberband.mouseenter('figure_enter', mouse_event_fn);
    rubberband.mouseleave('figure_leave', mouse_event_fn);

    canvas_div.on("wheel", function (event) {
        event = event.originalEvent;
        event['data'] = 'scroll'
        if (event.deltaY < 0) {
            event.step = 1;
        } else {
            event.step = -1;
        }
        mouse_event_fn(event);
    });

    canvas_div.append(canvas);
    canvas_div.append(rubberband);

    this.rubberband = rubberband;
    this.rubberband_canvas = rubberband[0];
    this.rubberband_context = rubberband[0].getContext("2d");
    this.rubberband_context.strokeStyle = "#000000";

    this._resize_canvas = function(width, height) {
        // Keep the size of the canvas, canvas container, and rubber band
        // canvas in synch.
        canvas_div.css('width', width)
        canvas_div.css('height', height)

        canvas.attr('width', width * mpl.ratio);
        canvas.attr('height', height * mpl.ratio);
        canvas.attr('style', 'width: ' + width + 'px; height: ' + height + 'px;');

        rubberband.attr('width', width);
        rubberband.attr('height', height);
    }

    // Set the figure to an initial 600x600px, this will subsequently be updated
    // upon first draw.
    this._resize_canvas(600, 600);

    // Disable right mouse context menu.
    $(this.rubberband_canvas).bind("contextmenu",function(e){
        return false;
    });

    function set_focus () {
        canvas.focus();
        canvas_div.focus();
    }

    window.setTimeout(set_focus, 100);
}

mpl.figure.prototype._init_toolbar = function() {
    var fig = this;

    var nav_element = $('<div/>')
    nav_element.attr('style', 'width: 100%');
    this.root.append(nav_element);

    // Define a callback function for later on.
    function toolbar_event(event) {
        return fig.toolbar_button_onclick(event['data']);
    }
    function toolbar_mouse_event(event) {
        return fig.toolbar_button_onmouseover(event['data']);
    }

    for(var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            // put a spacer in here.
            continue;
        }
        var button = $('<button/>');
        button.addClass('ui-button ui-widget ui-state-default ui-corner-all ' +
                        'ui-button-icon-only');
        button.attr('role', 'button');
        button.attr('aria-disabled', 'false');
        button.click(method_name, toolbar_event);
        button.mouseover(tooltip, toolbar_mouse_event);

        var icon_img = $('<span/>');
        icon_img.addClass('ui-button-icon-primary ui-icon');
        icon_img.addClass(image);
        icon_img.addClass('ui-corner-all');

        var tooltip_span = $('<span/>');
        tooltip_span.addClass('ui-button-text');
        tooltip_span.html(tooltip);

        button.append(icon_img);
        button.append(tooltip_span);

        nav_element.append(button);
    }

    var fmt_picker_span = $('<span/>');

    var fmt_picker = $('<select/>');
    fmt_picker.addClass('mpl-toolbar-option ui-widget ui-widget-content');
    fmt_picker_span.append(fmt_picker);
    nav_element.append(fmt_picker_span);
    this.format_dropdown = fmt_picker[0];

    for (var ind in mpl.extensions) {
        var fmt = mpl.extensions[ind];
        var option = $(
            '<option/>', {selected: fmt === mpl.default_extension}).html(fmt);
        fmt_picker.append(option)
    }

    // Add hover states to the ui-buttons
    $( ".ui-button" ).hover(
        function() { $(this).addClass("ui-state-hover");},
        function() { $(this).removeClass("ui-state-hover");}
    );

    var status_bar = $('<span class="mpl-message"/>');
    nav_element.append(status_bar);
    this.message = status_bar[0];
}

mpl.figure.prototype.request_resize = function(x_pixels, y_pixels) {
    // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,
    // which will in turn request a refresh of the image.
    this.send_message('resize', {'width': x_pixels, 'height': y_pixels});
}

mpl.figure.prototype.send_message = function(type, properties) {
    properties['type'] = type;
    properties['figure_id'] = this.id;
    this.ws.send(JSON.stringify(properties));
}

mpl.figure.prototype.send_draw_message = function() {
    if (!this.waiting) {
        this.waiting = true;
        this.ws.send(JSON.stringify({type: "draw", figure_id: this.id}));
    }
}


mpl.figure.prototype.handle_save = function(fig, msg) {
    var format_dropdown = fig.format_dropdown;
    var format = format_dropdown.options[format_dropdown.selectedIndex].value;
    fig.ondownload(fig, format);
}


mpl.figure.prototype.handle_resize = function(fig, msg) {
    var size = msg['size'];
    if (size[0] != fig.canvas.width || size[1] != fig.canvas.height) {
        fig._resize_canvas(size[0], size[1]);
        fig.send_message("refresh", {});
    };
}

mpl.figure.prototype.handle_rubberband = function(fig, msg) {
    var x0 = msg['x0'] / mpl.ratio;
    var y0 = (fig.canvas.height - msg['y0']) / mpl.ratio;
    var x1 = msg['x1'] / mpl.ratio;
    var y1 = (fig.canvas.height - msg['y1']) / mpl.ratio;
    x0 = Math.floor(x0) + 0.5;
    y0 = Math.floor(y0) + 0.5;
    x1 = Math.floor(x1) + 0.5;
    y1 = Math.floor(y1) + 0.5;
    var min_x = Math.min(x0, x1);
    var min_y = Math.min(y0, y1);
    var width = Math.abs(x1 - x0);
    var height = Math.abs(y1 - y0);

    fig.rubberband_context.clearRect(
        0, 0, fig.canvas.width, fig.canvas.height);

    fig.rubberband_context.strokeRect(min_x, min_y, width, height);
}

mpl.figure.prototype.handle_figure_label = function(fig, msg) {
    // Updates the figure title.
    fig.header.textContent = msg['label'];
}

mpl.figure.prototype.handle_cursor = function(fig, msg) {
    var cursor = msg['cursor'];
    switch(cursor)
    {
    case 0:
        cursor = 'pointer';
        break;
    case 1:
        cursor = 'default';
        break;
    case 2:
        cursor = 'crosshair';
        break;
    case 3:
        cursor = 'move';
        break;
    }
    fig.rubberband_canvas.style.cursor = cursor;
}

mpl.figure.prototype.handle_message = function(fig, msg) {
    fig.message.textContent = msg['message'];
}

mpl.figure.prototype.handle_draw = function(fig, msg) {
    // Request the server to send over a new figure.
    fig.send_draw_message();
}

mpl.figure.prototype.handle_image_mode = function(fig, msg) {
    fig.image_mode = msg['mode'];
}

mpl.figure.prototype.updated_canvas_event = function() {
    // Called whenever the canvas gets updated.
    this.send_message("ack", {});
}

// A function to construct a web socket function for onmessage handling.
// Called in the figure constructor.
mpl.figure.prototype._make_on_message_function = function(fig) {
    return function socket_on_message(evt) {
        if (evt.data instanceof Blob) {
            /* FIXME: We get "Resource interpreted as Image but
             * transferred with MIME type text/plain:" errors on
             * Chrome.  But how to set the MIME type?  It doesn't seem
             * to be part of the websocket stream */
            evt.data.type = "image/png";

            /* Free the memory for the previous frames */
            if (fig.imageObj.src) {
                (window.URL || window.webkitURL).revokeObjectURL(
                    fig.imageObj.src);
            }

            fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(
                evt.data);
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }
        else if (typeof evt.data === 'string' && evt.data.slice(0, 21) == "data:image/png;base64") {
            fig.imageObj.src = evt.data;
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }

        var msg = JSON.parse(evt.data);
        var msg_type = msg['type'];

        // Call the  "handle_{type}" callback, which takes
        // the figure and JSON message as its only arguments.
        try {
            var callback = fig["handle_" + msg_type];
        } catch (e) {
            console.log("No handler for the '" + msg_type + "' message type: ", msg);
            return;
        }

        if (callback) {
            try {
                // console.log("Handling '" + msg_type + "' message: ", msg);
                callback(fig, msg);
            } catch (e) {
                console.log("Exception inside the 'handler_" + msg_type + "' callback:", e, e.stack, msg);
            }
        }
    };
}

// from http://stackoverflow.com/questions/1114465/getting-mouse-location-in-canvas
mpl.findpos = function(e) {
    //this section is from http://www.quirksmode.org/js/events_properties.html
    var targ;
    if (!e)
        e = window.event;
    if (e.target)
        targ = e.target;
    else if (e.srcElement)
        targ = e.srcElement;
    if (targ.nodeType == 3) // defeat Safari bug
        targ = targ.parentNode;

    // jQuery normalizes the pageX and pageY
    // pageX,Y are the mouse positions relative to the document
    // offset() returns the position of the element relative to the document
    var x = e.pageX - $(targ).offset().left;
    var y = e.pageY - $(targ).offset().top;

    return {"x": x, "y": y};
};

/*
 * return a copy of an object with only non-object keys
 * we need this to avoid circular references
 * http://stackoverflow.com/a/24161582/3208463
 */
function simpleKeys (original) {
  return Object.keys(original).reduce(function (obj, key) {
    if (typeof original[key] !== 'object')
        obj[key] = original[key]
    return obj;
  }, {});
}

mpl.figure.prototype.mouse_event = function(event, name) {
    var canvas_pos = mpl.findpos(event)

    if (name === 'button_press')
    {
        this.canvas.focus();
        this.canvas_div.focus();
    }

    var x = canvas_pos.x * mpl.ratio;
    var y = canvas_pos.y * mpl.ratio;

    this.send_message(name, {x: x, y: y, button: event.button,
                             step: event.step,
                             guiEvent: simpleKeys(event)});

    /* This prevents the web browser from automatically changing to
     * the text insertion cursor when the button is pressed.  We want
     * to control all of the cursor setting manually through the
     * 'cursor' event from matplotlib */
    event.preventDefault();
    return false;
}

mpl.figure.prototype._key_event_extra = function(event, name) {
    // Handle any extra behaviour associated with a key event
}

mpl.figure.prototype.key_event = function(event, name) {

    // Prevent repeat events
    if (name == 'key_press')
    {
        if (event.which === this._key)
            return;
        else
            this._key = event.which;
    }
    if (name == 'key_release')
        this._key = null;

    var value = '';
    if (event.ctrlKey && event.which != 17)
        value += "ctrl+";
    if (event.altKey && event.which != 18)
        value += "alt+";
    if (event.shiftKey && event.which != 16)
        value += "shift+";

    value += 'k';
    value += event.which.toString();

    this._key_event_extra(event, name);

    this.send_message(name, {key: value,
                             guiEvent: simpleKeys(event)});
    return false;
}

mpl.figure.prototype.toolbar_button_onclick = function(name) {
    if (name == 'download') {
        this.handle_save(this, null);
    } else {
        this.send_message("toolbar_button", {name: name});
    }
};

mpl.figure.prototype.toolbar_button_onmouseover = function(tooltip) {
    this.message.textContent = tooltip;
};
mpl.toolbar_items = [["Home", "Reset original view", "fa fa-home icon-home", "home"], ["Back", "Back to  previous view", "fa fa-arrow-left icon-arrow-left", "back"], ["Forward", "Forward to next view", "fa fa-arrow-right icon-arrow-right", "forward"], ["", "", "", ""], ["Pan", "Pan axes with left mouse, zoom with right", "fa fa-arrows icon-move", "pan"], ["Zoom", "Zoom to rectangle", "fa fa-square-o icon-check-empty", "zoom"], ["", "", "", ""], ["Download", "Download plot", "fa fa-floppy-o icon-save", "download"]];

mpl.extensions = ["eps", "jpeg", "pdf", "png", "ps", "raw", "svg", "tif"];

mpl.default_extension = "png";var comm_websocket_adapter = function(comm) {
    // Create a "websocket"-like object which calls the given IPython comm
    // object with the appropriate methods. Currently this is a non binary
    // socket, so there is still some room for performance tuning.
    var ws = {};

    ws.close = function() {
        comm.close()
    };
    ws.send = function(m) {
        //console.log('sending', m);
        comm.send(m);
    };
    // Register the callback with on_msg.
    comm.on_msg(function(msg) {
        //console.log('receiving', msg['content']['data'], msg);
        // Pass the mpl event to the overriden (by mpl) onmessage function.
        ws.onmessage(msg['content']['data'])
    });
    return ws;
}

mpl.mpl_figure_comm = function(comm, msg) {
    // This is the function which gets called when the mpl process
    // starts-up an IPython Comm through the "matplotlib" channel.

    var id = msg.content.data.id;
    // Get hold of the div created by the display call when the Comm
    // socket was opened in Python.
    var element = $("#" + id);
    var ws_proxy = comm_websocket_adapter(comm)

    function ondownload(figure, format) {
        window.open(figure.imageObj.src);
    }

    var fig = new mpl.figure(id, ws_proxy,
                           ondownload,
                           element.get(0));

    // Call onopen now - mpl needs it, as it is assuming we've passed it a real
    // web socket which is closed, not our websocket->open comm proxy.
    ws_proxy.onopen();

    fig.parent_element = element.get(0);
    fig.cell_info = mpl.find_output_cell("<div id='" + id + "'></div>");
    if (!fig.cell_info) {
        console.error("Failed to find cell for figure", id, fig);
        return;
    }

    var output_index = fig.cell_info[2]
    var cell = fig.cell_info[0];

};

mpl.figure.prototype.handle_close = function(fig, msg) {
    var width = fig.canvas.width/mpl.ratio
    fig.root.unbind('remove')

    // Update the output cell to use the data from the current canvas.
    fig.push_to_output();
    var dataURL = fig.canvas.toDataURL();
    // Re-enable the keyboard manager in IPython - without this line, in FF,
    // the notebook keyboard shortcuts fail.
    IPython.keyboard_manager.enable()
    $(fig.parent_element).html('<img src="' + dataURL + '" width="' + width + '">');
    fig.close_ws(fig, msg);
}

mpl.figure.prototype.close_ws = function(fig, msg){
    fig.send_message('closing', msg);
    // fig.ws.close()
}

mpl.figure.prototype.push_to_output = function(remove_interactive) {
    // Turn the data on the canvas into data in the output cell.
    var width = this.canvas.width/mpl.ratio
    var dataURL = this.canvas.toDataURL();
    this.cell_info[1]['text/html'] = '<img src="' + dataURL + '" width="' + width + '">';
}

mpl.figure.prototype.updated_canvas_event = function() {
    // Tell IPython that the notebook contents must change.
    IPython.notebook.set_dirty(true);
    this.send_message("ack", {});
    var fig = this;
    // Wait a second, then push the new image to the DOM so
    // that it is saved nicely (might be nice to debounce this).
    setTimeout(function () { fig.push_to_output() }, 1000);
}

mpl.figure.prototype._init_toolbar = function() {
    var fig = this;

    var nav_element = $('<div/>')
    nav_element.attr('style', 'width: 100%');
    this.root.append(nav_element);

    // Define a callback function for later on.
    function toolbar_event(event) {
        return fig.toolbar_button_onclick(event['data']);
    }
    function toolbar_mouse_event(event) {
        return fig.toolbar_button_onmouseover(event['data']);
    }

    for(var toolbar_ind in mpl.toolbar_items){
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) { continue; };

        var button = $('<button class="btn btn-default" href="#" title="' + name + '"><i class="fa ' + image + ' fa-lg"></i></button>');
        button.click(method_name, toolbar_event);
        button.mouseover(tooltip, toolbar_mouse_event);
        nav_element.append(button);
    }

    // Add the status bar.
    var status_bar = $('<span class="mpl-message" style="text-align:right; float: right;"/>');
    nav_element.append(status_bar);
    this.message = status_bar[0];

    // Add the close button to the window.
    var buttongrp = $('<div class="btn-group inline pull-right"></div>');
    var button = $('<button class="btn btn-mini btn-primary" href="#" title="Stop Interaction"><i class="fa fa-power-off icon-remove icon-large"></i></button>');
    button.click(function (evt) { fig.handle_close(fig, {}); } );
    button.mouseover('Stop Interaction', toolbar_mouse_event);
    buttongrp.append(button);
    var titlebar = this.root.find($('.ui-dialog-titlebar'));
    titlebar.prepend(buttongrp);
}

mpl.figure.prototype._root_extra_style = function(el){
    var fig = this
    el.on("remove", function(){
	fig.close_ws(fig, {});
    });
}

mpl.figure.prototype._canvas_extra_style = function(el){
    // this is important to make the div 'focusable
    el.attr('tabindex', 0)
    // reach out to IPython and tell the keyboard manager to turn it's self
    // off when our div gets focus

    // location in version 3
    if (IPython.notebook.keyboard_manager) {
        IPython.notebook.keyboard_manager.register_events(el);
    }
    else {
        // location in version 2
        IPython.keyboard_manager.register_events(el);
    }

}

mpl.figure.prototype._key_event_extra = function(event, name) {
    var manager = IPython.notebook.keyboard_manager;
    if (!manager)
        manager = IPython.keyboard_manager;

    // Check for shift+enter
    if (event.shiftKey && event.which == 13) {
        this.canvas_div.blur();
        // select the cell after this one
        var index = IPython.notebook.find_cell_index(this.cell_info[0]);
        IPython.notebook.select(index + 1);
    }
}

mpl.figure.prototype.handle_save = function(fig, msg) {
    fig.ondownload(fig, null);
}


mpl.find_output_cell = function(html_output) {
    // Return the cell and output element which can be found *uniquely* in the notebook.
    // Note - this is a bit hacky, but it is done because the "notebook_saving.Notebook"
    // IPython event is triggered only after the cells have been serialised, which for
    // our purposes (turning an active figure into a static one), is too late.
    var cells = IPython.notebook.get_cells();
    var ncells = cells.length;
    for (var i=0; i<ncells; i++) {
        var cell = cells[i];
        if (cell.cell_type === 'code'){
            for (var j=0; j<cell.output_area.outputs.length; j++) {
                var data = cell.output_area.outputs[j];
                if (data.data) {
                    // IPython >= 3 moved mimebundle to data attribute of output
                    data = data.data;
                }
                if (data['text/html'] == html_output) {
                    return [cell, data, j];
                }
            }
        }
    }
}

// Register the function which deals with the matplotlib target/channel.
// The kernel may be null if the page has been refreshed.
if (IPython.notebook.kernel != null) {
    IPython.notebook.kernel.comm_manager.register_target('matplotlib', mpl.mpl_figure_comm);
}

</script>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea ">
<img src="data:image/png;base64,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VGOPAAagRQD/F97HPvYxOemkk+Sxj31sANHeDf33f/93+eMf/ygvetGLevckZjhyBPBRW1pObCYCCOBMhPS2I4BqbBHAALQI4APwNmzYID/96U/lVa96VQDN3g8977zz5LTTTuv9E9nJGSCAj9rScmIzEUAAZyKktx0BVGOLAAagRQAfgPeNb3yj8YLgBQsWBNDs/VB/C/wd73hH758IAviorSEn1iEBBLBDcF0IQwC7AHHHKRDAALQI4APwLr/8cnnpS18q8+bNC6DZ+6EXX3yxvO1tb5MkSXr/ZHZwBlwBfFSWVahrC3VFAFuApLQLAqgEVgQBDECLAP6vAB5zzDGy++67P4ymf0DiH/7hH2TVqlUyODgohx56qLzvfe+TvfbaS66++mr59Kc/LevXr5c/+ZM/kbPOOkue9axnNXL4h0o+/vGPy7/927/Jxo0b5YADDpC/+Zu/kWc84xkPrvG1r31NvHT5BzGyLJMPfvCDsnTpUrn99tvlz//8z2VgYOAhx+Nvz775zW/eYcXvvfdeefe73y3/8R//ITfffHPjWJs//jt+frv/+bNPfvKTO8xxySWXyFvf+lYEMOBvitBdTwABbIE5AtgCJKVdEEAlsAhgEFgE8JEFcHx8XI488kh57WtfK295y1saInfqqac2rhS+8Y1vbPzPf2/uz/7sz8QL1plnninf+c53GreSvfx5Gbv00kvlCU94gnz1q19t/Lsf/ehH8vjHP16uu+46+du//Vu56KKLZPHixfKFL3xBRkZGGk8iTwtgnuct1dfv56/cHXzwwQ0p3V4AP/OZz8hVV10le+65pzzxiU9EAPkt4Jb6qld2QgBbqBQC2AIkpV0QQCWwCGAQWATwkQXQPxX7gx/8QPzVwb6+vsbO/nbxFVdc0bhCNzo6KpdddtmDNfBy6K/geRl7wxve0HidzBlnnNHYvm3bNnnyk58sX/rSl2T58uXyute9To466ih505ve9LAatiuAv/zlLxtX/CYmJuT1r3/9wwTQH7M/h49+9KON4+AKoMiKFSsaV0P59D4BBLCFGiKALUBS2gUBVAKLAAaBRQAfWQC3h7t27Vp55zvfKUcccYT4q4P+9vA///M/P7jb3/3d38l9993XuCroxfBf/uVfGreI99lnn8YVOH+L9fvf/35D1p761KfKu971LvnXf/1X+e1vf9uQww99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" width="640">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
    </div>
  </div>

    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/plotting-with-uncertainty-part-ii/" class="u-url">Plotting With Uncertainty (Part II)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/plotting-with-uncertainty-part-ii/" rel="bookmark"><time class="published dt-published" datetime="2017-04-22T14:12:41-08:00" title="2017-04-22 14:12">2017-04-22 14:12</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
This is an implementation of the <i>harder</i> option for Assignment 3 of coursera's <a href="https://www.coursera.org/learn/python-plotting/home/welcome">Applied Plotting, Charting &amp; Data Representation in Python</a>.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Description</h2>
<div class="outline-text-2" id="text-1">
<p>
A challenge that users face is that, for a given y-axis value (e.g.
42,000), it is difficult to know which x-axis values are most likely to
be representative, because the confidence levels overlap and their
distributions are different (the lengths of the confidence interval bars
are unequal). One of the solutions the authors propose for this problem
(Figure 2c) is to allow users to indicate the y-axis value of interest
(e.g. 42,000) and then draw a horizontal line and color bars based on
this value. So bars might be colored red if they are definitely above
this value (given the confidence interval), blue if they are definitely
below this value, or white if they contain this value.
</p>

<p>
<b>Harder option:</b> Implement the bar coloring as described in the paper,
where the color of the bar is actually based on the amount of data
covered (e.g. a gradient ranging from dark blue for the distribution
being certainly below this y-axis, to white if the value is certainly
contained, to dark red if the value is certainly not contained as the
distribution is above the axis).
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Imports</h2>
<div class="outline-text-2" id="text-2">
<p>
All the imports were created by third-parties (taken from pypi).
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Some Plotting Setup</h3>
<div class="outline-text-3" id="text-2-1">
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">style</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">style</span><span class="p">[</span><span class="s2">"axes.grid"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">The Data</h2>
<div class="outline-text-2" id="text-3">
<p>
There data set will be four normally-distributed, randomly generated data sets each representing a simulated data set for a given year.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><code>numpy.random.normal</code></h3>
<div class="outline-text-3" id="text-3-1">
<p>
This is from the <code>numpy.random.normal</code> doc-string:
</p>

<p>
<code>normal(loc=0.0, scale=1.0, size=None)</code>
</p>

<p>
Draw random samples from a normal (Gaussian) distribution.
</p>

<p>
The probability density function of the normal distribution, first
derived by De Moivre and 200 years later by both Gauss and Laplace
independently <sup><a id="fnr.1" name="fnr.1" class="footref" href="posts/plotting-with-uncertainty-part-ii/#fn.1">1</a></sup>_, is often called the bell curve because of
its characteristic shape (see the example below).
</p>

<p>
The normal distributions occurs often in nature.  For example, it
describes the commonly occurring distribution of samples influenced
by a large number of tiny, random disturbances, each with its own
unique distribution.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Parameters</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">
<code>loc</code> : float or array<sub>like</sub> of floats</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Mean ("centre") of the distribution.
</p>
</div>
</div>
<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2">
<code>scale</code> : float or array<sub>like</sub> of floats</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Standard deviation (spread or "width") of the distribution.
</p>
</div>
</div>
<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3">
<code>size</code> : int or tuple of ints, optional</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Output shape.  If the given shape is, e.g., <code>(m, n, k)</code>, then
<code>m * n * k</code> samples are drawn.  If size is <code>None</code> (default),
a single value is returned if <code>loc</code> and <code>scale</code> are both scalars.
Otherwise, <code>np.broadcast(loc, scale).size</code> samples are drawn.
</p>

<div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">33500</span><span class="p">,</span><span class="mi">150000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">90000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">120000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">48000</span><span class="p">,</span><span class="mi">55000</span><span class="p">,</span><span class="mi">3650</span><span class="p">)],</span> 
			<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1992</span><span class="p">,</span><span class="mi">1993</span><span class="p">,</span><span class="mi">1994</span><span class="p">,</span><span class="mi">1995</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">description</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<p>
Comparing the sample to the values fed to the <code>normal</code> function it appears that even with 3,650 values, it's still not exactly what we asked for.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

<p>
1992, the plot with the largest spread looks kind of lumpy. Their means look surprisingly close, but that's probably because the large standaard deviation distorts the scale.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
<p>
The box-plot shows once again that there centers are relatively close. But 1992 and 1994 have considerably more spread than 1993 and especially more than 1995.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Interval Check</h2>
<div class="outline-text-2" id="text-4">
<p>
This is the class that implements the plotting. It colors the bar-plots based on whether the value given is within a bar's confidence interval (white), below the confidence interval (blue) or above the confidence interval (red). It's set up to work with the easiest case so the <code>color_bars</code> method has to be overridden to make it work for this case.
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IntervalCheck</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""colors plot based on whether a value is in range</span>
<span class="sd">    Args:</span>
<span class="sd">     data (DataFrame): frame with data of interest as columns</span>
<span class="sd">     confidence_interval (float): probability we want to exceed</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">confidence_interval</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span> <span class="o">=</span> <span class="n">confidence_interval</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of high and low interval tuples"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>    
	    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">,</span>
						   <span class="n">loc</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
						   <span class="n">scale</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">sem</span><span class="p">())</span>
			       <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the low-ends for the confidence intervals</span>
<span class="sd">	Returns:</span>
<span class="sd">	 numpy.array of low-end confidence interval values</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">low</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""high-ends for the confidence intervals</span>
<span class="sd">	Returns:</span>
<span class="sd">	 numpy.array of high-end values for confidence intervals</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">high</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">means</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the means of the data-arrays"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The size of the errors, rather than the ci values"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span>

    <span class="k">def</span> <span class="nf">print_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""print org-mode formatted table of the confidence intervals"""</span>
	<span class="n">intervals</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">column</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
				      <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)},</span>
				     <span class="n">index</span><span class="o">=</span><span class="s2">"low high"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
	<span class="k">try</span><span class="p">:</span>
	    <span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">))</span>
	<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	    <span class="c1"># not supported</span>
	    <span class="k">pass</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="nf">setup_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">"""sets up the horizontal line, value and bars</span>
<span class="sd">	Args:</span>
<span class="sd">	 value (float): value to compare to distributions</span>
<span class="sd">	Returns:</span>
<span class="sd">	 bars (list): collection of bar-plot objects for the data</span>
<span class="sd">	"""</span>
	<span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
	<span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

	<span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
	<span class="n">bars</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
	    <span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">x_labels</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
		    <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">"facecolor"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">,</span> <span class="s2">"boxstyle"</span><span class="p">:</span> <span class="s2">"round"</span><span class="p">})</span>
	<span class="k">return</span> <span class="n">bars</span>

    <span class="k">def</span> <span class="nf">color_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
	<span class="sd">"""colors the bars based on the value</span>
<span class="sd">	this is the easiest case</span>
<span class="sd">	Args:</span>
<span class="sd">	 value (float): value to compare to the distribution</span>
<span class="sd">	 bars (list): list of bar-plot objects created from data</span>
<span class="sd">	"""</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'crimson'</span><span class="p">)</span>
	    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'w'</span><span class="p">)</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	    <span class="k">else</span><span class="p">:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	<span class="k">return</span>


    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">"""plots the data and value</span>
<span class="sd">	* blue bar if value above c.i.</span>
<span class="sd">	* white bar if value in c.i.</span>
<span class="sd">	* red bar if value is below c.i.</span>

<span class="sd">	Args:</span>
<span class="sd">	 value (float): what to compare to the data</span>
<span class="sd">	"""</span>
	<span class="n">bars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_bars</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">color_bars</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">bars</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Harder</h2>
<div class="outline-text-2" id="text-5">
<p>
This is the class that implements the harder coloring scheme were a gradient is used instead of just three colors.
</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Harder</span><span class="p">(</span><span class="n">IntervalCheck</span><span class="p">):</span>
    <span class="sd">"""implements the harder problem</span>
<span class="sd">    Uses a gradient instead of just 3 colors</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
	<span class="nb">super</span><span class="p">(</span><span class="n">Harder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""array of rgb color triples"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="c1"># could have been done with straight fractions</span>
	    <span class="c1"># but I find it easier to think in terms of</span>
	    <span class="c1"># 0..255</span>
	    <span class="n">base</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">51</span><span class="p">))</span>
	    <span class="n">full</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span>
	    <span class="n">blue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">full</span><span class="p">)</span>
	    <span class="n">blue</span> <span class="o">=</span> <span class="n">blue</span><span class="o">/</span><span class="mi">255</span>
	    <span class="n">base</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
	    <span class="n">red</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">full</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span>
	    <span class="n">red</span> <span class="o">=</span> <span class="n">red</span><span class="o">/</span><span class="mi">255</span>
	    <span class="n">tail</span> <span class="o">=</span> <span class="n">base</span><span class="p">[:]</span>
	    <span class="n">base</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
	    <span class="n">green</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colors</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">proportions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""array of upper limits for the value to find the matching color</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proportions</span>

    <span class="k">def</span> <span class="nf">color_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
	<span class="sd">"""colors the bars based on the value</span>
<span class="sd">	this is the harder case</span>
<span class="sd">	Args:</span>
<span class="sd">	 value (float): value to compare to the distribution</span>
<span class="sd">	 bars (list): list of bar-plot objects created from data</span>
<span class="sd">	"""</span>
	<span class="n">mapped_values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">value</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span>
			 <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">mapped_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mapped_values</span><span class="p">):</span>
	    <span class="k">for</span> <span class="n">p_index</span><span class="p">,</span> <span class="n">proportion</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportions</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">mapped_value</span> <span class="o">&lt;</span> <span class="n">proportion</span><span class="p">:</span>
		    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">p_index</span><span class="p">]</span>
		    <span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		    <span class="n">bars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
		    <span class="k">break</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Examples</h2>
<div class="outline-text-2" id="text-6">
<p>
First, I'll take a look at the values for the confidence intervals so that I can find values to plot. Here are the confidence intervals for the data I created.
</p>

<div class="highlight"><pre><span></span><span class="n">plotter</span> <span class="o">=</span> <span class="n">Harder</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">print_intervals</span><span class="p">()</span>
</pre></div>

<p>
Here's a value that is below all the confidence intervals. as you can see, all the bars are red.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">29000</span>
<span class="c1"># value = 33000</span>
<span class="c1"># value = 39974</span>
<span class="c1"># value = 42000</span>
<span class="c1"># value = 48000</span>
<span class="c1"># value = 49600</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-ii/assignment3harderbarplot.png" alt="assignment3harderbarplot.png"></p>
</div>

<p>
For the next value 1992 is light blue, so the value is slightly above the mean, while 1994 is light red, so the value is within the confidence interval but below the mean.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">36000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-ii/assignment3harderbarplot2.png" alt="assignment3harderbarplot2.png"></p>
</div>

<p>
This next value is at or close to 1993's mean and slightly above 1994's mean.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">39974</span>
<span class="c1"># value = 42000</span>
<span class="c1"># value = 48000</span>
<span class="c1"># value = 49600</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-ii/assignment3harderbarplot3.png" alt="assignment3harderbarplot3.png"></p>
</div>

<p>
This next value is within 1993's confidence interval, but it is light blue so it's above the mean.
</p>
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">42000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-ii/assignment3harderbarplot4.png" alt="assignment3harderbarplot4.png"></p>
</div>

<p>
The next value is within 1995's confidence interval but the darker blue indicates that it is nearly above the interval.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">49500</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-ii/assignment3harderbarplot5.png" alt="assignment3harderbarplot5.png"></p>
</div>

<p>
And finally, a value that's above all the confidence intervals.
</p>
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-ii/assignment3harderbarplot6.png" alt="assignment3harderbarplot6.png"></p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef">
<sup><a id="fn.1" name="fn.1" class="footnum" href="posts/plotting-with-uncertainty-part-ii/#fnr.1">1</a></sup><p>DEFINITION NOT FOUND.</p>
</div>


</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/plotting-with-uncertainty-part-i/" class="u-url">Plotting With Uncertainty (Part I)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/plotting-with-uncertainty-part-i/" rel="bookmark"><time class="published dt-published" datetime="2017-04-22T00:12:41-08:00" title="2017-04-22 00:12">2017-04-22 00:12</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
This is an implementation of the <i>easiest</i> option for Assignment 3 of coursera's <a href="https://www.coursera.org/learn/python-plotting/home/welcome">Applied Plotting, Charting &amp; Data Representation in Python</a>.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Description</h2>
<div class="outline-text-2" id="text-1">
<p>
In this <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/Ferreira_Fisher_Sample_Oriented_Tasks.pdf">paper</a> the authors describe the challenges users face when trying to make
judgements about probabilistic data generated through samples. As an
example, they look at a bar chart of four years of data (replicated
below in Figure 1). Each year has a y-axis value, which is derived from
a sample of a larger dataset. For instance, the first value might be the
number votes in a given district or riding for 1992, with the average
being around 33,000. On top of this is plotted the confidence interval
 the range of the number of votes which encapsulates 95% of the data
(see the boxplot lectures for more information, and the yerr parameter
of barcharts).
</p>

<p>
A challenge that users face is that, for a given y-axis value (e.g.
42,000), it is difficult to know which x-axis values are most likely to
be representative, because the confidence levels overlap and their
distributions are different (the lengths of the confidence interval bars
are unequal). One of the solutions the authors propose for this problem
(Figure 2c) is to allow users to indicate the y-axis value of interest
(e.g. 42,000) and then draw a horizontal line and color bars based on
this value. So bars might be colored red if they are definitely above
this value (given the confidence interval), blue if they are definitely
below this value, or white if they contain this value.
</p>


<p>
  <b>Easiest option:</b> Implement the bar coloring as described above - a color scale with only three colors, (e.g. blue, white, and red). Assume the user provides the y axis value of interest as a parameter or
variable.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Imports</h2>
<div class="outline-text-2" id="text-2">
<p>
All the imports were created by third-parties (taken from pypi).
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Some Plotting Setup</h3>
<div class="outline-text-3" id="text-2-1">
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">style</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">style</span><span class="p">[</span><span class="s2">"axes.grid"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">"whitegrid"</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">The Data</h2>
<div class="outline-text-2" id="text-3">
<p>
The data set will be four normally-distributed, randomly generated, data sets each representing a simulated data set for a given year.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><code>numpy.random.normal</code></h3>
<div class="outline-text-3" id="text-3-1">
<p>
This is from the <code>numpy.random.normal</code> doc-string:
</p>

<p>
<code>normal(loc=0.0, scale=1.0, size=None)</code>
</p>

<p>
Draw random samples from a normal (Gaussian) distribution.
</p>

<p>
The probability density function of the normal distribution, first
derived by De Moivre and 200 years later by both Gauss and Laplace
independently<sup><a id="fnr.1" name="fnr.1" class="footref" href="posts/plotting-with-uncertainty-part-i/#fn.1">1</a></sup>, is often called the bell curve because of
its characteristic shape (see the example below).
</p>

<p>
The normal distributions occurs often in nature.  For example, it
describes the commonly occurring distribution of samples influenced
by a large number of tiny, random disturbances, each with its own
unique distribution<sup><a id="fnr.2" name="fnr.2" class="footref" href="posts/plotting-with-uncertainty-part-i/#fn.2">2</a></sup>.
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Parameters</h4>
<div class="outline-text-4" id="text-3-1-1">
</div>
<ul class="org-ul">
<li>
<a id="sec-3-1-1-1" name="sec-3-1-1-1"></a><code>loc</code> : float or array-like of floats<br><div class="outline-text-5" id="text-3-1-1-1">
<p>
Mean ("centre") of the distribution.
</p>
</div>
</li>
<li>
<a id="sec-3-1-1-2" name="sec-3-1-1-2"></a><code>scale</code> : float or array-like of floats<br><div class="outline-text-5" id="text-3-1-1-2">
<p>
Standard deviation (spread or "width") of the distribution.
</p>
</div>
</li>
<li>
<a id="sec-3-1-1-3" name="sec-3-1-1-3"></a><code>size</code> : int or tuple of ints, optional<br><div class="outline-text-5" id="text-3-1-1-3">
<p>
Output shape.  If the given shape is, e.g., <code>(m, n, k)</code>, then
<code>m * n * k</code> samples are drawn.  If size is <code>None</code> (default),
a single value is returned if <code>loc</code> and <code>scale</code> are both scalars.
Otherwise, <code>np.broadcast(loc, scale).size</code> samples are drawn.
</p>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Creating the data</h3>
<div class="outline-text-3" id="text-3-2">
<div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">33500</span><span class="p">,</span><span class="mi">150000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">90000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">41000</span><span class="p">,</span><span class="mi">120000</span><span class="p">,</span><span class="mi">3650</span><span class="p">),</span> 
			 <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">48000</span><span class="p">,</span><span class="mi">55000</span><span class="p">,</span><span class="mi">3650</span><span class="p">)],</span> 
			<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1992</span><span class="p">,</span><span class="mi">1993</span><span class="p">,</span><span class="mi">1994</span><span class="p">,</span><span class="mi">1995</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">description</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
</colgroup>
<thead><tr>
<th scope="col" class="left"></th>
<th scope="col" class="right">1992</th>
<th scope="col" class="right">1993</th>
<th scope="col" class="right">1994</th>
<th scope="col" class="right">1995</th>
</tr></thead>
<tbody>
<tr>
<td class="left">count</td>
<td class="right">3650</td>
<td class="right">3650</td>
<td class="right">3650</td>
<td class="right">3650</td>
</tr>
<tr>
<td class="left">mean</td>
<td class="right">34484.1</td>
<td class="right">39975.7</td>
<td class="right">37565.7</td>
<td class="right">47798.5</td>
</tr>
<tr>
<td class="left">std</td>
<td class="right">150473</td>
<td class="right">88558.5</td>
<td class="right">120317</td>
<td class="right">54828.1</td>
</tr>
<tr>
<td class="left">min</td>
<td class="right">-528303</td>
<td class="right">-287127</td>
<td class="right">-382709</td>
<td class="right">-138895</td>
</tr>
<tr>
<td class="left">25%</td>
<td class="right">-67555.3</td>
<td class="right">-21665.5</td>
<td class="right">-45516.9</td>
<td class="right">11680</td>
</tr>
<tr>
<td class="left">50%</td>
<td class="right">31756.2</td>
<td class="right">41001.8</td>
<td class="right">39197.2</td>
<td class="right">49103.4</td>
</tr>
<tr>
<td class="left">75%</td>
<td class="right">135081</td>
<td class="right">99766.9</td>
<td class="right">121367</td>
<td class="right">84272</td>
</tr>
<tr>
<td class="left">max</td>
<td class="right">622629</td>
<td class="right">358328</td>
<td class="right">423793</td>
<td class="right">262364</td>
</tr>
</tbody>
</table>
<p>
Comparing the sample to the values fed to the <code>normal</code> function it appears that even with 3,650 values, it's still not exactly what we asked for.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3distributions.png" alt="assignment3distributions.png"></p>
</div>

<p>
1992, the plot with the largest spread looks kind of lumpy. Their means look surprisingly close, but that's probably because the large standaard deviation distorts the scale.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

<p>
<img src="posts/plotting-with-uncertainty-part-i/assignment3easyboxplot.png" alt="assignment3easyboxplot.png">
The box-plot shows once again that the centers are relatively close. But 1992 and 1994 have considerably more spread than 1993 and especially more than 1995.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Interval Check</h2>
<div class="outline-text-2" id="text-4">
<p>
This is the class that implements the plotting. It colors the bar-plots based on whether the value given is within a bar's confidence interval (white), below the confidence interval (blue) or above the confidence interval (red).
</p>

<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IntervalCheck</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""colors plot based on whether a value is in range</span>
<span class="sd">    Args:</span>
<span class="sd">     data (DataFrame): frame with data of interest as columns</span>
<span class="sd">     confidence_interval (float): probability we want to exceed</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">confidence_interval</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span> <span class="o">=</span> <span class="n">confidence_interval</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""list of high and low interval tuples"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>    
	    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">,</span>
						   <span class="n">loc</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
						   <span class="n">scale</span><span class="o">=</span><span class="n">datum</span><span class="o">.</span><span class="n">sem</span><span class="p">())</span>
			       <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intervals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the low-ends for the confidence intervals</span>
<span class="sd">	Returns:</span>
<span class="sd">	 numpy.array of low-end confidence interval values</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">low</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">highs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""high-ends for the confidence intervals</span>
<span class="sd">	Returns:</span>
<span class="sd">	 numpy.array of high-end values for confidence intervals</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">high</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">])</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">means</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""the means of the data-arrays"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_means</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""The size of the errors, rather than the ci values"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span>

    <span class="k">def</span> <span class="nf">print_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""print org-mode formatted table of the confidence intervals"""</span>
	<span class="n">intervals</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">column</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
				      <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)},</span>
				     <span class="n">index</span><span class="o">=</span><span class="s2">"low high"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
	<span class="k">try</span><span class="p">:</span>
	    <span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">))</span>
	<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	    <span class="c1"># not supported</span>
	    <span class="k">pass</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">"""plots the data and value</span>
<span class="sd">	* blue bar if value above c.i.</span>
<span class="sd">	* white bar if value in c.i.</span>
<span class="sd">	* red bar if value is below c.i.</span>

<span class="sd">	Args:</span>
<span class="sd">	 value (float): what to compare to the data</span>
<span class="sd">	"""</span>
	<span class="n">figure</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
	<span class="n">axe</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

	<span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
	<span class="n">bars</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">x_labels</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">)</span>
	<span class="n">pyplot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
		    <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">"facecolor"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">,</span> <span class="s2">"boxstyle"</span><span class="p">:</span> <span class="s2">"round"</span><span class="p">})</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'crimson'</span><span class="p">)</span>
	    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lows</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highs</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">'w'</span><span class="p">)</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	    <span class="k">else</span><span class="p">:</span>
		<span class="n">bar</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s2">"royalblue"</span><span class="p">)</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Examples</h2>
<div class="outline-text-2" id="text-5">
<p>
First, I'll take a look at the values for the confidence intervals so that I can find values to plot. Here are the confidence intervals for the data I created.
</p>

<div class="highlight"><pre><span></span><span class="n">plotter</span> <span class="o">=</span> <span class="n">IntervalCheck</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">print_intervals</span><span class="p">()</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
</colgroup>
<thead><tr>
<th scope="col" class="left"></th>
<th scope="col" class="right">1992</th>
<th scope="col" class="right">1993</th>
<th scope="col" class="right">1994</th>
<th scope="col" class="right">1995</th>
</tr></thead>
<tbody>
<tr>
<td class="left">low</td>
<td class="right">29602.5</td>
<td class="right">37102.7</td>
<td class="right">33662.4</td>
<td class="right">46019.8</td>
</tr>
<tr>
<td class="left">high</td>
<td class="right">39365.7</td>
<td class="right">42848.6</td>
<td class="right">41469</td>
<td class="right">49577.2</td>
</tr>
</tbody>
</table>
<p>
Here's a value that is below all the confidence intervals.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">29000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3easybarplot.png" alt="assignment3easybarplot.png"></p>
</div>

<p>
Here's a value that is within 1992's confidence interval but below the other years.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">33000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3easybarplot2.png" alt="assignment3easybarplot2.png"></p>
</div>

<p>
Here's a value within 1993's and 1994's confidence intervals, but above 1992's and below 1995's confidence intervals.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">39974</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3easybarplot3.png" alt="assignment3easybarplot3.png"></p>
</div>

<p>
Here's a value that is within 1993's confidence interval only.
</p>
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">42000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3easybarplot4.png" alt="assignment3easybarplot4.png"></p>
</div>

<p>
Here's a value withing only 1995's confidence interval.
</p>

<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">49500</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3easybarplot5.png" alt="assignment3easybarplot5.png"></p>
</div>

<p>
And finally, a value that's above all the confidence intervals.
</p>
<div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<div class="figure">
<p><img src="posts/plotting-with-uncertainty-part-i/assignment3easybarplot6.png" alt="assignment3easybarplot6.png"></p>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Citations</h2>
<div class="outline-text-2" id="text-6">
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef">
<sup><a id="fn.1" name="fn.1" class="footnum" href="posts/plotting-with-uncertainty-part-i/#fnr.1">1</a></sup><p class="footpara">
Wikipedia, "Normal distribution", <a href="http://en.wikipedia.org/wiki/Normal_distribution">http://en.wikipedia.org/wiki/Normal_distribution</a>
</p>
</div>

<div class="footdef">
<sup><a id="fn.2" name="fn.2" class="footnum" href="posts/plotting-with-uncertainty-part-i/#fnr.2">2</a></sup><p class="footpara">
P. R. Peebles Jr., "Central Limit Theorem" in "Probability, Random Variables and Random Signal Principles", 4th ed., 2001, pp. 51, 51, 125.
</p>
</div>


</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/assignment-2-olympic-medals/" class="u-url">Assignment 2 - Pandas Introduction (Olympic Medals)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/necromuralist/">necromuralist</a>
            </span></p>
            <p class="dateline"><a href="posts/assignment-2-olympic-medals/" rel="bookmark"><time class="published dt-published" datetime="2017-01-28T13:07:15-08:00" title="2017-01-28 13:07">2017-01-28 13:07</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
This is the notebook for assignment 2 of the Coursera <i>Python Data Analysis</i> course. This was converted from a <i>jupyter</i> notebook that you can download it as part of the <a href="https://www.coursera.org/learn/python-data-analysis/resources/0dhYG">course downloads</a> zip file. The submissions work by uploading a <i>ipynb</i> file so there's a bit of cutting and pasting needed to get the code from here to there. Also I didn't use their variable names so the final outcome needs some aliasing for the grader to pass it.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Part 1</h2>
<div class="outline-text-2" id="text-1">
<p>
The following code loads the olympics dataset (olympics.csv), which was derived from the Wikipedia entry on <a href="https://en.wikipedia.org/wiki/All-time_Olympic_Games_medal_table">All Time Olympic Games Medals</a>, and does some basic data cleaning. 
</p>

<p>
The columns are organized as 
</p>

<ul class="org-ul">
<li># of Summer games, 
</li>
<li>Summer medals
</li>
<li># of Winter games
</li>
<li>Winter medals
</li>
<li>total # number of games
</li>
<li>total # of medals
</li>
</ul>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Imports</h3>
<div class="outline-text-3" id="text-1-1">
<div class="highlight"><pre><span></span><span class="c1"># third party</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Load the Data</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">A quick look at the data-source</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
The data is stored in a comma-separated file named <i>olympics.csv</i>.
</p>

<div class="highlight"><pre><span></span>head olympics.csv
</pre></div>

<pre class="example">
0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
, Summer,01 !,02 !,03 !,Total, Winter,01 !,02 !,03 !,Total, Games,01 !,02 !,03 !,Combined total
Afghanistan(AFG),13,0,0,2,2,0,0,0,0,0,13,0,0,2,2
Algeria(ALG),12,5,2,8,15,3,0,0,0,0,15,5,2,8,15
Argentina(ARG),23,18,24,28,70,18,0,0,0,0,41,18,24,28,70
Armenia(ARM),5,1,2,9,12,6,0,0,0,0,11,1,2,9,12
Australasia(ANZ) [ANZ],2,3,4,5,12,0,0,0,0,0,2,3,4,5,12
Australia(AUS) [AUS] [Z],25,139,152,177,468,18,5,3,4,12,43,144,155,181,480
Austria(AUT),26,18,33,35,86,22,59,78,81,218,48,77,111,116,304
Azerbaijan(AZE),5,6,5,15,26,5,0,0,0,0,10,6,5,15,26
</pre>

<p>
Looking at the output of our source data-file (<i>olympics.csv</i>) you can see that the first row is a column-index that we'll want to get rid of. The first column is also missing a header and there are columns with unicode and mysterious numeric names with exclamation points at the end.
</p>

<p>
If you go to the wikipedia page and look at the <a href="https://en.wikipedia.org/wiki/All-time_Olympic_Games_medal_table#NOCs_with_medals">NOC's with medals</a> table (<i>NOC</i> stands for <i>National Olympic Committee</i> - each country that participates in the Olympics has one, unless they are part of a combined committee) you'll see that the numbers with leading zeros correspond to the medal types, the decimal numbers are the game (Summer (no trailing decimal), Winter (.1), or combined (.2)). So <code>01 !.2</code> means the total number of gold medals for both the summer and winter games combined. The <code>No</code> columns is the count of the number of times a country participated in a game. So, looking at the output above, Afghanistan has participated in 13 Summer games (this data was apparently pulled before the 2016 games in Rio de Janeiro, as their count is currently 14 on the source page). As for the <code>!</code> notation, the wikipedia page has arrows that you can click on that will let you sort the rows by a particular column and I think this is how their screen-scraper translated them into ascii.   
</p>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Load the data into pandas</h4>
<div class="outline-text-4" id="text-1-2-2">
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'olympics.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">description</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
<col class="right">
</colgroup>
<thead><tr>
<th scope="col" class="left"></th>
<th scope="col" class="right"> Summer</th>
<th scope="col" class="right">01 !</th>
<th scope="col" class="right">02 !</th>
<th scope="col" class="right">03 !</th>
<th scope="col" class="right">Total</th>
<th scope="col" class="right"> Winter</th>
<th scope="col" class="right">01 !.1</th>
<th scope="col" class="right">02 !.1</th>
<th scope="col" class="right">03 !.1</th>
<th scope="col" class="right">Total.1</th>
<th scope="col" class="right"> Games</th>
<th scope="col" class="right">01 !.2</th>
<th scope="col" class="right">02 !.2</th>
<th scope="col" class="right">03 !.2</th>
<th scope="col" class="right">Combined total</th>
</tr></thead>
<tbody>
<tr>
<td class="left">count</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
<td class="right">147</td>
</tr>
<tr>
<td class="left">mean</td>
<td class="right">13.4762</td>
<td class="right">65.4286</td>
<td class="right">64.966</td>
<td class="right">69.7959</td>
<td class="right">200.19</td>
<td class="right">6.70068</td>
<td class="right">13.0476</td>
<td class="right">13.034</td>
<td class="right">12.898</td>
<td class="right">38.9796</td>
<td class="right">20.1769</td>
<td class="right">78.4762</td>
<td class="right">78</td>
<td class="right">82.6939</td>
<td class="right">239.17</td>
</tr>
<tr>
<td class="left">std</td>
<td class="right">7.07236</td>
<td class="right">405.55</td>
<td class="right">399.31</td>
<td class="right">427.187</td>
<td class="right">1231.31</td>
<td class="right">7.43319</td>
<td class="right">80.7992</td>
<td class="right">80.6344</td>
<td class="right">79.5884</td>
<td class="right">240.917</td>
<td class="right">13.257</td>
<td class="right">485.013</td>
<td class="right">478.86</td>
<td class="right">505.855</td>
<td class="right">1469.07</td>
</tr>
<tr>
<td class="left">min</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">1</td>
</tr>
<tr>
<td class="left">25%</td>
<td class="right">8</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">11</td>
<td class="right">0</td>
<td class="right">1</td>
<td class="right">1</td>
<td class="right">2.5</td>
</tr>
<tr>
<td class="left">50%</td>
<td class="right">13</td>
<td class="right">3</td>
<td class="right">4</td>
<td class="right">6</td>
<td class="right">12</td>
<td class="right">5</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">0</td>
<td class="right">15</td>
<td class="right">3</td>
<td class="right">4</td>
<td class="right">7</td>
<td class="right">12</td>
</tr>
<tr>
<td class="left">75%</td>
<td class="right">18.5</td>
<td class="right">24</td>
<td class="right">28</td>
<td class="right">29</td>
<td class="right">86</td>
<td class="right">10</td>
<td class="right">1</td>
<td class="right">2</td>
<td class="right">1</td>
<td class="right">5</td>
<td class="right">27</td>
<td class="right">25.5</td>
<td class="right">29</td>
<td class="right">32.5</td>
<td class="right">89</td>
</tr>
<tr>
<td class="left">max</td>
<td class="right">27</td>
<td class="right">4809</td>
<td class="right">4775</td>
<td class="right">5130</td>
<td class="right">14714</td>
<td class="right">22</td>
<td class="right">959</td>
<td class="right">958</td>
<td class="right">948</td>
<td class="right">2865</td>
<td class="right">49</td>
<td class="right">5768</td>
<td class="right">5733</td>
<td class="right">6078</td>
<td class="right">17579</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

<pre class="example">
                          Summer  01 !  02 !  03 !  Total   Winter  01 !.1  \
Afghanistan(AFG)              13     0     0     2      2         0       0   
Algeria(ALG)                  12     5     2     8     15         3       0   
Argentina(ARG)                23    18    24    28     70        18       0   
Armenia(ARM)                   5     1     2     9     12         6       0   
Australasia(ANZ) [ANZ]         2     3     4     5     12         0       0   

                         02 !.1  03 !.1  Total.1   Games  01 !.2  02 !.2  \
Afghanistan(AFG)             0       0        0       13       0       0   
Algeria(ALG)                 0       0        0       15       5       2   
Argentina(ARG)               0       0        0       41      18      24   
Armenia(ARM)                 0       0        0       11       1       2   
Australasia(ANZ) [ANZ]       0       0        0        2       3       4   

                         03 !.2  Combined total  
Afghanistan(AFG)             2               2  
Algeria(ALG)                 8              15  
Argentina(ARG)              28              70  
Armenia(ARM)                 9              12  
Australasia(ANZ) [ANZ]       5              12
</pre>

<p>
It looks like the countries got read as the index for the data-frame since the first column was empty.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>

<pre class="example">
                                               Summer  01 !  02 !  03 !  \
Independent Olympic Participants(IOP) [IOP]         1     0     1     2   
Zambia(ZAM) [ZAM]                                  12     0     1     1   
Zimbabwe(ZIM) [ZIM]                                12     3     4     1   
Mixed team(ZZX) [ZZX]                               3     8     5     4   
Totals                                              27  4809  4775  5130   

                                              Total   Winter  01 !.1  02 !.1  \
Independent Olympic Participants(IOP) [IOP]      3         0       0       0   
Zambia(ZAM) [ZAM]                                2         0       0       0   
Zimbabwe(ZIM) [ZIM]                              8         1       0       0   
Mixed team(ZZX) [ZZX]                           17         0       0       0   
Totals                                        14714        22     959     958   

                                              03 !.1  Total.1   Games  \
Independent Olympic Participants(IOP) [IOP]       0        0        1   
Zambia(ZAM) [ZAM]                                 0        0       12   
Zimbabwe(ZIM) [ZIM]                               0        0       13   
Mixed team(ZZX) [ZZX]                             0        0        3   
Totals                                           948     2865       49   

                                              01 !.2  02 !.2  03 !.2  \
Independent Olympic Participants(IOP) [IOP]       0       1       2   
Zambia(ZAM) [ZAM]                                 0       1       1   
Zimbabwe(ZIM) [ZIM]                               3       4       1   
Mixed team(ZZX) [ZZX]                             8       5       4   
Totals                                          5768    5733    6078   

                                              Combined total  
Independent Olympic Participants(IOP) [IOP]               3  
Zambia(ZAM) [ZAM]                                         2  
Zimbabwe(ZIM) [ZIM]                                       8  
Mixed team(ZZX) [ZZX]                                    17  
Totals                                                 17579
</pre>

<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">"Combined total"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"Totals"</span><span class="p">][</span><span class="s2">"Combined total"</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"Combined total"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>

<pre class="example">
35158
35158
</pre>

<p>
It also looks like the last row is a sum of the columns, which we will need to get rid of (as you can see from the sum it doubles any math we do on a column).
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Fixing the Column Names</h3>
<div class="outline-text-3" id="text-1-3">
<p>
First the unicode is removed from the column names and the columns are given more human-readable names.
</p>

<div class="highlight"><pre><span></span><span class="n">new_columns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"summer_participations"</span><span class="p">,</span>
	       <span class="s2">"summer_gold"</span><span class="p">,</span>
	       <span class="s2">"summer_silver"</span><span class="p">,</span>
	       <span class="s2">"summer_bronze"</span><span class="p">,</span>
	       <span class="s2">"summer_total"</span><span class="p">,</span>
	       <span class="s2">"winter_participations"</span><span class="p">,</span>
	       <span class="s2">"winter_gold"</span><span class="p">,</span>
	       <span class="s2">"winter_silver"</span><span class="p">,</span>
	       <span class="s2">"winter_bronze"</span><span class="p">,</span>
	       <span class="s2">"winter_total"</span><span class="p">,</span>
	       <span class="s2">"total_participations"</span><span class="p">,</span>
	       <span class="s2">"total_gold"</span><span class="p">,</span>
	       <span class="s2">"total_silver"</span><span class="p">,</span>
	       <span class="s2">"total_bronze"</span><span class="p">,</span>
	       <span class="s2">"total_combined"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">column_remap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">new_columns</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"summer_participations"</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
	<span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">column_remap</span><span class="p">[</span><span class="n">column</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<pre class="example">
                   summer_participations  summer_gold  summer_silver  \
Afghanistan(AFG)                     13            0              0   

                   summer_bronze  summer_total  winter_participations  \
Afghanistan(AFG)              2             2                      0   

                   winter_gold  winter_silver  winter_bronze  winter_total  \
Afghanistan(AFG)            0              0              0             0   

                   total_participations  total_gold  total_silver  \
Afghanistan(AFG)                    13           0             0   

                   total_bronze  total_combined  
Afghanistan(AFG)             2               2
</pre>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Changing the Indices</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Since the index has both a country name and a country code, we'll create a new column with just the ID's. The indices are split on the first left parenthesis ("(") creating a tuple with the first item being the name of the country and the second containing the country codes. To avoid the trailing parentheses and any other extra characters, the country-code gets sliced. Finally the last row ("Totals") gets dropped
</p>

<div class="highlight"><pre><span></span><span class="c1"># split the index by '('</span>
<span class="n">names_ids</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'\s\('</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">names_ids</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">'ID'</span><span class="p">]</span> <span class="o">=</span> <span class="n">names_ids</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'Totals'</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<pre class="example">
             summer_participations  summer_gold  summer_silver  summer_bronze  \
Afghanistan                     13            0              0              2   

             summer_total  winter_participations  winter_gold  winter_silver  \
Afghanistan             2                      0            0              0   

             winter_bronze  winter_total  total_participations  total_gold  \
Afghanistan              0             0                    13           0   

             total_silver  total_bronze  total_combined   ID  
Afghanistan             0             2               2  AFG
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Question 0 (Example)</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">What is the first country in in the data-frame?</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The autograder will call this function and compare the return value against the correct solution value.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_zero</span><span class="p">():</span>
    <span class="sd">"""This function returns the row for Afghanistan</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Series: first row in the data</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">answer_zero</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
</pre></div>

<pre class="example">
Afghanistan
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Questions</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Question 1</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Which country has won the most gold medals in summer games?
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_one</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Str: name of the country with the most summer gold medals</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">summer_gold</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

<span class="n">answer_one</span><span class="p">()</span>
</pre></div>

<pre class="example">
United States
</pre>

<p>
Since we put the NOCs in the index (and most are country names), finding the index for the maximum value returns the country name that we want.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Question 2</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Which country had the biggest difference between their summer and winter gold medal counts?
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_two</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Str: country with most difference between summer and winter gold</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">summer_gold</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">winter_gold</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

<span class="n">answer_two</span><span class="p">()</span>
</pre></div>

<pre class="example">
United States
</pre>
</div>
</div>


<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Question 3</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Which country has the biggest difference between their summer gold medal counts and winter gold medal counts relative to their total gold medal count? 
</p>

<p>
\(\frac{Summer~Gold - Winter~Gold}{Total~Gold}\)
</p>


<p>
Only include countries that have won at least 1 gold in both summer and winter.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_three</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    find country with the biggest difference between the</span>
<span class="sd">    summer and winter gold counts relative to total gold metal count</span>
<span class="sd">    if they have at least one gold medal in both summer and winter</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    str: country with biggest summer/winter gold differe</span>
<span class="sd">    """</span>
    <span class="n">elegible</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">summer_gold</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">winter_gold</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">ratios</span> <span class="o">=</span> <span class="p">(</span><span class="n">elegible</span><span class="o">.</span><span class="n">summer_gold</span> <span class="o">-</span> <span class="n">elegible</span><span class="o">.</span><span class="n">winter_gold</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">/</span><span class="n">elegible</span><span class="o">.</span><span class="n">total_gold</span>
    <span class="k">return</span> <span class="n">ratios</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

<span class="n">answer_three</span><span class="p">()</span>
</pre></div>

<pre class="example">
Bulgaria
</pre>
</div>
</div>


<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Question 4</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Write a function that creates a Series called "Points" which is a weighted value where each gold medal (`Gold.2`) counts for 3 points, silver medals (`Silver.2`) for 2 points, and bronze medals (`Bronze.2`) for 1 point. The function should return only the column (a Series object) which you created.
</p>

<div class="highlight"><pre><span></span> <span class="k">def</span> <span class="nf">answer_four</span><span class="p">():</span>
     <span class="sd">"""</span>
<span class="sd">     Creates weighted points based on medals</span>
<span class="sd">       * Gold: 3 points</span>
<span class="sd">       * Silver: 2 points</span>
<span class="sd">       * Bronze: 1 point</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>

<span class="sd">     Series: column of points for each NOC</span>
<span class="sd">     """</span>
     <span class="n">points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
     <span class="n">points</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">total_gold</span> <span class="o">*</span> <span class="mi">3</span>
     <span class="n">points</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">total_silver</span> <span class="o">*</span> <span class="mi">2</span>
     <span class="n">points</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">total_bronze</span>
     <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">answer_four</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"United States"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5684</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Part 2</h2>
<div class="outline-text-2" id="text-4">
<p>
For the next set of questions, we will be using census data from the <a href="http://www.census.gov/popest/data/counties/totals/2015/CO-EST2015-alldata.html">United States Census Bureau</a>. Counties are political and geographic subdivisions of states in the United States. This dataset contains population data for counties and states in the US from 2010 to 2015. <a href="http://www.census.gov/popest/data/counties/totals/2015/files/CO-EST2015-alldata.pdf">See this document</a> for a description of the variable names.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Load the Census Data</h3>
<div class="outline-text-3" id="text-4-1">
<div class="highlight"><pre><span></span><span class="n">census_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'census.csv'</span><span class="p">)</span>
<span class="n">census_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

<pre class="example">
   SUMLEV  REGION  DIVISION  STATE  COUNTY   STNAME         CTYNAME  \
0      40       3         6      1       0  Alabama         Alabama   
1      50       3         6      1       1  Alabama  Autauga County   
2      50       3         6      1       3  Alabama  Baldwin County   
3      50       3         6      1       5  Alabama  Barbour County   
4      50       3         6      1       7  Alabama     Bibb County   

   CENSUS2010POP  ESTIMATESBASE2010  POPESTIMATE2010     ...       \
0        4779736            4780127          4785161     ...        
1          54571              54571            54660     ...        
2         182265             182265           183193     ...        
3          27457              27457            27341     ...        
4          22915              22919            22861     ...        

   RDOMESTICMIG2011  RDOMESTICMIG2012  RDOMESTICMIG2013  RDOMESTICMIG2014  \
0          0.002295         -0.193196          0.381066          0.582002   
1          7.242091         -2.915927         -3.012349          2.265971   
2         14.832960         17.647293         21.845705         19.243287   
3         -4.728132         -2.500690         -7.056824         -3.904217   
4         -5.527043         -5.068871         -6.201001         -0.177537   

   RDOMESTICMIG2015  RNETMIG2011  RNETMIG2012  RNETMIG2013  RNETMIG2014  \
0         -0.467369     1.030015     0.826644     1.383282     1.724718   
1         -2.530799     7.606016    -2.626146    -2.722002     2.592270   
2         17.197872    15.844176    18.559627    22.727626    20.317142   
3        -10.543299    -4.874741    -2.758113    -7.167664    -3.978583   
4          0.177258    -5.088389    -4.363636    -5.403729     0.754533   

   RNETMIG2015  
0     0.712594  
1    -2.187333  
2    18.293499  
3   -10.543299  
4     1.107861  

[5 rows x 100 columns]
</pre>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Census Variable Names</h3>
<div class="outline-text-3" id="text-4-2">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CensusVariables</span><span class="p">:</span>
    <span class="n">state_name</span> <span class="o">=</span> <span class="s2">"STNAME"</span>
    <span class="n">county_name</span> <span class="o">=</span> <span class="s2">"CTYNAME"</span>
    <span class="n">census_population</span> <span class="o">=</span> <span class="s2">"CENSUS2010POP"</span>
    <span class="n">region</span> <span class="o">=</span> <span class="s2">"REGION"</span>
    <span class="n">population_2014</span> <span class="o">=</span> <span class="s2">"POPESTIMATE2014"</span>
    <span class="n">population_2015</span> <span class="o">=</span> <span class="s2">"POPESTIMATE2015"</span>
    <span class="n">population_estimates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"POPESTIMATE2010"</span><span class="p">,</span>
			    <span class="s2">"POPESTIMATE2011"</span><span class="p">,</span>
			    <span class="s2">"POPESTIMATE2012"</span><span class="p">,</span>
			    <span class="s2">"POPESTIMATE2013"</span><span class="p">,</span>
			    <span class="n">population_2014</span><span class="p">,</span>
			    <span class="n">population_2015</span><span class="p">]</span>
    <span class="n">county_level</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">summary_level</span> <span class="o">=</span> <span class="s2">"SUMLEV"</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">Counties Only</h3>
<div class="outline-text-3" id="text-4-3">
<div class="highlight"><pre><span></span><span class="n">counties</span> <span class="o">=</span> <span class="n">census_data</span><span class="p">[</span><span class="n">census_data</span><span class="p">[</span>
    <span class="n">CensusVariables</span><span class="o">.</span><span class="n">summary_level</span><span class="p">]</span><span class="o">==</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">county_level</span><span class="p">]</span>
<span class="c1"># this throws off the numeric index for the argmax method so reset it</span>
<span class="n">counties</span> <span class="o">=</span> <span class="n">counties</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># but the last question wants the original index</span>
<span class="n">counties_original_index</span> <span class="o">=</span> <span class="n">census_data</span><span class="p">[</span><span class="n">census_data</span><span class="p">[</span>
    <span class="n">CensusVariables</span><span class="o">.</span><span class="n">summary_level</span><span class="p">]</span><span class="o">==</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">county_level</span><span class="p">]</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Question 5</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Which state has the most counties in it? (hint: consider the sumlevel key carefully! You'll need this for future questions too)
</p>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_five</span><span class="p">():</span>
    <span class="sd">"""finds state with the most counties</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    str name of state with the most counties</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">counties</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
	<span class="n">CensusVariables</span><span class="o">.</span><span class="n">state_name</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">COUNTY</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

<span class="n">answer_five</span><span class="p">()</span>
</pre></div>

<pre class="example">
Texas
</pre>
</div>
</div>

<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5">Question 6</h3>
<div class="outline-text-3" id="text-4-5">
<p>
Only looking at the three most populous counties for each state, what are the three most populous states (in order of highest population to lowest population)? Use <code>CENSUS2010POP</code>.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_six</span><span class="p">():</span>
    <span class="sd">"""finds three most populous states based on top three counties in each</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    List: top three state-names (highest to lowest)</span>
<span class="sd">    """</span>
    <span class="n">top_threes</span> <span class="o">=</span> <span class="n">counties</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
	<span class="n">CensusVariables</span><span class="o">.</span><span class="n">state_name</span>
    <span class="p">)[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">census_population</span><span class="p">]</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">states</span> <span class="o">=</span> <span class="n">top_threes</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">answer_six</span><span class="p">()</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left">
<col class="left">
<col class="left">
</colgroup>
<tbody><tr>
<td class="left">California</td>
<td class="left">Texas</td>
<td class="left">Illinois</td>
</tr></tbody>
</table>
</div>
</div>


<div id="outline-container-sec-4-6" class="outline-3">
<h3 id="sec-4-6">Question 7</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Which county has had the largest absolute change in population within the period 2010-2015? (Hint: population values are stored in columns <code>POPESTIMATE2010</code> through <code>POPESTIMATE2015</code>, you need to consider all six columns.)
</p>

<p>
e.g. If County Population in the 5 year period is 100, 120, 80, 105, 100, 130, then its largest change in the period would be |130-80| = 50.
</p>

<p>
<b>This function should return a single string value.</b>
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_seven</span><span class="p">():</span>
    <span class="sd">"""Find county with largest absolute population variance</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    str: name of the county</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">counties</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
	<span class="p">(</span><span class="n">counties</span><span class="p">[</span>
	    <span class="n">CensusVariables</span><span class="o">.</span><span class="n">population_estimates</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span>
	 <span class="n">counties</span><span class="p">[</span>
	     <span class="n">CensusVariables</span><span class="o">.</span><span class="n">population_estimates</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()][</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">county_name</span><span class="p">]</span>

<span class="n">answer_seven</span><span class="p">()</span>
</pre></div>

<pre class="example">
Harris County
</pre>
</div>
</div>


<div id="outline-container-sec-4-7" class="outline-3">
<h3 id="sec-4-7">Question 8</h3>
<div class="outline-text-3" id="text-4-7">
<p>
In this datafile, the United States is broken up into four regions using the "REGION" column. 
</p>

<p>
Create a query that finds the counties that belong to regions 1 or 2, whose name starts with 'Washington', and whose <code>POPESTIMATE2015</code> was greater than their <code>POPESTIMATE2014</code>.
</p>

<p>
<b>This function should return a 5x2 DataFrame with the columns = ['STNAME', 'CTYNAME'] and the same index ID as the <code>census_data</code> (sorted ascending by index).</b>
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">answer_eight</span><span class="p">():</span>
    <span class="sd">"""find region 1 or 2 counties:</span>

<span class="sd">      * with names that start with Washington</span>
<span class="sd">      * whose population grew from 2014 to 2015</span>

<span class="sd">    .. note:: the index in the final data-frame has to match the original</span>
<span class="sd">    census data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    DataFrame: with the county and state-name columns</span>
<span class="sd">    """</span>
    <span class="n">regions</span> <span class="o">=</span> <span class="n">counties_original_index</span><span class="p">[</span>
	<span class="p">(</span><span class="n">counties_original_index</span><span class="p">[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">region</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
	<span class="p">(</span><span class="n">counties_original_index</span><span class="p">[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">region</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">)]</span>
    <span class="n">washingtons</span> <span class="o">=</span> <span class="n">regions</span><span class="p">[</span>
	<span class="n">regions</span><span class="p">[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">county_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"Washington"</span><span class="p">)]</span>
    <span class="n">grew</span> <span class="o">=</span> <span class="n">washingtons</span><span class="p">[</span><span class="n">washingtons</span><span class="p">[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">population_2015</span><span class="p">]</span> <span class="o">&gt;</span>
		       <span class="n">washingtons</span><span class="p">[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">population_2014</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">grew</span><span class="p">[[</span><span class="n">CensusVariables</span><span class="o">.</span><span class="n">state_name</span><span class="p">,</span>
		 <span class="n">CensusVariables</span><span class="o">.</span><span class="n">county_name</span><span class="p">]]</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">answer_eight</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">outcome</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">outcome</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'STNAME'</span><span class="p">,</span> <span class="s1">'CTYNAME'</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"index"</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">outcome</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
	       <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="right">
<col class="left">
<col class="left">
</colgroup>
<thead><tr>
<th scope="col" class="right">index</th>
<th scope="col" class="left">STNAME</th>
<th scope="col" class="left">CTYNAME</th>
</tr></thead>
<tbody>
<tr>
<td class="right">896</td>
<td class="left">Iowa</td>
<td class="left">Washington County</td>
</tr>
<tr>
<td class="right">1419</td>
<td class="left">Minnesota</td>
<td class="left">Washington County</td>
</tr>
<tr>
<td class="right">2345</td>
<td class="left">Pennsylvania</td>
<td class="left">Washington County</td>
</tr>
<tr>
<td class="right">2355</td>
<td class="left">Rhode Island</td>
<td class="left">Washington County</td>
</tr>
<tr>
<td class="right">3163</td>
<td class="left">Wisconsin</td>
<td class="left">Washington County</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
    </div>
    </article>
</div>





        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-yYfngbEKv4RENfGDvNUqJTqGFcKf31NJEe9OTnnMH3Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents  2017         <a href="mailto:necromuralist@gmail.com">necromuralist</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
